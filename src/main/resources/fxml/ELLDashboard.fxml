<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.ELLDashboardController"
            prefWidth="1500" prefHeight="950"
            styleClass="main-container">


    <!-- Top: Header & Filters -->
    <top>
        <VBox spacing="15" styleClass="header-container">
            <Label text="ELL Program Dashboard" styleClass="text-blue-header"/>
            <Label text="English Language Learner program overview, compliance monitoring, and student progress tracking"
                   styleClass="text-subtitle" wrapText="true"/>

            <!-- Title III Compliance Banner -->
            <HBox spacing="10" styleClass="card, metric-info">
                <Label text="ðŸ“‹" styleClass="icon-16"/>
                <VBox spacing="5">
                    <Label text="Title III Compliance &amp; Federal Reporting"
                           styleClass="text-blue-dark"/>
                    <Label text="Annual assessments, progress monitoring, and parent notification are required by federal law. Ensure timely reclassification reviews."
                           styleClass="text-muted" wrapText="true"/>
                </VBox>
            </HBox>

            <!-- Filters -->
            <HBox spacing="15" styleClass="filter-bar-top">
                <VBox spacing="5">
                    <Label text="ELL Status" styleClass="form-label"/>
                    <ComboBox fx:id="statusFilterComboBox" prefWidth="180">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="ALL"/>
                                <String fx:value="ACTIVE"/>
                                <String fx:value="RECLASSIFIED"/>
                                <String fx:value="MONITORED"/>
                                <String fx:value="EXITED"/>
                            </FXCollections>
                        </items>
                    </ComboBox>
                </VBox>

                <VBox spacing="5">
                    <Label text="Proficiency Level" styleClass="form-label"/>
                    <ComboBox fx:id="proficiencyFilterComboBox" prefWidth="180">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="ALL"/>
                                <String fx:value="ENTERING"/>
                                <String fx:value="EMERGING"/>
                                <String fx:value="DEVELOPING"/>
                                <String fx:value="EXPANDING"/>
                                <String fx:value="BRIDGING"/>
                                <String fx:value="REACHING"/>
                            </FXCollections>
                        </items>
                    </ComboBox>
                </VBox>

                <VBox spacing="5">
                    <Label text="Grade Level" styleClass="form-label"/>
                    <ComboBox fx:id="gradeLevelFilterComboBox" prefWidth="120">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="ALL"/>
                                <String fx:value="K"/>
                                <String fx:value="1"/>
                                <String fx:value="2"/>
                                <String fx:value="3"/>
                                <String fx:value="4"/>
                                <String fx:value="5"/>
                                <String fx:value="6"/>
                                <String fx:value="7"/>
                                <String fx:value="8"/>
                                <String fx:value="9"/>
                                <String fx:value="10"/>
                                <String fx:value="11"/>
                                <String fx:value="12"/>
                            </FXCollections>
                        </items>
                    </ComboBox>
                </VBox>

                <VBox spacing="5">
                    <Label text="Program Type" styleClass="form-label"/>
                    <ComboBox fx:id="programTypeFilterComboBox" prefWidth="200">
                        <items>
                            <FXCollections fx:factory="observableArrayList">
                                <String fx:value="ALL"/>
                                <String fx:value="ESL_PULL_OUT"/>
                                <String fx:value="ESL_PUSH_IN"/>
                                <String fx:value="SHELTERED_ENGLISH"/>
                                <String fx:value="DUAL_LANGUAGE"/>
                                <String fx:value="NEWCOMER"/>
                            </FXCollections>
                        </items>
                    </ComboBox>
                </VBox>

                <VBox spacing="5" alignment="BOTTOM_LEFT">
                    <Label text=" "/>
                    <HBox spacing="10">
                        <Button text="Apply Filters" onAction="#handleApplyFilters"
                                styleClass="button-primary"/>
                        <Button text="Reset" onAction="#handleResetFilters"
                                styleClass="button-primary"/>
                        <Button text="Refresh" onAction="#handleRefresh"
                                styleClass="button-primary"/>
                    </HBox>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Dashboard Content -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="scroll-pane-transparent">
            <VBox spacing="20" styleClass="content-padding">

                <!-- Summary Statistics Cards -->
                <GridPane hgap="15" vgap="15">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="16.66"/>
                        <ColumnConstraints percentWidth="16.66"/>
                        <ColumnConstraints percentWidth="16.66"/>
                        <ColumnConstraints percentWidth="16.66"/>
                        <ColumnConstraints percentWidth="16.66"/>
                        <ColumnConstraints percentWidth="16.67"/>
                    </columnConstraints>

                    <!-- Total ELL Students Card -->
                    <VBox spacing="10" styleClass="stat-card, card"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Total ELL Students" styleClass="text-muted"/>
                        <Label fx:id="totalELLLabel" text="0" styleClass="stat-value-blue"/>
                        <Label fx:id="totalELLPercentLabel" text="0% of enrollment" styleClass="text-muted"/>
                    </VBox>

                    <!-- Active ELL Card -->
                    <VBox spacing="10" styleClass="stat-card, card, metric-success"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Active ELL" styleClass="text-muted"/>
                        <Label fx:id="activeELLLabel" text="0" styleClass="stat-value-green"/>
                        <Label fx:id="activeELLPercentLabel" text="0% of total" styleClass="text-muted"/>
                    </VBox>

                    <!-- Monitored Students Card -->
                    <VBox spacing="10" styleClass="stat-card, card, metric-warning"
                          GridPane.columnIndex="2" GridPane.rowIndex="0">
                        <Label text="Monitored Students" styleClass="text-muted"/>
                        <Label fx:id="monitoredLabel" text="0" styleClass="stat-value-orange"/>
                        <Label fx:id="monitoredYearsLabel" text="Across 1-4 years" styleClass="text-muted"/>
                    </VBox>

                    <!-- Eligible for Reclassification Card -->
                    <VBox spacing="10" styleClass="stat-card, card"
                          GridPane.columnIndex="3" GridPane.rowIndex="0">
                        <Label text="Eligible for Reclass" styleClass="text-muted"/>
                        <Label fx:id="eligibleReclassLabel" text="0" styleClass="stat-value-purple"/>
                        <Label fx:id="eligibleReclassPercentLabel" text="0% of active" styleClass="text-muted"/>
                    </VBox>

                    <!-- Assessments Overdue Card -->
                    <VBox spacing="10" styleClass="stat-card, card, metric-danger"
                          GridPane.columnIndex="4" GridPane.rowIndex="0">
                        <Label text="Assessments Overdue" styleClass="text-muted"/>
                        <Label fx:id="assessmentsOverdueLabel" text="0" styleClass="stat-value-red"/>
                        <Label fx:id="assessmentsDueLabel" text="0 due this month" styleClass="text-muted"/>
                    </VBox>

                    <!-- Title III Funded Card -->
                    <VBox spacing="10" styleClass="stat-card, card"
                          GridPane.columnIndex="5" GridPane.rowIndex="0">
                        <Label text="Title III Funded" styleClass="text-muted"/>
                        <Label fx:id="titleIIIFundedLabel" text="0" styleClass="stat-value-blue"/>
                        <Label fx:id="titleIIIPercentLabel" text="0% of eligible" styleClass="text-muted"/>
                    </VBox>
                </GridPane>

                <!-- Charts Section -->
                <GridPane hgap="20" vgap="20">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="50"/>
                        <ColumnConstraints percentWidth="50"/>
                    </columnConstraints>

                    <!-- Proficiency Levels Chart -->
                    <VBox spacing="15" styleClass="chart-section"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Students by Proficiency Level" styleClass="chart-section-title"/>
                        <BarChart fx:id="proficiencyBarChart" legendVisible="false" prefHeight="300">
                            <xAxis>
                                <CategoryAxis label="Proficiency Level" fx:id="proficiencyXAxis"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis label="Number of Students" fx:id="proficiencyYAxis"/>
                            </yAxis>
                        </BarChart>
                    </VBox>

                    <!-- Program Types Chart -->
                    <VBox spacing="15" styleClass="chart-section"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Students by Program Type" styleClass="chart-section-title"/>
                        <PieChart fx:id="programTypesPieChart" legendVisible="true" prefHeight="300"/>
                    </VBox>

                    <!-- Languages Spoken Chart -->
                    <VBox spacing="15" styleClass="chart-section"
                          GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                        <Label text="Top 10 Languages Spoken" styleClass="chart-section-title"/>
                        <BarChart fx:id="languagesBarChart" legendVisible="false" prefHeight="250">
                            <xAxis>
                                <CategoryAxis label="Language" fx:id="languagesXAxis"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis label="Number of Students" fx:id="languagesYAxis"/>
                            </yAxis>
                        </BarChart>
                    </VBox>
                </GridPane>

                <!-- Alerts & Action Items -->
                <GridPane hgap="20" vgap="20">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="50"/>
                        <ColumnConstraints percentWidth="50"/>
                    </columnConstraints>

                    <!-- Assessments Due -->
                    <VBox spacing="15" styleClass="card"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="âš  Annual Assessments Due" styleClass="alert-title-warning"/>
                        <ListView fx:id="assessmentsDueListView" prefHeight="200"/>
                    </VBox>

                    <!-- Parent Notifications Needed -->
                    <VBox spacing="15" styleClass="card, metric-danger"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="ðŸ“§ Parent Notifications Needed" styleClass="alert-title-danger"/>
                        <ListView fx:id="parentNotificationsListView" prefHeight="200"/>
                    </VBox>

                    <!-- Reclassification Candidates -->
                    <VBox spacing="15" styleClass="card, metric-success"
                          GridPane.columnIndex="0" GridPane.rowIndex="1">
                        <Label text="ðŸŒŸ Reclassification Candidates" styleClass="section-title-success"/>
                        <ListView fx:id="reclassificationCandidatesListView" prefHeight="200"/>
                    </VBox>

                    <!-- Progress Monitoring Overdue -->
                    <VBox spacing="15" styleClass="card, metric-warning"
                          GridPane.columnIndex="1" GridPane.rowIndex="1">
                        <Label text="ðŸ“Š Progress Monitoring Overdue" styleClass="alert-title-orange"/>
                        <ListView fx:id="progressMonitoringOverdueListView" prefHeight="200"/>
                    </VBox>
                </GridPane>

                <!-- ELL Students Table -->
                <VBox spacing="15" styleClass="chart-section">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="ELL Students List" styleClass="chart-section-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="searchField" promptText="Search students..." prefWidth="250"
                                   styleClass="search-field-padded"/>
                        <Button text="Add New ELL Student" onAction="#handleAddStudent"
                                styleClass="button-primary"/>
                    </HBox>

                    <TableView fx:id="ellStudentsTable" prefHeight="400">
                        <columns>
                            <TableColumn fx:id="studentNameColumn" text="Student Name" prefWidth="180"/>
                            <TableColumn fx:id="studentIdColumn" text="Student ID" prefWidth="100"/>
                            <TableColumn fx:id="gradeColumn" text="Grade" prefWidth="70"/>
                            <TableColumn fx:id="statusColumn" text="ELL Status" prefWidth="150"/>
                            <TableColumn fx:id="proficiencyColumn" text="Proficiency" prefWidth="120"/>
                            <TableColumn fx:id="programColumn" text="Program" prefWidth="180"/>
                            <TableColumn fx:id="nativeLanguageColumn" text="Native Language" prefWidth="120"/>
                            <TableColumn fx:id="yearsInProgramColumn" text="Years in Program" prefWidth="120"/>
                            <TableColumn fx:id="lastAssessmentColumn" text="Last Assessment" prefWidth="120"/>
                            <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="150"/>
                        </columns>
                    </TableView>

                    <HBox spacing="10" alignment="CENTER_RIGHT">
                        <Label fx:id="totalStudentsLabel" text="Showing 0 students"/>
                    </HBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" styleClass="footer-bar" alignment="CENTER_LEFT">
            <Label text="Last Refreshed:" styleClass="form-label"/>
            <Label fx:id="lastRefreshedLabel" text="--"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="statusLabel" text="Ready" styleClass="text-muted"/>
        </HBox>
    </bottom>

</BorderPane>
