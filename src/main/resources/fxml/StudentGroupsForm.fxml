<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Font?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.heronix.controller.StudentGroupsFormController"
      spacing="10" styleClass="root-container">

    <padding>
        <Insets top="10" right="10" bottom="10" left="10"/>
    </padding>

    <!-- Header -->
    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="header-section">
        <Label text="Student Groups &amp; Categorization" styleClass="form-title">
            <font>
                <Font name="System Bold" size="24"/>
            </font>
        </Label>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="btnRefresh" text="Refresh" onAction="#handleRefresh" styleClass="btn-secondary"/>
        <Button fx:id="btnNewGroup" text="+ New Group" onAction="#handleNewGroup" styleClass="btn-primary"/>
    </HBox>

    <Separator/>

    <!-- Search and Filter Section -->
    <VBox spacing="8" styleClass="filter-section">
        <Label text="Search &amp; Filter" styleClass="section-header">
            <font>
                <Font name="System Bold" size="14"/>
            </font>
        </Label>

        <HBox spacing="10" alignment="CENTER_LEFT">
            <Label text="Group Name:"/>
            <TextField fx:id="txtSearchName" promptText="Search by name or code..." prefWidth="200"/>

            <Label text="Type:"/>
            <ComboBox fx:id="cmbGroupType" promptText="All Types" prefWidth="180"/>

            <Label text="Status:"/>
            <ComboBox fx:id="cmbGroupStatus" promptText="All Statuses" prefWidth="150"/>

            <Label text="Academic Year:"/>
            <ComboBox fx:id="cmbAcademicYear" promptText="All Years" prefWidth="120"/>

            <Button text="Search" onAction="#handleSearch" styleClass="btn-primary"/>
            <Button text="Clear" onAction="#handleClearSearch" styleClass="btn-secondary"/>
        </HBox>

        <!-- Quick Filters -->
        <HBox spacing="8" alignment="CENTER_LEFT">
            <Label text="Quick Filters:"/>
            <ToggleButton fx:id="toggleHomerooms" text="Homerooms" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleAdvisories" text="Advisories" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleCohorts" text="Cohorts" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleHouses" text="Houses" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleTeams" text="Teams" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleExtracurricular" text="Clubs" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleWithCapacity" text="Has Capacity" onAction="#handleQuickFilter" styleClass="toggle-filter"/>
            <ToggleButton fx:id="toggleFull" text="Full" onAction="#handleQuickFilter" styleClass="toggle-filter-alert"/>
        </HBox>
    </VBox>

    <!-- Main Content - Split Pane -->
    <SplitPane dividerPositions="0.4, 0.7" VBox.vgrow="ALWAYS">

        <!-- Left: Groups List -->
        <VBox spacing="5">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="Groups List" styleClass="section-header">
                    <font>
                        <Font name="System Bold" size="14"/>
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblRecordCount" text="0 groups" styleClass="text-muted"/>
            </HBox>

            <TableView fx:id="tblGroups" VBox.vgrow="ALWAYS">
                <columns>
                    <TableColumn fx:id="colGroupName" text="Group Name" prefWidth="180"/>
                    <TableColumn fx:id="colType" text="Type" prefWidth="120"/>
                    <TableColumn fx:id="colStatus" text="Status" prefWidth="100"/>
                    <TableColumn fx:id="colEnrollment" text="Enrollment" prefWidth="100"/>
                    <TableColumn fx:id="colCapacity" text="Capacity" prefWidth="80"/>
                    <TableColumn fx:id="colAdvisor" text="Advisor" prefWidth="150"/>
                </columns>
            </TableView>

            <!-- Action Buttons -->
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <Button fx:id="btnView" text="View" onAction="#handleViewDetails" disable="true" styleClass="btn-secondary"/>
                <Button fx:id="btnEdit" text="Edit" onAction="#handleEdit" disable="true" styleClass="btn-secondary"/>
                <Button fx:id="btnManageStudents" text="Manage Students" onAction="#handleManageStudents" disable="true" styleClass="btn-primary"/>
                <Button fx:id="btnClone" text="Clone" onAction="#handleClone" disable="true" styleClass="btn-secondary"/>
                <Button fx:id="btnDelete" text="Delete" onAction="#handleDelete" disable="true" styleClass="btn-danger"/>
            </HBox>
        </VBox>

        <!-- Middle: Group Details -->
        <ScrollPane fitToWidth="true" fitToHeight="true">
            <VBox fx:id="detailsPanel" spacing="15" styleClass="details-panel">
                <padding>
                    <Insets top="10" right="10" bottom="10" left="10"/>
                </padding>

                    <!-- Basic Information -->
                    <VBox spacing="8" styleClass="info-section">
                        <Label text="Basic Information" styleClass="section-header-info">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Group Name:" GridPane.rowIndex="0" GridPane.columnIndex="0" styleClass="form-label"/>
                            <TextField fx:id="txtGroupName" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Group Code:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtGroupCode" GridPane.rowIndex="1" GridPane.columnIndex="1" prefWidth="150"/>

                            <Label text="Group Type:" GridPane.rowIndex="2" GridPane.columnIndex="0" styleClass="form-label"/>
                            <ComboBox fx:id="cmbType" GridPane.rowIndex="2" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Status:" GridPane.rowIndex="3" GridPane.columnIndex="0" styleClass="form-label"/>
                            <ComboBox fx:id="cmbStatus" GridPane.rowIndex="3" GridPane.columnIndex="1" prefWidth="200"/>

                            <Label text="Academic Year:" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtAcademicYear" GridPane.rowIndex="4" GridPane.columnIndex="1" promptText="2024-2025" prefWidth="150"/>

                            <Label text="Grade Level:" GridPane.rowIndex="5" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtGradeLevel" GridPane.rowIndex="5" GridPane.columnIndex="1" prefWidth="100"/>
                        </GridPane>

                        <Label text="Description:"/>
                        <TextArea fx:id="txtDescription" promptText="Enter group description..." prefRowCount="3"/>
                    </VBox>

                    <!-- Capacity & Enrollment -->
                    <VBox spacing="8" styleClass="info-section">
                        <Label text="Capacity &amp; Enrollment" styleClass="section-header-success">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Max Capacity:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtMaxCapacity" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="100"/>

                            <Label text="Current Enrollment:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <Label fx:id="lblCurrentEnrollment" text="0" GridPane.rowIndex="1" GridPane.columnIndex="1"
                                   styleClass="stat-value-16-blue-primary"/>

                            <Label text="Available Spots:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <Label fx:id="lblAvailableSpots" text="0" GridPane.rowIndex="2" GridPane.columnIndex="1"
                                   styleClass="stat-value-16-green-primary"/>

                            <Label text="Accepting Members:" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                            <CheckBox fx:id="chkAcceptingMembers" GridPane.rowIndex="3" GridPane.columnIndex="1"/>
                        </GridPane>
                    </VBox>

                    <!-- Staff Assignments -->
                    <VBox spacing="8" styleClass="info-section">
                        <Label text="Staff Assignments" styleClass="section-header-warning">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Primary Advisor:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <ComboBox fx:id="cmbPrimaryAdvisor" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Secondary Advisor:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <ComboBox fx:id="cmbSecondaryAdvisor" GridPane.rowIndex="1" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Homeroom Teacher:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <ComboBox fx:id="cmbHomeroomTeacher" GridPane.rowIndex="2" GridPane.columnIndex="1" prefWidth="250"/>
                        </GridPane>
                    </VBox>

                    <!-- Meeting Information -->
                    <VBox spacing="8" styleClass="info-section">
                        <Label text="Meeting Information" styleClass="section-header">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Meeting Location:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtMeetingLocation" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Meeting Schedule:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtMeetingSchedule" GridPane.rowIndex="1" GridPane.columnIndex="1"
                                       promptText="e.g., Daily 8:00-8:30 AM" prefWidth="250"/>
                        </GridPane>

                        <Label text="Meeting Notes:"/>
                        <TextArea fx:id="txtMeetingNotes" promptText="Additional meeting information..." prefRowCount="2"/>
                    </VBox>

                    <!-- House System (only for House groups) -->
                    <VBox fx:id="sectionHouse" spacing="8" managed="false" visible="false" styleClass="info-section">
                        <Label text="House System" styleClass="section-header">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="House Name:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtHouseName" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="200"/>

                            <Label text="House Color:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtHouseColor" GridPane.rowIndex="1" GridPane.columnIndex="1" prefWidth="150"/>

                            <Label text="House Mascot:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtHouseMascot" GridPane.rowIndex="2" GridPane.columnIndex="1" prefWidth="200"/>

                            <Label text="House Points:" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                            <HBox spacing="10" GridPane.rowIndex="3" GridPane.columnIndex="1">
                                <Label fx:id="lblHousePoints" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold;"/>
                                <Button text="+10" onAction="#handleAddPoints" styleClass="btn-primary"/>
                                <Button text="-10" onAction="#handleSubtractPoints" styleClass="btn-danger"/>
                                <Button text="Reset" onAction="#handleResetPoints" styleClass="btn-secondary"/>
                            </HBox>
                        </GridPane>
                    </VBox>

                    <!-- Team Details (only for Team groups) -->
                    <VBox fx:id="sectionTeam" spacing="8" managed="false" visible="false" styleClass="info-section">
                        <Label text="Team Details" styleClass="section-header">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Team Type:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <ComboBox fx:id="cmbTeamType" GridPane.rowIndex="0" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Sport/Activity:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtSportActivity" GridPane.rowIndex="1" GridPane.columnIndex="1" prefWidth="250"/>

                            <Label text="Competition Level:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <TextField fx:id="txtCompetitionLevel" GridPane.rowIndex="2" GridPane.columnIndex="1"
                                       promptText="Varsity, JV, etc." prefWidth="150"/>
                        </GridPane>
                    </VBox>

                    <!-- Administrative Notes -->
                    <VBox spacing="8" styleClass="info-section">
                        <Label text="Administrative Information" styleClass="section-header">
                            <font>
                                <Font name="System Bold" size="13"/>
                            </font>
                        </Label>

                        <Label text="Administrative Notes:"/>
                        <TextArea fx:id="txtAdministrativeNotes" promptText="Internal notes..." prefRowCount="3"/>

                        <GridPane hgap="10" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="35"/>
                                <ColumnConstraints percentWidth="65"/>
                            </columnConstraints>

                            <Label text="Visible to Parents:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <CheckBox fx:id="chkVisibleToParents" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                            <Label text="Visible to Students:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <CheckBox fx:id="chkVisibleToStudents" GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                        </GridPane>
                    </VBox>

                    <!-- Action Buttons -->
                    <HBox spacing="10" alignment="CENTER">
                        <Button fx:id="btnSave" text="Save" onAction="#handleSave" styleClass="btn-primary" prefWidth="100"/>
                        <Button fx:id="btnCancel" text="Cancel" onAction="#handleCancel" styleClass="btn-secondary" prefWidth="100"/>
                    </HBox>

            </VBox>
        </ScrollPane>

        <!-- Right: Student Membership -->
        <VBox spacing="5">
            <HBox alignment="CENTER_LEFT" spacing="10">
                <Label text="Student Membership" styleClass="section-header">
                    <font>
                        <Font name="System Bold" size="14"/>
                    </font>
                </Label>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lblMemberCount" text="0 students" styleClass="text-muted"/>
            </HBox>

            <!-- Search for Students -->
            <HBox spacing="10">
                <TextField fx:id="txtSearchStudent" promptText="Search students to add..." HBox.hgrow="ALWAYS"/>
                <Button text="Add" onAction="#handleAddStudent" styleClass="btn-primary"/>
            </HBox>

            <!-- Members List -->
            <ListView fx:id="lstMembers" VBox.vgrow="ALWAYS"/>

            <!-- Membership Actions -->
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <Button text="Remove Selected" onAction="#handleRemoveStudent" styleClass="btn-danger"/>
                <Button text="Bulk Add" onAction="#handleBulkAdd" styleClass="btn-secondary"/>
                <Button text="Export List" onAction="#handleExportList" styleClass="btn-secondary"/>
            </HBox>
        </VBox>

    </SplitPane>

    <Separator/>

    <!-- Status Bar -->
    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="status-bar">
        <Label fx:id="lblStatusMessage" text="Ready" styleClass="status-label"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Label fx:id="lblUser" text="User: Admin" styleClass="status-label"/>
    </HBox>

</VBox>
