<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.AttendanceReportsController"
            stylesheets="@../css/application.css"
            prefWidth="1400" prefHeight="900">

    <!-- Top: Header -->
    <top>
        <VBox spacing="15" style="-fx-background-color: #1976d2; -fx-padding: 20;">
            <Label text="Attendance Reports &amp; Analytics"
                   style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            <Label text="Comprehensive attendance reporting, analytics, and state/federal compliance reporting"
                   style="-fx-font-size: 13px; -fx-text-fill: white;"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.25" style="-fx-background-color: #f5f5f5;">

            <!-- Left: Report Selection & Filters -->
            <VBox spacing="20" style="-fx-padding: 15; -fx-background-color: white;">

                <!-- Report Type Selection -->
                <VBox spacing="10">
                    <Label text="Report Type" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                    <Separator/>

                    <ComboBox fx:id="reportTypeComboBox" promptText="Select report type..." maxWidth="Infinity"/>
                </VBox>

                <!-- Date Range Filters -->
                <VBox spacing="10" style="-fx-background-color: #e3f2fd; -fx-padding: 15; -fx-border-color: #90caf9; -fx-border-width: 2;">
                    <Label text="Date Range" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>

                    <Label text="Start Date:" style="-fx-font-weight: bold;"/>
                    <DatePicker fx:id="startDatePicker" promptText="Start date" maxWidth="Infinity"/>

                    <Label text="End Date:" style="-fx-font-weight: bold;"/>
                    <DatePicker fx:id="endDatePicker" promptText="End date" maxWidth="Infinity"/>

                    <HBox spacing="5">
                        <Button text="Today" onAction="#handleToday" style="-fx-font-size: 10px; -fx-padding: 5;"/>
                        <Button text="This Week" onAction="#handleThisWeek" style="-fx-font-size: 10px; -fx-padding: 5;"/>
                        <Button text="This Month" onAction="#handleThisMonth" style="-fx-font-size: 10px; -fx-padding: 5;"/>
                    </HBox>

                    <HBox spacing="5">
                        <Button text="This Quarter" onAction="#handleThisQuarter" style="-fx-font-size: 10px; -fx-padding: 5;"/>
                        <Button text="This Year" onAction="#handleThisYear" style="-fx-font-size: 10px; -fx-padding: 5;"/>
                    </HBox>
                </VBox>

                <!-- Student Filters -->
                <VBox spacing="10">
                    <Label text="Student Filters" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                    <Label text="Grade Level:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="gradeLevelComboBox" promptText="All Grades" maxWidth="Infinity"/>

                    <Label text="Homeroom:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="homeroomComboBox" promptText="All Homerooms" maxWidth="Infinity"/>

                    <Label text="Student:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="studentComboBox" promptText="All Students" maxWidth="Infinity" editable="true"/>
                </VBox>

                <!-- Attendance Filters -->
                <VBox spacing="10" style="-fx-background-color: #fff3e0; -fx-padding: 15; -fx-border-color: #ffcc80; -fx-border-width: 2;">
                    <Label text="Attendance Filters" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>

                    <CheckBox fx:id="includeAbsentCheckBox" text="Absences" selected="true"/>
                    <CheckBox fx:id="includeTardyCheckBox" text="Tardies" selected="true"/>
                    <CheckBox fx:id="includeExcusedCheckBox" text="Excused" selected="true"/>
                    <CheckBox fx:id="includeUnexcusedCheckBox" text="Unexcused" selected="true"/>
                    <CheckBox fx:id="includeEarlyDepartureCheckBox" text="Early Departures"/>
                </VBox>

                <!-- Action Buttons -->
                <VBox spacing="10">
                    <Button fx:id="generateButton" text="Generate Report" onAction="#handleGenerateReport"
                            style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12; -fx-cursor: hand;" maxWidth="Infinity"/>

                    <Button fx:id="exportButton" text="Export to Excel" onAction="#handleExportExcel"
                            style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>

                    <Button fx:id="exportPdfButton" text="Export to PDF" onAction="#handleExportPdf"
                            style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>

                    <Button fx:id="printButton" text="Print Report" onAction="#handlePrint"
                            style="-fx-background-color: #9e9e9e; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                </VBox>

            </VBox>

            <!-- Right: Report Content -->
            <BorderPane style="-fx-background-color: white;">

                <!-- Report Header -->
                <top>
                    <VBox spacing="15" style="-fx-padding: 20; -fx-background-color: #fafafa; -fx-border-color: #e0e0e0; -fx-border-width: 0 0 1 0;">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox HBox.hgrow="ALWAYS">
                                <Label fx:id="reportTitleLabel" text="Select a report type to begin"
                                       style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                                <Label fx:id="reportSubtitleLabel" text=""
                                       style="-fx-font-size: 12px; -fx-text-fill: #757575;"/>
                            </VBox>

                            <VBox spacing="5" alignment="CENTER_RIGHT">
                                <Label fx:id="generatedDateLabel" text="" style="-fx-font-size: 10px; -fx-text-fill: #757575;"/>
                                <Label fx:id="recordCountLabel" text="" style="-fx-font-size: 12px; -fx-font-weight: bold;"/>
                            </VBox>
                        </HBox>

                        <!-- Summary Statistics -->
                        <HBox spacing="20" fx:id="summaryStatsBox" managed="false" visible="false">
                            <VBox spacing="5" style="-fx-background-color: #e8f5e9; -fx-padding: 10; -fx-border-color: #4caf50; -fx-border-width: 2;">
                                <Label text="Total Present" style="-fx-font-size: 10px; -fx-text-fill: #2e7d32;"/>
                                <Label fx:id="totalPresentLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            </VBox>

                            <VBox spacing="5" style="-fx-background-color: #ffebee; -fx-padding: 10; -fx-border-color: #f44336; -fx-border-width: 2;">
                                <Label text="Total Absent" style="-fx-font-size: 10px; -fx-text-fill: #c62828;"/>
                                <Label fx:id="totalAbsentLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                            </VBox>

                            <VBox spacing="5" style="-fx-background-color: #fff9c4; -fx-padding: 10; -fx-border-color: #fbc02d; -fx-border-width: 2;">
                                <Label text="Total Tardy" style="-fx-font-size: 10px; -fx-text-fill: #f57f17;"/>
                                <Label fx:id="totalTardyLabel" text="0" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #f57f17;"/>
                            </VBox>

                            <VBox spacing="5" style="-fx-background-color: #e3f2fd; -fx-padding: 10; -fx-border-color: #2196f3; -fx-border-width: 2;">
                                <Label text="Attendance Rate" style="-fx-font-size: 10px; -fx-text-fill: #0d47a1;"/>
                                <Label fx:id="attendanceRateLabel" text="0%" style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </top>

                <!-- Report Content Area -->
                <center>
                    <TabPane fx:id="reportTabPane" tabClosingPolicy="UNAVAILABLE" style="-fx-padding: 15;">

                        <!-- Data Table Tab -->
                        <Tab text="Data Table">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" style="-fx-padding: 15;">
                                    <TableView fx:id="reportTableView" VBox.vgrow="ALWAYS">
                                        <!-- Columns will be dynamically added based on report type -->
                                    </TableView>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Summary Tab -->
                        <Tab text="Summary">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="20" style="-fx-padding: 20;">
                                    <TextArea fx:id="summaryTextArea" editable="false" wrapText="true" prefRowCount="20"
                                              style="-fx-font-family: 'Courier New'; -fx-font-size: 12px;"/>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Charts Tab -->
                        <Tab text="Charts">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="20" style="-fx-padding: 20;">
                                    <StackPane fx:id="chartContainer" minHeight="400"/>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Interventions Needed Tab -->
                        <Tab text="Interventions Needed">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" style="-fx-padding: 15;">

                                    <!-- Chronic Absenteeism Alerts -->
                                    <VBox spacing="10" style="-fx-background-color: #ffebee; -fx-padding: 15; -fx-border-color: #ef5350; -fx-border-width: 2;">
                                        <Label text="Chronic Absenteeism (&gt;= 10% absent)" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                                        <ListView fx:id="chronicAbsenteeismList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Truancy Alerts -->
                                    <VBox spacing="10" style="-fx-background-color: #fff3e0; -fx-padding: 15; -fx-border-color: #ff9800; -fx-border-width: 2;">
                                        <Label text="Truancy Risk (Unexcused Absences)" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>
                                        <ListView fx:id="truancyRiskList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Excessive Tardies -->
                                    <VBox spacing="10" style="-fx-background-color: #fff9c4; -fx-padding: 15; -fx-border-color: #fbc02d; -fx-border-width: 2;">
                                        <Label text="Excessive Tardies (&gt;= 5 tardies)" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #f57f17;"/>
                                        <ListView fx:id="excessiveTardiesList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Early Warning -->
                                    <VBox spacing="10" style="-fx-background-color: #e3f2fd; -fx-padding: 15; -fx-border-color: #2196f3; -fx-border-width: 2;">
                                        <Label text="Early Warning (3+ absences)" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>
                                        <ListView fx:id="earlyWarningList" prefHeight="150"/>
                                    </VBox>

                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Perfect Attendance Tab -->
                        <Tab text="Perfect Attendance">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" style="-fx-padding: 15;">

                                    <VBox spacing="10" style="-fx-background-color: #e8f5e9; -fx-padding: 15; -fx-border-color: #4caf50; -fx-border-width: 2;">
                                        <Label text="Perfect Attendance (No absences, max 2 tardies)" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                                        <TableView fx:id="perfectAttendanceTableView" prefHeight="400">
                                            <columns>
                                                <TableColumn fx:id="perfectStudentIdColumn" text="Student ID" prefWidth="100"/>
                                                <TableColumn fx:id="perfectStudentNameColumn" text="Student Name" prefWidth="200"/>
                                                <TableColumn fx:id="perfectGradeColumn" text="Grade" prefWidth="80"/>
                                                <TableColumn fx:id="perfectHomeroomColumn" text="Homeroom" prefWidth="120"/>
                                                <TableColumn fx:id="perfectDaysColumn" text="Days Present" prefWidth="100"/>
                                                <TableColumn fx:id="perfectTardiesColumn" text="Tardies" prefWidth="80"/>
                                                <TableColumn fx:id="perfectStreakColumn" text="Streak" prefWidth="80"/>
                                            </columns>
                                        </TableView>
                                    </VBox>

                                </VBox>
                            </ScrollPane>
                        </Tab>

                    </TabPane>
                </center>

            </BorderPane>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #fafafa; -fx-padding: 10; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="processingTimeLabel" text="" style="-fx-font-size: 10px; -fx-text-fill: #757575;"/>
        </HBox>
    </bottom>

</BorderPane>
