<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.AttendanceReportsController"
            prefWidth="1400" prefHeight="900">


    <!-- Top: Header -->
    <top>
        <VBox spacing="15" styleClass="card">
            <Label text="Attendance Reports &amp; Analytics"
                   styleClass="page-title-white"/>
            <Label text="Comprehensive attendance reporting, analytics, and state/federal compliance reporting"
                   styleClass="text-white"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.25" styleClass="main-container">

            <!-- Left: Report Selection & Filters -->
            <VBox spacing="20" styleClass="padding-15-white">

                <!-- Report Type Selection -->
                <VBox spacing="10">
                    <Label text="Report Type" styleClass="section-title"/>
                    <Separator/>

                    <ComboBox fx:id="reportTypeComboBox" promptText="Select report type..." maxWidth="Infinity"/>
                </VBox>

                <!-- Date Range Filters -->
                <VBox spacing="10" styleClass="card, metric-info">
                    <Label text="Date Range" styleClass="label-14-bold-blue"/>

                    <Label text="Start Date:" styleClass="form-label"/>
                    <DatePicker fx:id="startDatePicker" promptText="Start date" maxWidth="Infinity"/>

                    <Label text="End Date:" styleClass="form-label"/>
                    <DatePicker fx:id="endDatePicker" promptText="End date" maxWidth="Infinity"/>

                    <HBox spacing="5">
                        <Button text="Today" onAction="#handleToday" styleClass="button-small"/>
                        <Button text="This Week" onAction="#handleThisWeek" styleClass="button-small"/>
                        <Button text="This Month" onAction="#handleThisMonth" styleClass="button-small"/>
                    </HBox>

                    <HBox spacing="5">
                        <Button text="This Quarter" onAction="#handleThisQuarter" styleClass="button-small"/>
                        <Button text="This Year" onAction="#handleThisYear" styleClass="button-small"/>
                    </HBox>
                </VBox>

                <!-- Student Filters -->
                <VBox spacing="10">
                    <Label text="Student Filters" styleClass="label-14-bold"/>

                    <Label text="Grade Level:" styleClass="label-11-bold"/>
                    <ComboBox fx:id="gradeLevelComboBox" promptText="All Grades" maxWidth="Infinity"/>

                    <Label text="Homeroom:" styleClass="label-11-bold"/>
                    <ComboBox fx:id="homeroomComboBox" promptText="All Homerooms" maxWidth="Infinity"/>

                    <Label text="Student:" styleClass="label-11-bold"/>
                    <ComboBox fx:id="studentComboBox" promptText="All Students" maxWidth="Infinity" editable="true"/>
                </VBox>

                <!-- Attendance Filters -->
                <VBox spacing="10" styleClass="card, metric-warning">
                    <Label text="Attendance Filters" styleClass="label-14-bold-orange"/>

                    <CheckBox fx:id="includeAbsentCheckBox" text="Absences" selected="true"/>
                    <CheckBox fx:id="includeTardyCheckBox" text="Tardies" selected="true"/>
                    <CheckBox fx:id="includeExcusedCheckBox" text="Excused" selected="true"/>
                    <CheckBox fx:id="includeUnexcusedCheckBox" text="Unexcused" selected="true"/>
                    <CheckBox fx:id="includeEarlyDepartureCheckBox" text="Early Departures"/>
                </VBox>

                <!-- Action Buttons -->
                <VBox spacing="10">
                    <Button fx:id="generateButton" text="Generate Report" onAction="#handleGenerateReport"
                            styleClass="button-primary" maxWidth="Infinity"/>

                    <Button fx:id="exportButton" text="Export to Excel" onAction="#handleExportExcel"
                            styleClass="button-primary" maxWidth="Infinity"/>

                    <Button fx:id="exportPdfButton" text="Export to PDF" onAction="#handleExportPdf"
                            styleClass="header-danger" maxWidth="Infinity"/>

                    <Button fx:id="printButton" text="Print Report" onAction="#handlePrint"
                            styleClass="button-primary" maxWidth="Infinity"/>
                </VBox>

            </VBox>

            <!-- Right: Report Content -->
            <BorderPane styleClass="card">

                <!-- Report Header -->
                <top>
                    <VBox spacing="15" styleClass="card">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <VBox HBox.hgrow="ALWAYS">
                                <Label fx:id="reportTitleLabel" text="Select a report type to begin"
                                       styleClass="section-title"/>
                                <Label fx:id="reportSubtitleLabel" text=""
                                       styleClass="text-muted"/>
                            </VBox>

                            <VBox spacing="5" alignment="CENTER_RIGHT">
                                <Label fx:id="generatedDateLabel" text="" styleClass="text-muted"/>
                                <Label fx:id="recordCountLabel" text="" styleClass="label-12-bold"/>
                            </VBox>
                        </HBox>

                        <!-- Summary Statistics -->
                        <HBox spacing="20" fx:id="summaryStatsBox" managed="false" visible="false">
                            <VBox spacing="5" styleClass="card, metric-success">
                                <Label text="Total Present" styleClass="text-muted"/>
                                <Label fx:id="totalPresentLabel" text="0" styleClass="stat-value-20-green-dark"/>
                            </VBox>

                            <VBox spacing="5" styleClass="card, metric-danger">
                                <Label text="Total Absent" styleClass="text-muted"/>
                                <Label fx:id="totalAbsentLabel" text="0" styleClass="stat-value-20-red-dark"/>
                            </VBox>

                            <VBox spacing="5" styleClass="card">
                                <Label text="Total Tardy" styleClass="text-muted"/>
                                <Label fx:id="totalTardyLabel" text="0" styleClass="stat-value-20-warning"/>
                            </VBox>

                            <VBox spacing="5" styleClass="card, metric-info">
                                <Label text="Attendance Rate" styleClass="text-muted"/>
                                <Label fx:id="attendanceRateLabel" text="0%" styleClass="stat-value-20-blue-dark"/>
                            </VBox>
                        </HBox>
                    </VBox>
                </top>

                <!-- Report Content Area -->
                <center>
                    <TabPane fx:id="reportTabPane" tabClosingPolicy="UNAVAILABLE" styleClass="content-padding-15">

                        <!-- Data Table Tab -->
                        <Tab text="Data Table">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" styleClass="content-padding-15">
                                    <TableView fx:id="reportTableView" VBox.vgrow="ALWAYS">
                                        <!-- Columns will be dynamically added based on report type -->
                                    </TableView>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Summary Tab -->
                        <Tab text="Summary">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="20" styleClass="padding-20">
                                    <TextArea fx:id="summaryTextArea" editable="false" wrapText="true" prefRowCount="20"
                                              styleClass="text-area-monospace"/>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Charts Tab -->
                        <Tab text="Charts">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="20" styleClass="padding-20">
                                    <StackPane fx:id="chartContainer" minHeight="400"/>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Interventions Needed Tab -->
                        <Tab text="Interventions Needed">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" styleClass="content-padding-15">

                                    <!-- Chronic Absenteeism Alerts -->
                                    <VBox spacing="10" styleClass="card, metric-danger">
                                        <Label text="Chronic Absenteeism (&gt;= 10% absent)" styleClass="label-14-bold-red"/>
                                        <ListView fx:id="chronicAbsenteeismList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Truancy Alerts -->
                                    <VBox spacing="10" styleClass="card, metric-warning">
                                        <Label text="Truancy Risk (Unexcused Absences)" styleClass="label-14-bold-orange"/>
                                        <ListView fx:id="truancyRiskList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Excessive Tardies -->
                                    <VBox spacing="10" styleClass="card">
                                        <Label text="Excessive Tardies (&gt;= 5 tardies)" styleClass="label-14-bold-warning"/>
                                        <ListView fx:id="excessiveTardiesList" prefHeight="150"/>
                                    </VBox>

                                    <!-- Early Warning -->
                                    <VBox spacing="10" styleClass="card, metric-info">
                                        <Label text="Early Warning (3+ absences)" styleClass="label-14-bold-blue"/>
                                        <ListView fx:id="earlyWarningList" prefHeight="150"/>
                                    </VBox>

                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Perfect Attendance Tab -->
                        <Tab text="Perfect Attendance">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" styleClass="content-padding-15">

                                    <VBox spacing="10" styleClass="card, metric-success">
                                        <Label text="Perfect Attendance (No absences, max 2 tardies)" styleClass="label-14-bold-green"/>
                                        <TableView fx:id="perfectAttendanceTableView" prefHeight="400">
                                            <columns>
                                                <TableColumn fx:id="perfectStudentIdColumn" text="Student ID" prefWidth="100"/>
                                                <TableColumn fx:id="perfectStudentNameColumn" text="Student Name" prefWidth="200"/>
                                                <TableColumn fx:id="perfectGradeColumn" text="Grade" prefWidth="80"/>
                                                <TableColumn fx:id="perfectHomeroomColumn" text="Homeroom" prefWidth="120"/>
                                                <TableColumn fx:id="perfectDaysColumn" text="Days Present" prefWidth="100"/>
                                                <TableColumn fx:id="perfectTardiesColumn" text="Tardies" prefWidth="80"/>
                                                <TableColumn fx:id="perfectStreakColumn" text="Streak" prefWidth="80"/>
                                            </columns>
                                        </TableView>
                                    </VBox>

                                </VBox>
                            </ScrollPane>
                        </Tab>

                    </TabPane>
                </center>

            </BorderPane>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
            <Label fx:id="statusLabel" text="Ready" styleClass="label-11"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="processingTimeLabel" text="" styleClass="text-muted"/>
        </HBox>
    </bottom>

</BorderPane>
