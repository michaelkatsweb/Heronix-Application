<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.TransportationManagementController"
            prefWidth="1700" prefHeight="950">


    <!-- Top: Header -->
    <top>
        <VBox spacing="15" styleClass="header-gradient">
            <HBox spacing="15" alignment="CENTER_LEFT">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Transportation Management"
                           styleClass="page-title-white"/>
                    <Label text="Manage bus routes, student assignments, drivers, and real-time tracking"
                           styleClass="text-white"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="5" alignment="CENTER_RIGHT">
                    <Button text="+ Add Bus Route" onAction="#handleAddBusRoute"
                            styleClass="button-primary"/>
                    <Button text="ðŸ“ Live Tracking" onAction="#handleLiveTracking"
                            styleClass="button-primary"/>
                </VBox>
            </HBox>

            <!-- Stats Bar -->
            <HBox spacing="15">
                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      styleClass="card-transparent">
                    <Label text="Total Buses" styleClass="text-white"/>
                    <Label fx:id="totalBusesLabel" text="42"
                           styleClass="text-white"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      styleClass="card-transparent">
                    <Label text="Active Routes" styleClass="text-white"/>
                    <Label fx:id="activeRoutesLabel" text="38"
                           styleClass="text-white"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      styleClass="card-transparent">
                    <Label text="Students Riding" styleClass="text-white"/>
                    <Label fx:id="studentsRidingLabel" text="1,248"
                           styleClass="text-white"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      styleClass="card-transparent">
                    <Label text="Drivers" styleClass="text-white"/>
                    <Label fx:id="driversLabel" text="45"
                           styleClass="text-white"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      styleClass="card-transparent">
                    <Label text="On Time %" styleClass="text-white"/>
                    <Label fx:id="onTimePercentLabel" text="94.5%"
                           styleClass="text-white"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <TabPane styleClass="main-container" tabClosingPolicy="UNAVAILABLE">

            <!-- Bus Routes Tab -->
            <Tab text="ðŸšŒ Bus Routes">
                <SplitPane dividerPositions="0.4">
                    <!-- Route List -->
                    <VBox spacing="15" styleClass="form-panel">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Routes" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <TextField fx:id="routeSearchField" promptText="Search routes..." prefWidth="200"/>
                        </HBox>

                        <HBox spacing="10">
                            <ComboBox fx:id="routeTypeFilterComboBox" prefWidth="140">
                                <items>
                                    <String fx:value="All Routes"/>
                                    <String fx:value="Morning Only"/>
                                    <String fx:value="Afternoon Only"/>
                                    <String fx:value="Both"/>
                                    <String fx:value="Special Needs"/>
                                </items>
                            </ComboBox>
                            <ComboBox fx:id="routeStatusFilterComboBox" prefWidth="120">
                                <items>
                                    <String fx:value="All Status"/>
                                    <String fx:value="Active"/>
                                    <String fx:value="Inactive"/>
                                    <String fx:value="Maintenance"/>
                                </items>
                            </ComboBox>
                        </HBox>

                        <ListView fx:id="routesListView" VBox.vgrow="ALWAYS">
                            <placeholder>
                                <Label text="No routes found" styleClass="text-muted"/>
                            </placeholder>
                        </ListView>

                        <Button text="+ Create New Route" onAction="#handleCreateRoute"
                                styleClass="button-primary"
                                maxWidth="Infinity"/>
                    </VBox>

                    <!-- Route Details -->
                    <VBox spacing="15" styleClass="form-panel">
                        <Label text="Route Details" styleClass="section-title"/>

                        <VBox spacing="10" styleClass="card, metric-info">
                            <Label fx:id="routeNameLabel" text="Select a route to view details"
                                   styleClass="section-title-14-blue-600"/>
                            <HBox spacing="10">
                                <Label text="Bus:" style="-fx-font-weight: bold; -fx-min-width: 80;"/>
                                <Label fx:id="routeBusLabel" text="â€”"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Driver:" style="-fx-font-weight: bold; -fx-min-width: 80;"/>
                                <Label fx:id="routeDriverLabel" text="â€”"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Students:" style="-fx-font-weight: bold; -fx-min-width: 80;"/>
                                <Label fx:id="routeStudentsLabel" text="â€”"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Capacity:" style="-fx-font-weight: bold; -fx-min-width: 80;"/>
                                <Label fx:id="routeCapacityLabel" text="â€”"/>
                            </HBox>
                        </VBox>

                        <Label text="Route Stops" styleClass="form-label"/>
                        <TableView fx:id="stopsTableView" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="stopOrderColumn" text="#" prefWidth="40"/>
                                <TableColumn fx:id="stopLocationColumn" text="Location" prefWidth="200"/>
                                <TableColumn fx:id="stopTimeColumn" text="Time" prefWidth="80"/>
                                <TableColumn fx:id="stopStudentsColumn" text="Students" prefWidth="70"/>
                            </columns>
                            <placeholder>
                                <Label text="No stops" styleClass="text-muted"/>
                            </placeholder>
                        </TableView>

                        <HBox spacing="10">
                            <Button text="Edit Route" onAction="#handleEditRoute"
                                    styleClass="button-primary"
                                    HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                            <Button text="View Map" onAction="#handleViewMap"
                                    styleClass="button-primary"
                                    HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                            <Button text="Print Schedule" onAction="#handlePrintSchedule"
                                    style="-fx-padding: 8 15; -fx-cursor: hand;"
                                    HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                        </HBox>
                    </VBox>
                </SplitPane>
            </Tab>

            <!-- Student Assignments Tab -->
            <Tab text="ðŸ‘¥ Student Assignments">
                <VBox spacing="15" styleClass="form-panel">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Student Bus Assignments" styleClass="section-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <TextField fx:id="studentSearchField" promptText="Search students..." prefWidth="250"/>
                        <Button text="ðŸ”" onAction="#handleSearchStudents"
                                style="-fx-padding: 6 12; -fx-cursor: hand;"/>
                    </HBox>

                    <HBox spacing="10">
                        <ComboBox fx:id="gradeFilterComboBox" prefWidth="120">
                            <items>
                                <String fx:value="All Grades"/>
                                <String fx:value="Grade K"/>
                                <String fx:value="Grade 1"/>
                                <String fx:value="Grade 2"/>
                                <String fx:value="Grade 3"/>
                                <String fx:value="Grade 4"/>
                                <String fx:value="Grade 5"/>
                            </items>
                        </ComboBox>
                        <ComboBox fx:id="routeAssignmentFilterComboBox" prefWidth="150">
                            <items>
                                <String fx:value="All Students"/>
                                <String fx:value="Assigned"/>
                                <String fx:value="Not Assigned"/>
                                <String fx:value="Special Needs"/>
                            </items>
                        </ComboBox>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“¥ Import Assignments" onAction="#handleImportAssignments"
                                style="-fx-padding: 6 12; -fx-cursor: hand;"/>
                        <Button text="ðŸ“¤ Export List" onAction="#handleExportAssignments"
                                style="-fx-padding: 6 12; -fx-cursor: hand;"/>
                    </HBox>

                    <TableView fx:id="studentAssignmentsTableView" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="studentNameColumn" text="Student Name" prefWidth="200"/>
                            <TableColumn fx:id="studentGradeColumn" text="Grade" prefWidth="60"/>
                            <TableColumn fx:id="assignedRouteColumn" text="Route" prefWidth="100"/>
                            <TableColumn fx:id="pickupStopColumn" text="Pickup Stop" prefWidth="200"/>
                            <TableColumn fx:id="dropoffStopColumn" text="Dropoff Stop" prefWidth="200"/>
                            <TableColumn fx:id="guardianColumn" text="Guardian" prefWidth="150"/>
                            <TableColumn fx:id="phoneColumn" text="Phone" prefWidth="120"/>
                            <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="100"/>
                        </columns>
                        <placeholder>
                            <Label text="No students found" styleClass="text-muted"/>
                        </placeholder>
                    </TableView>

                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label fx:id="assignmentStatsLabel" text="Showing 0 students"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="Assign Selected" onAction="#handleAssignStudents"
                                styleClass="button-primary"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- Drivers Tab -->
            <Tab text="ðŸ‘¨â€âœˆï¸ Drivers">
                <SplitPane dividerPositions="0.5">
                    <!-- Driver List -->
                    <VBox spacing="15" styleClass="form-panel">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Label text="Drivers" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Button text="+ Add Driver" onAction="#handleAddDriver"
                                    styleClass="button-primary"/>
                        </HBox>

                        <TableView fx:id="driversTableView" VBox.vgrow="ALWAYS">
                            <columns>
                                <TableColumn fx:id="driverNameColumn" text="Name" prefWidth="150"/>
                                <TableColumn fx:id="driverIdColumn" text="ID" prefWidth="80"/>
                                <TableColumn fx:id="licenseColumn" text="License" prefWidth="100"/>
                                <TableColumn fx:id="assignedBusColumn" text="Assigned Bus" prefWidth="100"/>
                                <TableColumn fx:id="statusColumn" text="Status" prefWidth="100"/>
                            </columns>
                            <placeholder>
                                <Label text="No drivers" styleClass="text-muted"/>
                            </placeholder>
                        </TableView>
                    </VBox>

                    <!-- Driver Details -->
                    <VBox spacing="15" styleClass="form-panel">
                        <Label text="Driver Details" styleClass="section-title"/>

                        <GridPane hgap="15" vgap="12" styleClass="card">
                            <columnConstraints>
                                <ColumnConstraints minWidth="120" prefWidth="120"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                            </columnConstraints>

                            <Label text="Name:" GridPane.columnIndex="0" GridPane.rowIndex="0" styleClass="form-label"/>
                            <Label fx:id="driverDetailNameLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                            <Label text="License #:" GridPane.columnIndex="0" GridPane.rowIndex="1" styleClass="form-label"/>
                            <Label fx:id="driverLicenseLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                            <Label text="License Exp:" GridPane.columnIndex="0" GridPane.rowIndex="2" styleClass="form-label"/>
                            <Label fx:id="licenseExpirationLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                            <Label text="Phone:" GridPane.columnIndex="0" GridPane.rowIndex="3" styleClass="form-label"/>
                            <Label fx:id="driverPhoneLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                            <Label text="Email:" GridPane.columnIndex="0" GridPane.rowIndex="4" styleClass="form-label"/>
                            <Label fx:id="driverEmailLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                            <Label text="Assigned Bus:" GridPane.columnIndex="0" GridPane.rowIndex="5" styleClass="form-label"/>
                            <Label fx:id="driverAssignedBusLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                            <Label text="Status:" GridPane.columnIndex="0" GridPane.rowIndex="6" styleClass="form-label"/>
                            <Label fx:id="driverStatusLabel" text="â€”" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                        </GridPane>

                        <Label text="Certifications &amp; Training" styleClass="form-label"/>
                        <ListView fx:id="certificationsListView" prefHeight="150">
                            <placeholder>
                                <Label text="No certifications" styleClass="text-muted"/>
                            </placeholder>
                        </ListView>

                        <HBox spacing="10">
                            <Button text="Edit Driver" onAction="#handleEditDriver"
                                    styleClass="button-primary"
                                    HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                            <Button text="View History" onAction="#handleDriverHistory"
                                    style="-fx-padding: 8 15; -fx-cursor: hand;"
                                    HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                        </HBox>
                    </VBox>
                </SplitPane>
            </Tab>

            <!-- Maintenance Tab -->
            <Tab text="ðŸ”§ Maintenance">
                <VBox spacing="15" styleClass="form-panel">
                    <Label text="Vehicle Maintenance" styleClass="section-title"/>

                    <HBox spacing="10">
                        <ComboBox fx:id="maintenanceStatusComboBox" prefWidth="150">
                            <items>
                                <String fx:value="All Vehicles"/>
                                <String fx:value="Due Soon"/>
                                <String fx:value="Overdue"/>
                                <String fx:value="In Service"/>
                                <String fx:value="Out of Service"/>
                            </items>
                        </ComboBox>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="+ Schedule Maintenance" onAction="#handleScheduleMaintenance"
                                styleClass="button-primary"/>
                    </HBox>

                    <TableView fx:id="maintenanceTableView" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="busNumberColumn" text="Bus #" prefWidth="80"/>
                            <TableColumn fx:id="makeModelColumn" text="Make/Model" prefWidth="150"/>
                            <TableColumn fx:id="mileageColumn" text="Mileage" prefWidth="100"/>
                            <TableColumn fx:id="lastServiceColumn" text="Last Service" prefWidth="120"/>
                            <TableColumn fx:id="nextServiceColumn" text="Next Service" prefWidth="120"/>
                            <TableColumn fx:id="serviceTypeColumn" text="Service Type" prefWidth="150"/>
                            <TableColumn fx:id="maintenanceStatusColumn" text="Status" prefWidth="120"/>
                        </columns>
                        <placeholder>
                            <Label text="No maintenance records" styleClass="text-muted"/>
                        </placeholder>
                    </TableView>
                </VBox>
            </Tab>

            <!-- Reports Tab -->
            <Tab text="ðŸ“Š Reports">
                <VBox spacing="20" styleClass="wizard-card">
                    <Label text="Transportation Reports" styleClass="section-title"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.33"/>
                            <ColumnConstraints percentWidth="33.33"/>
                        </columnConstraints>

                        <!-- Report Cards -->
                        <VBox spacing="10" GridPane.columnIndex="0" GridPane.rowIndex="0"
                              styleClass="card, metric-info">
                            <Label text="ðŸ“‹ Route Efficiency" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="Analyze route performance and optimization opportunities" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleRouteEfficiencyReport"
                                    styleClass="button-primary"
                                    maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="0"
                              styleClass="card">
                            <Label text="ðŸ“‹ Ridership Report" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="Student ridership statistics by route, grade, and timeframe" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleRidershipReport"
                                    styleClass="header-purple"
                                    maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="10" GridPane.columnIndex="2" GridPane.rowIndex="0"
                              styleClass="card, metric-warning">
                            <Label text="ðŸ“‹ Driver Performance" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="On-time performance, incidents, and driver metrics" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleDriverPerformanceReport"
                                    styleClass="button-primary"
                                    maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="10" GridPane.columnIndex="0" GridPane.rowIndex="1"
                              styleClass="card, metric-success">
                            <Label text="ðŸ“‹ Maintenance History" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="Complete vehicle maintenance and repair history" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleMaintenanceReport"
                                    styleClass="button-primary"
                                    maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="1"
                              styleClass="card, metric-danger">
                            <Label text="ðŸ“‹ Safety & Incidents" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="Safety inspections, incidents, and compliance records" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleSafetyReport"
                                    styleClass="header-danger"
                                    maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="10" GridPane.columnIndex="2" GridPane.rowIndex="1"
                              styleClass="card">
                            <Label text="ðŸ“‹ Cost Analysis" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                            <Label text="Fuel costs, maintenance expenses, and budget analysis" wrapText="true"
                                   style="-fx-font-size: 11px;"/>
                            <Button text="Generate Report" onAction="#handleCostAnalysisReport"
                                    styleClass="button-primary"
                                    maxWidth="Infinity"/>
                        </VBox>
                    </GridPane>
                </VBox>
            </Tab>

        </TabPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT"
              styleClass="card">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="lastUpdatedLabel" text="Last updated: Just now" styleClass="text-muted"/>

            <Region HBox.hgrow="ALWAYS"/>

            <Button text="ðŸ”„ Refresh" onAction="#handleRefresh"
                    style="-fx-padding: 6 15; -fx-cursor: hand;"/>
            <Button text="âš™ Settings" onAction="#handleSettings"
                    style="-fx-padding: 6 15; -fx-cursor: hand;"/>
        </HBox>
    </bottom>

</BorderPane>
