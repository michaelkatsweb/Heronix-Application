<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<VBox xmlns="http://javafx.com/javafx"
      xmlns:fx="http://javafx.com/fxml"
      fx:controller="com.heronix.ui.controller.ColumnMappingController"
      prefWidth="800" prefHeight="600"
      spacing="15"
      styleClass="dialog-root">


    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header -->
    <VBox spacing="5">
        <Label text="Column Mapping" styleClass="dialog-title">
            <font>
                <Font name="System Bold" size="18"/>
            </font>
        </Label>
        <Label text="Map CSV columns to database fields" styleClass="dialog-subtitle">
            <font>
                <Font size="12"/>
            </font>
        </Label>
    </VBox>

    <Separator/>

    <!-- File Information -->
    <HBox spacing="10" alignment="CENTER_LEFT">
        <Label text="ðŸ“„ File:" styleClass="form-label"/>
        <Label fx:id="fileNameLabel" text="No file selected" styleClass="text-muted"/>
        <Label text="|" styleClass="text-separator"/>
        <Label text="Entity Type:" styleClass="form-label"/>
        <Label fx:id="entityTypeLabel" text="Unknown" styleClass="text-muted"/>
    </HBox>

    <!-- Template Selection -->
    <HBox spacing="10" alignment="CENTER_LEFT">
        <Label text="Quick Templates:"/>
        <Button fx:id="skywardTemplateBtn" text="Skyward" onAction="#applySkywardTemplate" prefWidth="100"/>
        <Button fx:id="powerSchoolTemplateBtn" text="PowerSchool" onAction="#applyPowerSchoolTemplate" prefWidth="100"/>
        <Button fx:id="customTemplateBtn" text="Custom" onAction="#applyCustomTemplate" prefWidth="100"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="autoDetectBtn" text="ðŸ” Auto-Detect" onAction="#autoDetectMapping" styleClass="button-primary"/>
    </HBox>

    <Separator/>

    <!-- Mapping Table -->
    <VBox VBox.vgrow="ALWAYS" spacing="5">
        <Label text="Column Mappings:" styleClass="form-label"/>

        <TableView fx:id="mappingTable" VBox.vgrow="ALWAYS">
            <columns>
                <!-- CSV Column -->
                <TableColumn fx:id="csvColumnCol" text="CSV Column" prefWidth="200" editable="false"/>

                <!-- Database Field -->
                <TableColumn fx:id="dbFieldCol" text="Database Field" prefWidth="200" editable="true"/>

                <!-- Sample Data -->
                <TableColumn fx:id="sampleDataCol" text="Sample Data (First 3 rows)" prefWidth="300" editable="false"/>

                <!-- Status -->
                <TableColumn fx:id="statusCol" text="Status" prefWidth="100" editable="false"/>
            </columns>

            <placeholder>
                <Label text="No CSV file loaded. Please select a file to begin mapping."/>
            </placeholder>
        </TableView>
    </VBox>

    <!-- Mapping Statistics -->
    <HBox spacing="20" styleClass="card">
        <VBox spacing="5">
            <Label text="Mapping Statistics" styleClass="form-label"/>
            <HBox spacing="15">
                <Label fx:id="totalColumnsLabel" text="Total Columns: 0"/>
                <Label fx:id="mappedColumnsLabel" text="Mapped: 0" styleClass="text-success"/>
                <Label fx:id="unmappedColumnsLabel" text="Unmapped: 0" styleClass="text-warning"/>
                <Label fx:id="requiredFieldsLabel" text="Required Fields: 0/0" styleClass="text-info"/>
            </HBox>
        </VBox>
    </HBox>

    <!-- Validation Messages -->
    <VBox fx:id="validationBox" spacing="5" styleClass="card" managed="false" visible="false">
        <HBox spacing="5" alignment="CENTER_LEFT">
            <Label text="âš " styleClass="text-muted"/>
            <Label text="Validation Issues:" styleClass="form-label"/>
        </HBox>
        <TextArea fx:id="validationTextArea" editable="false" prefRowCount="3" wrapText="true"/>
    </VBox>

    <!-- Action Buttons -->
    <HBox spacing="10" alignment="CENTER_RIGHT">
        <Button fx:id="resetButton" text="Reset Mapping" onAction="#handleReset" prefWidth="120"/>
        <Button fx:id="validateButton" text="Validate Mapping" onAction="#handleValidate" prefWidth="120" styleClass="button-primary"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button fx:id="cancelButton" text="Cancel" onAction="#handleCancel" prefWidth="100"/>
        <Button fx:id="saveButton" text="Save &amp; Continue" onAction="#handleSave" prefWidth="120" styleClass="button-success" disable="true"/>
    </HBox>

</VBox>
