<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<!--
Hall Pass Management View
Location: src/main/resources/fxml/HallPass.fxml
-->

<VBox xmlns="http://javafx.com/javafx/21"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:id="rootContainer"
      fx:controller="com.heronix.ui.controller.HallPassController"
      styleClass="root"
      spacing="20">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header Section -->
    <HBox alignment="CENTER_LEFT" spacing="15" styleClass="card">
        <Label text="ðŸŽ« Hall Pass Management" styleClass="label-title"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button text="ðŸ”„ Refresh" onAction="#handleRefresh" styleClass="button-secondary"/>
    </HBox>

    <!-- Summary Cards -->
    <HBox spacing="15">
        <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
            <Label text="âœ… Active Passes" styleClass="label"/>
            <Label fx:id="activeCountLabel" text="0"
                   style="-fx-font-size: 32; -fx-font-weight: bold; -fx-text-fill: #4CAF50;"/>
        </VBox>

        <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
            <Label text="âš ï¸ Overdue Passes" styleClass="label"/>
            <Label fx:id="overdueCountLabel" text="0"
                   style="-fx-font-size: 32; -fx-font-weight: bold; -fx-text-fill: #F44336;"/>
        </VBox>
    </HBox>

    <!-- Main Tab Pane -->
    <TabPane fx:id="mainTabPane" VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE">

        <!-- ========== ACTIVE PASSES TAB ========== -->
        <Tab fx:id="activePassesTab" text="ðŸŽ« Active Passes" closable="false">
            <VBox spacing="20">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <!-- Active Passes Table -->
                <VBox spacing="15" styleClass="card" VBox.vgrow="ALWAYS">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="Current Active Hall Passes" styleClass="label-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ›‘ End Selected Pass" onAction="#handleEndPass"
                                styleClass="button-danger" minWidth="150"/>
                    </HBox>

                    <TableView fx:id="activePassesTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="studentNameCol" text="Student Name"
                                         prefWidth="180" minWidth="150"/>
                            <TableColumn fx:id="destinationCol" text="Destination"
                                         prefWidth="180" minWidth="150"/>
                            <TableColumn fx:id="departureTimeCol" text="Departure Time"
                                         prefWidth="130" minWidth="110"/>
                            <TableColumn fx:id="durationCol" text="Duration"
                                         prefWidth="100" minWidth="80"/>
                            <TableColumn fx:id="statusCol" text="Status"
                                         prefWidth="120" minWidth="100"/>
                            <TableColumn fx:id="roomCol" text="From Room"
                                         prefWidth="120" minWidth="100"/>
                        </columns>
                        <placeholder>
                            <Label text="No active hall passes"/>
                        </placeholder>
                    </TableView>
                </VBox>
            </VBox>
        </Tab>

        <!-- ========== NEW PASS TAB ========== -->
        <Tab fx:id="newPassTab" text="âž• New Pass" closable="false">
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="20">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="âž• Create New Hall Pass" styleClass="label-title"/>

                    <!-- Pass Information -->
                    <VBox spacing="15" styleClass="card">
                        <Label text="ðŸ“‹ Pass Information" style="-fx-font-size: 16; -fx-font-weight: bold;"/>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Student:" style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="studentComboBox" promptText="Select Student"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>

                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Destination:" style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="destinationComboBox" promptText="Select Destination"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>
                        </HBox>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Approving Teacher:" style="-fx-font-weight: bold;"/>
                                <ComboBox fx:id="teacherComboBox" promptText="Select Teacher"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Period:" style="-fx-font-weight: bold;"/>
                                <Spinner fx:id="periodSpinner" prefWidth="100" editable="true"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="5">
                            <Label text="Departure Room:" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="departureRoomField" promptText="e.g., Room 205"/>
                        </VBox>

                        <VBox spacing="5">
                            <Label text="Notes (Optional):" style="-fx-font-weight: bold;"/>
                            <TextArea fx:id="notesArea" prefHeight="80" wrapText="true"
                                      promptText="Enter any additional notes..."/>
                        </VBox>
                    </VBox>

                    <!-- Action Buttons -->
                    <HBox spacing="15" alignment="CENTER">
                        <Button text="âœ… Create Hall Pass" onAction="#handleCreatePass"
                                styleClass="button-primary" minWidth="150"/>
                        <Button text="ðŸ”„ Clear Form" onAction="#handleClearForm"
                                styleClass="button-secondary" minWidth="150"/>
                    </HBox>

                    <!-- Result Display -->
                    <VBox spacing="10" styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="ðŸ“„ Result" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                        <TextArea fx:id="resultArea" editable="false" wrapText="true"
                                  prefHeight="200" promptText="Create a hall pass to see the result..."/>
                    </VBox>
                </VBox>
            </ScrollPane>
        </Tab>

        <!-- ========== HISTORY TAB ========== -->
        <Tab fx:id="historyTab" text="ðŸ“œ History" closable="false">
            <VBox spacing="20">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <!-- Student Selection -->
                <VBox spacing="15" styleClass="card">
                    <Label text="ðŸ“‹ Select Student" style="-fx-font-size: 16; -fx-font-weight: bold;"/>

                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <VBox spacing="5" HBox.hgrow="ALWAYS">
                            <Label text="Student:" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="historyStudentComboBox" promptText="Select Student"
                                      prefWidth="Infinity" maxWidth="Infinity"/>
                        </VBox>

                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="ðŸ“Š Load History" onAction="#handleLoadHistory"
                                styleClass="button-primary" minWidth="150"/>
                    </HBox>
                </VBox>

                <!-- History Table -->
                <VBox spacing="15" styleClass="card" VBox.vgrow="ALWAYS">
                    <Label text="ðŸ“œ Hall Pass History" styleClass="label-title"/>

                    <TableView fx:id="historyTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="historyDestinationCol" text="Destination"
                                         prefWidth="180" minWidth="150"/>
                            <TableColumn fx:id="historyDepartureCol" text="Departure"
                                         prefWidth="150" minWidth="130"/>
                            <TableColumn fx:id="historyReturnCol" text="Return"
                                         prefWidth="150" minWidth="130"/>
                            <TableColumn fx:id="historyDurationCol" text="Duration"
                                         prefWidth="100" minWidth="80"/>
                            <TableColumn fx:id="historyStatusCol" text="Status"
                                         prefWidth="120" minWidth="100"/>
                        </columns>
                        <placeholder>
                            <Label text="Select a student to view their hall pass history"/>
                        </placeholder>
                    </TableView>
                </VBox>
            </VBox>
        </Tab>
    </TabPane>
</VBox>
