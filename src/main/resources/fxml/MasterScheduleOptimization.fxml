<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.MasterScheduleOptimizationController"
            prefWidth="1600" prefHeight="1000">


    <!-- Top: Header -->
    <top>
        <VBox spacing="15" styleClass="card">
            <Label text="Master Schedule Optimization"
                   styleClass="page-title-white"/>
            <Label text="AI-powered schedule optimization with genetic algorithms and constraint satisfaction"
                   styleClass="text-white"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.3, 0.7" styleClass="main-container">

            <!-- Left: Optimization Configuration -->
            <VBox spacing="15" styleClass="padding-15-white">
                <Label text="Optimization Settings" styleClass="section-title"/>

                <!-- Schedule Selection -->
                <VBox spacing="10" styleClass="card, metric-info">
                    <Label text="Schedule to Optimize" styleClass="label-14-bold-blue"/>
                    <ComboBox fx:id="scheduleSelectionComboBox" promptText="Select schedule..." maxWidth="Infinity"/>
                    <Label fx:id="scheduleInfoLabel" text="No schedule selected" wrapText="true" styleClass="text-muted"/>
                </VBox>

                <!-- Optimization Algorithm -->
                <VBox spacing="10" styleClass="card, metric-warning">
                    <Label text="Algorithm Selection" styleClass="label-14-bold-orange"/>

                    <Label text="Primary Algorithm:" styleClass="label-11-bold"/>
                    <ComboBox fx:id="algorithmComboBox" promptText="Select algorithm..." maxWidth="Infinity"/>

                    <Label text="Optimization Level:" styleClass="label-11-bold"/>
                    <ComboBox fx:id="optimizationLevelComboBox" maxWidth="Infinity"/>

                    <Label fx:id="algorithmDescriptionLabel" text="" wrapText="true" styleClass="text-muted"/>
                </VBox>

                <!-- Optimization Objectives -->
                <VBox spacing="10" styleClass="card, metric-success">
                    <Label text="Optimization Objectives" styleClass="label-14-bold-green"/>

                    <CheckBox fx:id="minimizeConflictsCheckBox" text="Minimize Schedule Conflicts" selected="true"/>
                    <CheckBox fx:id="balanceTeacherWorkloadCheckBox" text="Balance Teacher Workload" selected="true"/>
                    <CheckBox fx:id="maximizeRoomUtilizationCheckBox" text="Maximize Room Utilization" selected="true"/>
                    <CheckBox fx:id="optimizeStudentPathsCheckBox" text="Optimize Student Transition Paths"/>
                    <CheckBox fx:id="minimizeIdleTimeCheckBox" text="Minimize Idle Time"/>
                    <CheckBox fx:id="respectPreferencesCheckBox" text="Respect Teacher Preferences"/>
                    <CheckBox fx:id="balanceClassSizesCheckBox" text="Balance Class Sizes"/>
                </VBox>

                <!-- Constraints -->
                <VBox spacing="10" styleClass="card, metric-danger">
                    <Label text="Hard Constraints" styleClass="label-14-bold-red"/>

                    <CheckBox fx:id="noTeacherConflictsCheckBox" text="No Teacher Conflicts" selected="true" disable="true"/>
                    <CheckBox fx:id="noRoomConflictsCheckBox" text="No Room Conflicts" selected="true" disable="true"/>
                    <CheckBox fx:id="respectLabRequirementsCheckBox" text="Respect Lab Requirements" selected="true"/>
                    <CheckBox fx:id="respectPrerequisitesCheckBox" text="Respect Prerequisites" selected="true"/>
                    <CheckBox fx:id="respectCapacityLimitsCheckBox" text="Respect Room Capacity" selected="true"/>
                </VBox>

                <!-- Advanced Settings -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Advanced Settings" styleClass="label-14-bold-purple"/>

                    <Label text="Max Iterations:" styleClass="label-11-bold"/>
                    <Spinner fx:id="maxIterationsSpinner" min="100" max="10000" initialValue="1000" editable="true" maxWidth="Infinity"/>

                    <Label text="Population Size:" styleClass="label-11-bold"/>
                    <Spinner fx:id="populationSizeSpinner" min="50" max="500" initialValue="100" editable="true" maxWidth="Infinity"/>

                    <Label text="Mutation Rate (%):" styleClass="label-11-bold"/>
                    <Slider fx:id="mutationRateSlider" min="1" max="30" value="10" showTickLabels="true" showTickMarks="true" majorTickUnit="10"/>
                    <Label fx:id="mutationRateLabel" text="10%" styleClass="text-muted"/>
                </VBox>

                <!-- Run Button -->
                <Button fx:id="runOptimizationButton" text="⚡ Run Optimization" onAction="#handleRunOptimization"
                        styleClass="header-purple" maxWidth="Infinity"/>

            </VBox>

            <!-- Center: Results & Visualization -->
            <BorderPane styleClass="card">

                <top>
                    <VBox spacing="15" styleClass="padding-20">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Label text="Optimization Results" styleClass="section-title"/>
                            <Region HBox.hgrow="ALWAYS"/>
                            <Label fx:id="optimizationStatusLabel" text="Ready" styleClass="text-muted"/>
                        </HBox>

                        <!-- Score Comparison Cards -->
                        <GridPane hgap="15" vgap="15">
                            <columnConstraints>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="33"/>
                                <ColumnConstraints percentWidth="34"/>
                            </columnConstraints>

                            <!-- Current Score -->
                            <VBox spacing="5" styleClass="card, metric-danger"
                                  GridPane.columnIndex="0" GridPane.rowIndex="0">
                                <Label text="Current Schedule" styleClass="text-muted"/>
                                <Label fx:id="currentScoreLabel" text="--" styleClass="stat-value-28-red"/>
                                <Label text="Optimization Score" styleClass="text-muted"/>
                            </VBox>

                            <!-- Optimized Score -->
                            <VBox spacing="5" styleClass="card, metric-success"
                                  GridPane.columnIndex="1" GridPane.rowIndex="0">
                                <Label text="Optimized Schedule" styleClass="text-muted"/>
                                <Label fx:id="optimizedScoreLabel" text="--" styleClass="stat-value-28-green"/>
                                <Label text="Optimization Score" styleClass="text-muted"/>
                            </VBox>

                            <!-- Improvement -->
                            <VBox spacing="5" styleClass="card, metric-info"
                                  GridPane.columnIndex="2" GridPane.rowIndex="0">
                                <Label text="Improvement" styleClass="text-muted"/>
                                <Label fx:id="improvementLabel" text="--" styleClass="stat-value-28-blue-dark"/>
                                <Label text="Percentage" styleClass="text-muted"/>
                            </VBox>
                        </GridPane>

                        <!-- Progress Bar -->
                        <VBox spacing="5">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="Optimization Progress" styleClass="label-12-bold"/>
                                <Label fx:id="iterationLabel" text="0 / 0 iterations" styleClass="text-muted"/>
                            </HBox>
                            <ProgressBar fx:id="optimizationProgressBar" prefWidth="Infinity" progress="0"/>
                        </VBox>
                    </VBox>
                </top>

                <center>
                    <TabPane tabClosingPolicy="UNAVAILABLE" styleClass="content-padding-10">

                        <!-- Metrics Tab -->
                        <Tab text="Metrics">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="20" styleClass="padding-20">

                                    <!-- Key Metrics Grid -->
                                    <GridPane hgap="15" vgap="15">
                                        <columnConstraints>
                                            <ColumnConstraints percentWidth="50"/>
                                            <ColumnConstraints percentWidth="50"/>
                                        </columnConstraints>

                                        <!-- Conflicts -->
                                        <VBox spacing="10" styleClass="card"
                                              GridPane.columnIndex="0" GridPane.rowIndex="0">
                                            <Label text="Conflicts" styleClass="label-14-bold"/>
                                            <HBox spacing="20">
                                                <VBox spacing="3">
                                                    <Label text="Before:" styleClass="text-muted"/>
                                                    <Label fx:id="conflictsBeforeLabel" text="0" styleClass="stat-value-20-red"/>
                                                </VBox>
                                                <Label text="→" styleClass="text-muted"/>
                                                <VBox spacing="3">
                                                    <Label text="After:" styleClass="text-muted"/>
                                                    <Label fx:id="conflictsAfterLabel" text="0" styleClass="stat-value-20-green"/>
                                                </VBox>
                                            </HBox>
                                        </VBox>

                                        <!-- Teacher Utilization -->
                                        <VBox spacing="10" styleClass="card"
                                              GridPane.columnIndex="1" GridPane.rowIndex="0">
                                            <Label text="Teacher Utilization" styleClass="label-14-bold"/>
                                            <HBox spacing="20">
                                                <VBox spacing="3">
                                                    <Label text="Before:" styleClass="text-muted"/>
                                                    <Label fx:id="teacherUtilBeforeLabel" text="0%" styleClass="stat-value-20-bold"/>
                                                </VBox>
                                                <Label text="→" styleClass="text-muted"/>
                                                <VBox spacing="3">
                                                    <Label text="After:" styleClass="text-muted"/>
                                                    <Label fx:id="teacherUtilAfterLabel" text="0%" styleClass="stat-value-20-green"/>
                                                </VBox>
                                            </HBox>
                                        </VBox>

                                        <!-- Room Utilization -->
                                        <VBox spacing="10" styleClass="card"
                                              GridPane.columnIndex="0" GridPane.rowIndex="1">
                                            <Label text="Room Utilization" styleClass="label-14-bold"/>
                                            <HBox spacing="20">
                                                <VBox spacing="3">
                                                    <Label text="Before:" styleClass="text-muted"/>
                                                    <Label fx:id="roomUtilBeforeLabel" text="0%" styleClass="stat-value-20-bold"/>
                                                </VBox>
                                                <Label text="→" styleClass="text-muted"/>
                                                <VBox spacing="3">
                                                    <Label text="After:" styleClass="text-muted"/>
                                                    <Label fx:id="roomUtilAfterLabel" text="0%" styleClass="stat-value-20-green"/>
                                                </VBox>
                                            </HBox>
                                        </VBox>

                                        <!-- Workload Balance -->
                                        <VBox spacing="10" styleClass="card"
                                              GridPane.columnIndex="1" GridPane.rowIndex="1">
                                            <Label text="Workload Balance" styleClass="label-14-bold"/>
                                            <HBox spacing="20">
                                                <VBox spacing="3">
                                                    <Label text="Before:" styleClass="text-muted"/>
                                                    <Label fx:id="workloadBeforeLabel" text="0%" styleClass="stat-value-20-bold"/>
                                                </VBox>
                                                <Label text="→" styleClass="text-muted"/>
                                                <VBox spacing="3">
                                                    <Label text="After:" styleClass="text-muted"/>
                                                    <Label fx:id="workloadAfterLabel" text="0%" styleClass="stat-value-20-green"/>
                                                </VBox>
                                            </HBox>
                                        </VBox>
                                    </GridPane>

                                </VBox>
                            </ScrollPane>
                        </Tab>

                        <!-- Convergence Chart Tab -->
                        <Tab text="Convergence">
                            <VBox styleClass="padding-20">
                                <Label text="Optimization Convergence" styleClass="label-14-bold-padding"/>
                                <LineChart fx:id="convergenceChart" VBox.vgrow="ALWAYS">
                                    <xAxis>
                                        <NumberAxis label="Iteration" side="BOTTOM"/>
                                    </xAxis>
                                    <yAxis>
                                        <NumberAxis label="Fitness Score" side="LEFT"/>
                                    </yAxis>
                                </LineChart>
                            </VBox>
                        </Tab>

                        <!-- Changes Log Tab -->
                        <Tab text="Changes">
                            <VBox spacing="10" styleClass="content-padding-15">
                                <Label text="Optimization Changes" styleClass="label-14-bold"/>
                                <TableView fx:id="changesTableView" VBox.vgrow="ALWAYS">
                                    <columns>
                                        <TableColumn fx:id="changeTypeColumn" text="Type" prefWidth="120"/>
                                        <TableColumn fx:id="changeDescriptionColumn" text="Description" prefWidth="400"/>
                                        <TableColumn fx:id="changeReasonColumn" text="Reason" prefWidth="250"/>
                                        <TableColumn fx:id="changeImpactColumn" text="Impact" prefWidth="150"/>
                                    </columns>
                                </TableView>
                            </VBox>
                        </Tab>

                        <!-- Comparison Tab -->
                        <Tab text="Comparison">
                            <ScrollPane fitToWidth="true" fitToHeight="true">
                                <VBox spacing="15" styleClass="padding-20">
                                    <Label text="Before vs. After Comparison" styleClass="label-14-bold"/>

                                    <!-- Side-by-side comparison will go here -->
                                    <HBox spacing="20">
                                        <VBox spacing="10" HBox.hgrow="ALWAYS" styleClass="card, metric-danger">
                                            <Label text="Current Schedule" styleClass="label-13-bold-red"/>
                                            <TextArea fx:id="currentScheduleSummary" editable="false" wrapText="true" prefHeight="400"/>
                                        </VBox>

                                        <VBox spacing="10" HBox.hgrow="ALWAYS" styleClass="card, metric-success">
                                            <Label text="Optimized Schedule" styleClass="label-13-bold-green"/>
                                            <TextArea fx:id="optimizedScheduleSummary" editable="false" wrapText="true" prefHeight="400"/>
                                        </VBox>
                                    </HBox>
                                </VBox>
                            </ScrollPane>
                        </Tab>

                    </TabPane>
                </center>

            </BorderPane>

            <!-- Right: Actions &amp; History -->
            <VBox spacing="15" styleClass="padding-15-white">
                <Label text="Actions" styleClass="section-title"/>

                <!-- Accept/Reject -->
                <VBox spacing="10">
                    <Button fx:id="acceptButton" text="✓ Accept Optimized Schedule" onAction="#handleAcceptOptimization"
                            styleClass="button-primary" maxWidth="Infinity" disable="true"/>

                    <Button fx:id="rejectButton" text="✗ Reject Changes" onAction="#handleRejectOptimization"
                            styleClass="header-danger" maxWidth="Infinity" disable="true"/>

                    <Button fx:id="saveComparisonButton" text="Save for Later Review" onAction="#handleSaveComparison"
                            styleClass="button-primary" maxWidth="Infinity" disable="true"/>
                </VBox>

                <Separator/>

                <!-- Export Options -->
                <VBox spacing="10">
                    <Label text="Export" styleClass="label-14-bold"/>

                    <Button text="Export Results Report" onAction="#handleExportResults"
                            styleClass="button-primary" maxWidth="Infinity"/>

                    <Button text="Export Comparison" onAction="#handleExportComparison"
                            styleClass="button-primary" maxWidth="Infinity"/>
                </VBox>

                <Separator/>

                <!-- Optimization History -->
                <VBox spacing="10" VBox.vgrow="ALWAYS">
                    <Label text="Recent Optimizations" styleClass="label-14-bold"/>
                    <ListView fx:id="historyListView" VBox.vgrow="ALWAYS" prefHeight="200"/>
                </VBox>

                <Separator/>

                <!-- Info Panel -->
                <VBox spacing="8" styleClass="card, metric-info">
                    <Label text="ℹ Optimization Info" styleClass="label-12-bold-blue"/>
                    <Label fx:id="executionTimeLabel" text="Execution Time: --" styleClass="label-10"/>
                    <Label fx:id="generationsLabel" text="Generations: --" styleClass="label-10"/>
                    <Label fx:id="finalFitnessLabel" text="Final Fitness: --" styleClass="label-10"/>
                </VBox>

            </VBox>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
            <Label fx:id="statusLabel" text="Ready to optimize" styleClass="label-11"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="algorithmStatusLabel" text="Algorithm: Not selected" styleClass="text-muted"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="timeRemainingLabel" text="" styleClass="text-muted"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="lastRunLabel" text="Last run: Never" styleClass="text-muted"/>
        </HBox>
    </bottom>

</BorderPane>
