<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.CommunicationCenterController"
            stylesheets="@../css/application.css"
            prefWidth="1700" prefHeight="950">

    <!-- Top: Header -->
    <top>
        <VBox spacing="15" style="-fx-background-color: linear-gradient(to right, #00bcd4, #0097a7); -fx-padding: 20;">
            <HBox spacing="15" alignment="CENTER_LEFT">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Communication Center"
                           style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                    <Label text="Send messages, announcements, and notifications to students, parents, and staff"
                           style="-fx-font-size: 13px; -fx-text-fill: white;"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="5" alignment="CENTER_RIGHT">
                    <Button text="âœ‰ Compose Message" onAction="#handleComposeMessage"
                            style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 8 20; -fx-font-weight: bold; -fx-cursor: hand;"/>
                    <Button text="ðŸ“¢ New Announcement" onAction="#handleNewAnnouncement"
                            style="-fx-background-color: #ff9800; -fx-text-fill: white; -fx-padding: 8 20; -fx-cursor: hand;"/>
                </VBox>
            </HBox>

            <!-- Stats Bar -->
            <HBox spacing="15">
                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      style="-fx-background-color: rgba(255,255,255,0.2); -fx-padding: 12; -fx-border-radius: 5;">
                    <Label text="Unread Messages" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Label fx:id="unreadMessagesLabel" text="12"
                           style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      style="-fx-background-color: rgba(255,255,255,0.2); -fx-padding: 12; -fx-border-radius: 5;">
                    <Label text="Draft Messages" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Label fx:id="draftMessagesLabel" text="3"
                           style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      style="-fx-background-color: rgba(255,255,255,0.2); -fx-padding: 12; -fx-border-radius: 5;">
                    <Label text="Sent Today" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Label fx:id="sentTodayLabel" text="8"
                           style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      style="-fx-background-color: rgba(255,255,255,0.2); -fx-padding: 12; -fx-border-radius: 5;">
                    <Label text="Active Announcements" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Label fx:id="activeAnnouncementsLabel" text="5"
                           style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                </VBox>

                <VBox spacing="3" HBox.hgrow="ALWAYS"
                      style="-fx-background-color: rgba(255,255,255,0.2); -fx-padding: 12; -fx-border-radius: 5;">
                    <Label text="Pending Alerts" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Label fx:id="pendingAlertsLabel" text="2"
                           style="-fx-text-fill: white; -fx-font-size: 24px; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.25, 0.65" style="-fx-background-color: #f5f5f5;">

            <!-- Left: Navigation & Folders -->
            <VBox spacing="15" style="-fx-padding: 15; -fx-background-color: white;">
                <Label text="Mailbox" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                <!-- Folder List -->
                <VBox spacing="5" VBox.vgrow="ALWAYS">
                    <Button text="ðŸ“¥ Inbox (12)" onAction="#handleInbox"
                            style="-fx-alignment: center-left; -fx-padding: 10; -fx-cursor: hand; -fx-background-color: #e3f2fd;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸ“¤ Sent" onAction="#handleSent"
                            style="-fx-alignment: center-left; -fx-padding: 10; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸ“ Drafts (3)" onAction="#handleDrafts"
                            style="-fx-alignment: center-left; -fx-padding: 10; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="â­ Starred" onAction="#handleStarred"
                            style="-fx-alignment: center-left; -fx-padding: 10; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸ—‘ Trash" onAction="#handleTrash"
                            style="-fx-alignment: center-left; -fx-padding: 10; -fx-cursor: hand;"
                            maxWidth="Infinity"/>

                    <Separator/>

                    <Label text="Categories" style="-fx-font-weight: bold; -fx-font-size: 12px;"/>

                    <Button text="ðŸ‘¥ From Parents" onAction="#handleFromParents"
                            style="-fx-alignment: center-left; -fx-padding: 8; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸ‘¨â€ðŸ« From Teachers" onAction="#handleFromTeachers"
                            style="-fx-alignment: center-left; -fx-padding: 8; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸ‘¨â€ðŸ’¼ From Staff" onAction="#handleFromStaff"
                            style="-fx-alignment: center-left; -fx-padding: 8; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                    <Button text="ðŸŽ“ From Students" onAction="#handleFromStudents"
                            style="-fx-alignment: center-left; -fx-padding: 8; -fx-cursor: hand;"
                            maxWidth="Infinity"/>
                </VBox>

                <!-- Quick Stats -->
                <VBox spacing="8" style="-fx-background-color: #f9f9f9; -fx-padding: 12; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                    <Label text="Quick Stats" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <Label fx:id="totalMessagesLabel" text="Total: 342 messages" style="-fx-font-size: 10px;"/>
                    <Label fx:id="storageUsedLabel" text="Storage: 125 MB / 5 GB" style="-fx-font-size: 10px;"/>
                </VBox>
            </VBox>

            <!-- Center: Message List -->
            <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: white;">
                <HBox spacing="10" alignment="CENTER_LEFT">
                    <Label fx:id="folderTitleLabel" text="Inbox" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <TextField fx:id="messageSearchField" promptText="Search messages..." prefWidth="250"/>
                    <Button text="ðŸ”" onAction="#handleSearch"
                            style="-fx-padding: 6 12; -fx-cursor: hand;"/>
                </HBox>

                <!-- Toolbar -->
                <HBox spacing="10" alignment="CENTER_LEFT" style="-fx-padding: 8; -fx-background-color: #f5f5f5;">
                    <CheckBox fx:id="selectAllCheckBox" text="Select All"/>
                    <Separator orientation="VERTICAL"/>
                    <Button text="Delete" onAction="#handleDeleteMessages"
                            style="-fx-padding: 5 10; -fx-cursor: hand;"/>
                    <Button text="Mark Read" onAction="#handleMarkRead"
                            style="-fx-padding: 5 10; -fx-cursor: hand;"/>
                    <Button text="Star" onAction="#handleStarMessages"
                            style="-fx-padding: 5 10; -fx-cursor: hand;"/>
                    <Region HBox.hgrow="ALWAYS"/>
                    <ComboBox fx:id="sortComboBox" prefWidth="150">
                        <items>
                            <String fx:value="Sort: Newest First"/>
                            <String fx:value="Sort: Oldest First"/>
                            <String fx:value="Sort: Sender A-Z"/>
                            <String fx:value="Sort: Unread First"/>
                        </items>
                    </ComboBox>
                </HBox>

                <!-- Message List -->
                <ListView fx:id="messageListView" VBox.vgrow="ALWAYS">
                    <placeholder>
                        <Label text="No messages" style="-fx-text-fill: #9e9e9e;"/>
                    </placeholder>
                </ListView>

                <!-- Pagination -->
                <HBox spacing="10" alignment="CENTER">
                    <Label fx:id="paginationLabel" text="1-20 of 342"/>
                    <Button text="â—€ Previous" onAction="#handlePreviousPage"
                            style="-fx-padding: 5 10; -fx-cursor: hand;"/>
                    <Button text="Next â–¶" onAction="#handleNextPage"
                            style="-fx-padding: 5 10; -fx-cursor: hand;"/>
                </HBox>
            </VBox>

            <!-- Right: Message Preview / Compose -->
            <VBox spacing="10" style="-fx-padding: 15; -fx-background-color: white;">
                <!-- Tabs for Preview/Compose/Announcements -->
                <TabPane fx:id="rightPanelTabPane" VBox.vgrow="ALWAYS">
                    <!-- Message Preview Tab -->
                    <Tab text="Message Preview" closable="false">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <!-- Message Header -->
                            <VBox spacing="8" style="-fx-background-color: #f9f9f9; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                                <Label fx:id="previewSubjectLabel" text="Select a message to preview"
                                       style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                <HBox spacing="10">
                                    <Label text="From:" style="-fx-font-weight: bold; -fx-min-width: 50;"/>
                                    <Label fx:id="previewFromLabel" text="â€”"/>
                                </HBox>
                                <HBox spacing="10">
                                    <Label text="To:" style="-fx-font-weight: bold; -fx-min-width: 50;"/>
                                    <Label fx:id="previewToLabel" text="â€”"/>
                                </HBox>
                                <HBox spacing="10">
                                    <Label text="Date:" style="-fx-font-weight: bold; -fx-min-width: 50;"/>
                                    <Label fx:id="previewDateLabel" text="â€”"/>
                                </HBox>
                            </VBox>

                            <!-- Message Body -->
                            <TextArea fx:id="previewBodyArea" editable="false" wrapText="true" VBox.vgrow="ALWAYS"
                                      promptText="Message content will appear here..."/>

                            <!-- Action Buttons -->
                            <HBox spacing="10">
                                <Button text="Reply" onAction="#handleReply"
                                        style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                                <Button text="Reply All" onAction="#handleReplyAll"
                                        style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                                <Button text="Forward" onAction="#handleForward"
                                        style="-fx-background-color: #607d8b; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="ðŸ—‘ Delete" onAction="#handleDeleteCurrent"
                                        style="-fx-padding: 8 15; -fx-cursor: hand;"/>
                            </HBox>
                        </VBox>
                    </Tab>

                    <!-- Compose Tab -->
                    <Tab text="Compose" closable="false">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <Label text="New Message" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                            <GridPane hgap="10" vgap="10">
                                <columnConstraints>
                                    <ColumnConstraints minWidth="60" prefWidth="60"/>
                                    <ColumnConstraints hgrow="ALWAYS"/>
                                </columnConstraints>

                                <Label text="To:" GridPane.columnIndex="0" GridPane.rowIndex="0"
                                       style="-fx-font-weight: bold;"/>
                                <HBox spacing="10" GridPane.columnIndex="1" GridPane.rowIndex="0">
                                    <ComboBox fx:id="recipientTypeComboBox" prefWidth="150">
                                        <items>
                                            <String fx:value="Individual"/>
                                            <String fx:value="Group"/>
                                            <String fx:value="Class"/>
                                            <String fx:value="Grade Level"/>
                                            <String fx:value="All Parents"/>
                                            <String fx:value="All Staff"/>
                                        </items>
                                    </ComboBox>
                                    <TextField fx:id="recipientField" promptText="Enter recipients..." HBox.hgrow="ALWAYS"/>
                                </HBox>

                                <Label text="Subject:" GridPane.columnIndex="0" GridPane.rowIndex="1"
                                       style="-fx-font-weight: bold;"/>
                                <TextField fx:id="subjectField" GridPane.columnIndex="1" GridPane.rowIndex="1"
                                           promptText="Message subject..."/>
                            </GridPane>

                            <Label text="Message:" style="-fx-font-weight: bold;"/>
                            <TextArea fx:id="composeBodyArea" wrapText="true" VBox.vgrow="ALWAYS"
                                      promptText="Type your message here..."/>

                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <CheckBox fx:id="highPriorityCheckBox" text="High Priority"/>
                                <CheckBox fx:id="requestReadReceiptCheckBox" text="Request Read Receipt"/>
                                <CheckBox fx:id="sendCopyToMeCheckBox" text="Send Copy to Me"/>
                            </HBox>

                            <HBox spacing="10">
                                <Button text="ðŸ“Ž Attach File" onAction="#handleAttachFile"
                                        style="-fx-padding: 8 15; -fx-cursor: hand;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="ðŸ’¾ Save Draft" onAction="#handleSaveDraft"
                                        style="-fx-background-color: #607d8b; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                                <Button text="âœ‰ Send Message" onAction="#handleSendMessage"
                                        style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 8 15; -fx-font-weight: bold; -fx-cursor: hand;"/>
                            </HBox>
                        </VBox>
                    </Tab>

                    <!-- Announcements Tab -->
                    <Tab text="Announcements" closable="false">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="School Announcements" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                                <Region HBox.hgrow="ALWAYS"/>
                                <Button text="+ Create Announcement" onAction="#handleCreateAnnouncement"
                                        style="-fx-background-color: #ff9800; -fx-text-fill: white; -fx-padding: 6 12; -fx-cursor: hand;"/>
                            </HBox>

                            <ListView fx:id="announcementsListView" VBox.vgrow="ALWAYS">
                                <placeholder>
                                    <Label text="No announcements" style="-fx-text-fill: #9e9e9e;"/>
                                </placeholder>
                            </ListView>
                        </VBox>
                    </Tab>

                    <!-- Templates Tab -->
                    <Tab text="Templates" closable="false">
                        <VBox spacing="10" style="-fx-padding: 10;">
                            <Label text="Message Templates" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                            <ListView fx:id="templatesListView" VBox.vgrow="ALWAYS">
                                <placeholder>
                                    <Label text="No templates" style="-fx-text-fill: #9e9e9e;"/>
                                </placeholder>
                            </ListView>

                            <Button text="Use Template" onAction="#handleUseTemplate"
                                    style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-padding: 8; -fx-cursor: hand;"
                                    maxWidth="Infinity"/>
                        </VBox>
                    </Tab>
                </TabPane>
            </VBox>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT"
              style="-fx-background-color: #fafafa; -fx-padding: 12; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="lastUpdatedLabel" text="Last updated: Just now" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>

            <Region HBox.hgrow="ALWAYS"/>

            <Button text="ðŸ”„ Refresh" onAction="#handleRefresh"
                    style="-fx-padding: 6 15; -fx-cursor: hand;"/>
            <Button text="âš™ Settings" onAction="#handleSettings"
                    style="-fx-padding: 6 15; -fx-cursor: hand;"/>
        </HBox>
    </bottom>

</BorderPane>
