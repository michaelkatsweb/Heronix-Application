<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.HealthScreeningController"
            prefWidth="1200" prefHeight="900"
            styleClass="main-container">


    <!-- Top: Header -->
    <top>
        <VBox spacing="10" styleClass="header-container">
            <Label text="Health Screening" styleClass="text-blue-header"/>
            <Label text="Document mandated health screenings including vision, hearing, scoliosis, BMI, and dental assessments"
                   styleClass="text-subtitle" wrapText="true"/>

            <!-- State Compliance Banner -->
            <HBox spacing="10" styleClass="card, metric-info">
                <Label text="ðŸ“‹" styleClass="icon-16"/>
                <VBox spacing="5">
                    <Label text="State-Mandated Health Screenings" styleClass="text-blue-dark"/>
                    <Label text="Required for grades K, 1, 3, 5, 7, 9, and 11. Results must be documented and reported to state health department."
                           styleClass="text-muted" wrapText="true"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Form -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="scroll-pane-transparent">
            <VBox spacing="20" styleClass="content-padding">

                <!-- Student Selection -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Student Information" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Student *" styleClass="form-label"/>
                            <ComboBox fx:id="studentComboBox" prefWidth="Infinity" promptText="Select student"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Grade" styleClass="form-label"/>
                            <TextField fx:id="gradeField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Date of Birth" styleClass="form-label"/>
                            <TextField fx:id="dateOfBirthField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Age" styleClass="form-label"/>
                            <TextField fx:id="ageField" editable="false" promptText="Auto-filled"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Screening Details -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Screening Details" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Screening Type *" styleClass="form-label"/>
                            <ComboBox fx:id="screeningTypeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="VISION"/>
                                        <String fx:value="HEARING"/>
                                        <String fx:value="SCOLIOSIS"/>
                                        <String fx:value="BMI"/>
                                        <String fx:value="DENTAL"/>
                                        <String fx:value="HEIGHT_WEIGHT"/>
                                        <String fx:value="BLOOD_PRESSURE"/>
                                        <String fx:value="OTHER"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Screening Date *" styleClass="form-label"/>
                            <DatePicker fx:id="screeningDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Screened By *" styleClass="form-label"/>
                            <ComboBox fx:id="screenedByComboBox" prefWidth="Infinity" promptText="Select staff member"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                            <Label text="Location" styleClass="form-label"/>
                            <TextField fx:id="locationField" promptText="e.g., School Health Office, Gymnasium"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="1">
                            <Label text="Grade Level at Screening" styleClass="form-label"/>
                            <TextField fx:id="gradeLevelField" editable="false" promptText="Auto-filled"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Vision Screening (Conditional) -->
                <VBox fx:id="visionScreeningBox" spacing="15" styleClass="form-section, card, metric-success"
                      visible="false" managed="false">
                    <Label text="ðŸ‘ Vision Screening Results" styleClass="section-header, section-title-success"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Right Eye Vision (20/_)" styleClass="form-label"/>
                            <TextField fx:id="rightEyeVisionField" promptText="e.g., 20, 30, 40"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Left Eye Vision (20/_)" styleClass="form-label"/>
                            <TextField fx:id="leftEyeVisionField" promptText="e.g., 20, 30, 40"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Both Eyes Vision (20/_)" styleClass="form-label"/>
                            <TextField fx:id="bothEyesVisionField" promptText="e.g., 20, 30, 40"/>
                        </VBox>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <CheckBox fx:id="wearsGlassesCheckBox" text="Student wears glasses/contact lenses"/>
                            <CheckBox fx:id="visionConcernsCheckBox" text="Vision concerns noted"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="3">
                            <Label text="Vision Notes" styleClass="form-label"/>
                            <TextArea fx:id="visionNotesArea" prefRowCount="3" wrapText="true"
                                      promptText="Document any vision concerns, difficulties, or observations"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Hearing Screening (Conditional) -->
                <VBox fx:id="hearingScreeningBox" spacing="15" styleClass="form-section, card"
                      visible="false" managed="false">
                    <Label text="ðŸ‘‚ Hearing Screening Results" styleClass="section-header, section-title-cyan"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Right Ear Result" styleClass="form-label"/>
                            <ComboBox fx:id="rightEarResultComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PASS"/>
                                        <String fx:value="FAIL"/>
                                        <String fx:value="REFER"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Left Ear Result" styleClass="form-label"/>
                            <ComboBox fx:id="leftEarResultComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PASS"/>
                                        <String fx:value="FAIL"/>
                                        <String fx:value="REFER"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="Right Ear Frequencies Tested" styleClass="form-label"/>
                            <TextField fx:id="rightEarFrequenciesField" promptText="e.g., 500, 1000, 2000, 4000 Hz"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label text="Left Ear Frequencies Tested" styleClass="form-label"/>
                            <TextField fx:id="leftEarFrequenciesField" promptText="e.g., 500, 1000, 2000, 4000 Hz"/>
                        </VBox>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="2">
                            <CheckBox fx:id="usesHearingAidCheckBox" text="Student uses hearing aid"/>
                            <CheckBox fx:id="hearingConcernsCheckBox" text="Hearing concerns noted"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="3" GridPane.columnSpan="2">
                            <Label text="Hearing Notes" styleClass="form-label"/>
                            <TextArea fx:id="hearingNotesArea" prefRowCount="3" wrapText="true"
                                      promptText="Document any hearing concerns, difficulties, or observations"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Scoliosis Screening (Conditional) -->
                <VBox fx:id="scoliosisScreeningBox" spacing="15" styleClass="form-section, card"
                      visible="false" managed="false">
                    <Label text="ðŸ¥ Scoliosis Screening Results" styleClass="section-header, section-title-pink"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Adam's Forward Bend Test" styleClass="form-label"/>
                            <ComboBox fx:id="adamsBendTestComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="NEGATIVE"/>
                                        <String fx:value="POSITIVE"/>
                                        <String fx:value="INCONCLUSIVE"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Rib Hump Observed" styleClass="form-label"/>
                            <ComboBox fx:id="ribHumpComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="NONE"/>
                                        <String fx:value="MILD"/>
                                        <String fx:value="MODERATE"/>
                                        <String fx:value="SEVERE"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                            <CheckBox fx:id="shoulderAsymmetryCheckBox" text="Shoulder asymmetry observed"/>
                            <CheckBox fx:id="hipAsymmetryCheckBox" text="Hip asymmetry observed"/>
                            <CheckBox fx:id="spinalCurvatureCheckBox" text="Spinal curvature noted"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="2">
                            <Label text="Scoliosis Findings" styleClass="form-label"/>
                            <TextArea fx:id="scoliosisFindingsArea" prefRowCount="3" wrapText="true"
                                      promptText="Document any structural abnormalities or concerns"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- BMI Screening (Conditional) -->
                <VBox fx:id="bmiScreeningBox" spacing="15" styleClass="form-section, card, metric-warning"
                      visible="false" managed="false">
                    <Label text="ðŸ“Š BMI Screening Results" styleClass="section-header, section-title-orange-deep"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Height (inches)" styleClass="form-label"/>
                            <TextField fx:id="heightField" promptText="e.g., 60.5"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Weight (pounds)" styleClass="form-label"/>
                            <TextField fx:id="weightField" promptText="e.g., 120.5"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="BMI" styleClass="form-label"/>
                            <TextField fx:id="bmiField" editable="false" promptText="Auto-calculated"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="BMI Percentile" styleClass="form-label"/>
                            <TextField fx:id="bmiPercentileField" promptText="e.g., 75th"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                            <Label text="BMI Category" styleClass="form-label"/>
                            <ComboBox fx:id="bmiCategoryComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="UNDERWEIGHT"/>
                                        <String fx:value="HEALTHY_WEIGHT"/>
                                        <String fx:value="OVERWEIGHT"/>
                                        <String fx:value="OBESE"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="4">
                            <Label text="BMI Notes" styleClass="form-label"/>
                            <TextArea fx:id="bmiNotesArea" prefRowCount="2" wrapText="true"
                                      promptText="Document any weight/growth concerns or recommendations"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Dental Screening (Conditional) -->
                <VBox fx:id="dentalScreeningBox" spacing="15" styleClass="form-section, card"
                      visible="false" managed="false">
                    <Label text="ðŸ¦· Dental Screening Results" styleClass="section-header, section-title-purple"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0" GridPane.columnSpan="2">
                            <CheckBox fx:id="obviousCavitiesCheckBox" text="Obvious cavities or decay observed"/>
                            <CheckBox fx:id="gumDiseaseCheckBox" text="Signs of gum disease"/>
                            <CheckBox fx:id="oralPainCheckBox" text="Student reports oral pain or discomfort"/>
                            <CheckBox fx:id="needsDentalCareCheckBox" text="Needs professional dental care"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                            <Label text="Dental Findings" styleClass="form-label"/>
                            <TextArea fx:id="dentalFindingsArea" prefRowCount="3" wrapText="true"
                                      promptText="Document any dental concerns or observations"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Overall Results -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Overall Screening Results" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Overall Result *" styleClass="form-label"/>
                            <ComboBox fx:id="overallResultComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PASS"/>
                                        <String fx:value="REFER"/>
                                        <String fx:value="FOLLOW_UP_NEEDED"/>
                                        <String fx:value="RESCREEN"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Meets State Requirements" styleClass="form-label"/>
                            <CheckBox fx:id="meetsStateRequirementsCheckBox" text="Screening meets state requirements" selected="true"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Parent Notification (Yellow Highlighted) -->
                <VBox spacing="15" styleClass="form-section, card">
                    <Label text="Parent/Guardian Notification" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0" GridPane.columnSpan="2">
                            <CheckBox fx:id="parentNotifiedCheckBox" text="Parent/Guardian notified of results"/>
                            <CheckBox fx:id="referralProvidedCheckBox" text="Referral information provided to parent"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="Notification Date" styleClass="form-label"/>
                            <DatePicker fx:id="notificationDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label text="Notification Method" styleClass="form-label"/>
                            <ComboBox fx:id="notificationMethodComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="LETTER_SENT_HOME"/>
                                        <String fx:value="PHONE_CALL"/>
                                        <String fx:value="EMAIL"/>
                                        <String fx:value="PARENT_PORTAL"/>
                                        <String fx:value="IN_PERSON"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="3">
                            <Label text="Parent Notification Notes" styleClass="form-label"/>
                            <TextArea fx:id="parentNotificationNotesArea" prefRowCount="2" wrapText="true"
                                      promptText="Document parent communication, concerns, or follow-up actions"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Follow-Up &amp; Referrals (Conditional) -->
                <VBox fx:id="followUpBox" spacing="15" styleClass="form-section, card, metric-danger"
                      visible="false" managed="false">
                    <Label text="âš  Follow-Up Required" styleClass="section-header, section-title-danger"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Referral Type" styleClass="form-label"/>
                            <ComboBox fx:id="referralTypeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="OPHTHALMOLOGIST"/>
                                        <String fx:value="OPTOMETRIST"/>
                                        <String fx:value="AUDIOLOGIST"/>
                                        <String fx:value="ORTHOPEDIC_SPECIALIST"/>
                                        <String fx:value="PRIMARY_CARE_PHYSICIAN"/>
                                        <String fx:value="DENTIST"/>
                                        <String fx:value="NUTRITIONIST"/>
                                        <String fx:value="OTHER_SPECIALIST"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Follow-Up Date" styleClass="form-label"/>
                            <DatePicker fx:id="followUpDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="2">
                            <Label text="Referral Reason" styleClass="form-label"/>
                            <TextArea fx:id="referralReasonArea" prefRowCount="3" wrapText="true"
                                      promptText="Explain why student is being referred for professional evaluation"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="2" GridPane.columnSpan="2">
                            <Label text="Follow-Up Instructions" styleClass="form-label"/>
                            <TextArea fx:id="followUpInstructionsArea" prefRowCount="2" wrapText="true"
                                      promptText="Instructions for parent, student, or school staff"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Additional Notes -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Additional Notes" styleClass="section-header, section-title-dark"/>

                    <TextArea fx:id="notesArea" prefRowCount="4" wrapText="true"
                              promptText="Document any additional observations, concerns, or relevant information"/>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- Bottom: Button Bar -->
    <bottom>
        <HBox spacing="10" styleClass="footer-padded" alignment="CENTER_RIGHT">
            <Button text="Save Screening" onAction="#handleSave"
                    styleClass="button-primary"/>
            <Button text="Clear Form" onAction="#handleClear"
                    styleClass="button-primary"/>
            <Button text="Close" onAction="#handleClose"
                    styleClass="button-primary"/>
        </HBox>
    </bottom>

</BorderPane>
