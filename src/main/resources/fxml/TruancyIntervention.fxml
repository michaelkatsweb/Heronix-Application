<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<!--
Truancy Intervention Management View
Location: src/main/resources/fxml/TruancyIntervention.fxml
-->

<VBox xmlns="http://javafx.com/javafx/21"
      xmlns:fx="http://javafx.com/fxml/1"
      fx:id="rootContainer"
      fx:controller="com.heronix.ui.controller.TruancyInterventionController"
      styleClass="root"
      spacing="20">

    <padding>
        <Insets top="20" right="20" bottom="20" left="20"/>
    </padding>

    <!-- Header Section -->
    <HBox alignment="CENTER_LEFT" spacing="15" styleClass="card">
        <Label text="âš–ï¸ Truancy Intervention Management" styleClass="label-title"/>
        <Region HBox.hgrow="ALWAYS"/>
        <Button text="ðŸ”„ Refresh" onAction="#handleRefresh" styleClass="button-secondary"/>
    </HBox>

    <!-- Summary Cards -->
    <HBox spacing="15">
        <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
            <Label text="ðŸ“Š Total Cases" styleClass="label"/>
            <Label fx:id="totalCasesLabel" text="0"
                   style="-fx-font-size: 32; -fx-font-weight: bold;"/>
        </VBox>

        <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
            <Label text="âœ… Active Cases" styleClass="label"/>
            <Label fx:id="activeCasesLabel" text="0"
                   styleClass="stat-value-32-green-material"/>
        </VBox>

        <VBox spacing="10" styleClass="card" HBox.hgrow="ALWAYS">
            <Label text="âš–ï¸ Court Referrals" styleClass="label"/>
            <Label fx:id="courtReferralsLabel" text="0"
                   styleClass="stat-value-32-red"/>
        </VBox>
    </HBox>

    <!-- Main Tab Pane -->
    <TabPane fx:id="mainTabPane" VBox.vgrow="ALWAYS" tabClosingPolicy="UNAVAILABLE">

        <!-- ========== ACTIVE CASES TAB ========== -->
        <Tab fx:id="activeCasesTab" text="ðŸ“‹ Active Cases" closable="false">
            <VBox spacing="20">
                <padding>
                    <Insets top="20" right="20" bottom="20" left="20"/>
                </padding>

                <!-- Filter Section -->
                <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
                    <Label text="Filter by Severity:" styleClass="form-label"/>
                    <ComboBox fx:id="severityFilterComboBox" promptText="All Severities"
                              prefWidth="200" onAction="#handleFilterBySeverity"/>
                    <Region HBox.hgrow="ALWAYS"/>
                </HBox>

                <!-- Active Cases Table -->
                <VBox spacing="15" styleClass="card" VBox.vgrow="ALWAYS">
                    <Label text="ðŸ“‹ Active Truancy Cases" styleClass="label-title"/>

                    <TableView fx:id="activeCasesTable" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="caseIdCol" text="Case ID"
                                         prefWidth="120" minWidth="100"/>
                            <TableColumn fx:id="studentNameCol" text="Student Name"
                                         prefWidth="180" minWidth="150"/>
                            <TableColumn fx:id="gradeCol" text="Grade"
                                         prefWidth="70" minWidth="60"/>
                            <TableColumn fx:id="absencesCol" text="Absences"
                                         prefWidth="90" minWidth="80"/>
                            <TableColumn fx:id="severityCol" text="Severity"
                                         prefWidth="130" minWidth="110"/>
                            <TableColumn fx:id="statusCol" text="Status"
                                         prefWidth="120" minWidth="100"/>
                            <TableColumn fx:id="openedDateCol" text="Opened Date"
                                         prefWidth="130" minWidth="110"/>
                        </columns>
                        <placeholder>
                            <Label text="No active truancy cases"/>
                        </placeholder>
                    </TableView>
                </VBox>
            </VBox>
        </Tab>

        <!-- ========== NEW CASE TAB ========== -->
        <Tab fx:id="newCaseTab" text="âž• New Case" closable="false">
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="20">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="âž• Open New Truancy Case" styleClass="label-title"/>

                    <!-- Case Information -->
                    <VBox spacing="15" styleClass="card">
                        <Label text="ðŸ“‹ Case Information" style="-fx-font-size: 16; -fx-font-weight: bold;"/>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Student:" styleClass="form-label"/>
                                <ComboBox fx:id="studentComboBox" promptText="Select Student"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Unexcused Absences:" styleClass="form-label"/>
                                <Spinner fx:id="absencesSpinner" prefWidth="150" editable="true"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="5">
                            <Label text="Reason for Truancy Case:" styleClass="form-label"/>
                            <TextArea fx:id="reasonArea" prefHeight="120" wrapText="true"
                                      promptText="Describe the reason for opening this truancy case..."/>
                        </VBox>
                    </VBox>

                    <!-- Action Buttons -->
                    <HBox spacing="15" alignment="CENTER">
                        <Button text="âœ… Open Truancy Case" onAction="#handleOpenCase"
                                styleClass="button-primary" minWidth="180"/>
                    </HBox>

                    <!-- Result Display -->
                    <VBox spacing="10" styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="ðŸ“„ Result" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                        <TextArea fx:id="newCaseResultArea" editable="false" wrapText="true"
                                  prefHeight="250" promptText="Open a case to see the result..."/>
                    </VBox>
                </VBox>
            </ScrollPane>
        </Tab>

        <!-- ========== ADD INTERVENTION TAB ========== -->
        <Tab fx:id="interventionTab" text="ðŸ¤ Add Intervention" closable="false">
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="20">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="ðŸ¤ Add Intervention to Case" styleClass="label-title"/>

                    <!-- Intervention Information -->
                    <VBox spacing="15" styleClass="card">
                        <Label text="ðŸ“‹ Intervention Details" style="-fx-font-size: 16; -fx-font-weight: bold;"/>

                        <VBox spacing="5">
                            <Label text="Case ID:" styleClass="form-label"/>
                            <TextField fx:id="caseIdField" promptText="Enter Case ID (e.g., TC-12345-2025)"/>
                        </VBox>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Intervention Type:" styleClass="form-label"/>
                                <ComboBox fx:id="interventionTypeComboBox" promptText="Select Intervention Type"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>

                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Assigned To:" styleClass="form-label"/>
                                <TextField fx:id="assignedToField" promptText="e.g., School Counselor, Truancy Officer"
                                           prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="5">
                            <Label text="Intervention Description:" styleClass="form-label"/>
                            <TextArea fx:id="interventionDescriptionArea" prefHeight="120" wrapText="true"
                                      promptText="Describe the intervention strategy and goals..."/>
                        </VBox>
                    </VBox>

                    <!-- Action Buttons -->
                    <HBox spacing="15" alignment="CENTER">
                        <Button text="âœ… Add Intervention" onAction="#handleAddIntervention"
                                styleClass="button-primary" minWidth="180"/>
                    </HBox>

                    <!-- Result Display -->
                    <VBox spacing="10" styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="ðŸ“„ Result" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                        <TextArea fx:id="interventionResultArea" editable="false" wrapText="true"
                                  prefHeight="200" promptText="Add an intervention to see the result..."/>
                    </VBox>
                </VBox>
            </ScrollPane>
        </Tab>

        <!-- ========== CLOSE CASE TAB ========== -->
        <Tab fx:id="closeCaseTab" text="âœ… Close Case" closable="false">
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="20">
                    <padding>
                        <Insets top="20" right="20" bottom="20" left="20"/>
                    </padding>

                    <Label text="âœ… Close Truancy Case" styleClass="label-title"/>

                    <!-- Case Closure Information -->
                    <VBox spacing="15" styleClass="card">
                        <Label text="ðŸ“‹ Case Closure Details" style="-fx-font-size: 16; -fx-font-weight: bold;"/>

                        <VBox spacing="5">
                            <Label text="Case ID:" styleClass="form-label"/>
                            <TextField fx:id="closeCaseIdField" promptText="Enter Case ID to close"/>
                        </VBox>

                        <HBox spacing="15">
                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Resolution:" styleClass="form-label"/>
                                <ComboBox fx:id="resolutionComboBox" promptText="Select Resolution"
                                          prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>

                            <VBox spacing="5" HBox.hgrow="ALWAYS">
                                <Label text="Closed By:" styleClass="form-label"/>
                                <TextField fx:id="closedByField" promptText="Your name or role"
                                           prefWidth="Infinity" maxWidth="Infinity"/>
                            </VBox>
                        </HBox>

                        <VBox spacing="5">
                            <Label text="Resolution Notes:" styleClass="form-label"/>
                            <TextArea fx:id="resolutionNotesArea" prefHeight="120" wrapText="true"
                                      promptText="Enter any additional notes about the case resolution..."/>
                        </VBox>
                    </VBox>

                    <!-- Action Buttons -->
                    <HBox spacing="15" alignment="CENTER">
                        <Button text="âœ… Close Case" onAction="#handleCloseCase"
                                styleClass="button-success" minWidth="180"/>
                    </HBox>

                    <!-- Result Display -->
                    <VBox spacing="10" styleClass="card" VBox.vgrow="ALWAYS">
                        <Label text="ðŸ“„ Result" style="-fx-font-size: 16; -fx-font-weight: bold;"/>
                        <TextArea fx:id="closeCaseResultArea" editable="false" wrapText="true"
                                  prefHeight="250" promptText="Close a case to see the result..."/>
                    </VBox>
                </VBox>
            </ScrollPane>
        </Tab>
    </TabPane>
</VBox>
