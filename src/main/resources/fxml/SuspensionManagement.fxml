<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.SuspensionManagementController"
            prefWidth="1400" prefHeight="950"
            style="-fx-background-color: #f5f5f5;">

    <!-- Top: Header -->
    <top>
        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 0 0 1 0;">
            <Label text="Suspension Management" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
            <Label text="Document and track in-school (ISS) and out-of-school (OSS) suspensions with due process compliance"
                   style="-fx-font-size: 13px; -fx-text-fill: #666;" wrapText="true"/>

            <!-- Legal Compliance Banner -->
            <HBox spacing="10" style="-fx-background-color: #ffebee; -fx-padding: 12; -fx-border-radius: 5; -fx-background-radius: 5;">
                <Label text="âš–" style="-fx-font-size: 16px;"/>
                <VBox spacing="5">
                    <Label text="Due Process & Legal Compliance Required"
                           style="-fx-font-weight: bold; -fx-font-size: 13px; -fx-text-fill: #b71c1c;"/>
                    <Label text="Parent notification, opportunity to appeal, and re-entry planning are required by law. Document all communications and meetings."
                           style="-fx-font-size: 12px; -fx-text-fill: #424242;" wrapText="true"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Form -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent;">
            <VBox spacing="20" style="-fx-padding: 20;">

                <!-- Student & Suspension Details -->
                <VBox spacing="15" styleClass="form-section" style="-fx-background-color: white; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="Student & Suspension Details" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Student *" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="studentComboBox" prefWidth="Infinity" promptText="Select student"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Grade" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="gradeField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Student ID" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="studentIdField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Campus" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="campusField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="Suspension Type *" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="suspensionTypeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="IN_SCHOOL"/>
                                        <String fx:value="OUT_OF_SCHOOL"/>
                                        <String fx:value="EMERGENCY_REMOVAL"/>
                                        <String fx:value="EXTENDED_OSS"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label text="Issued By *" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="issuedByComboBox" prefWidth="Infinity" promptText="Select administrator"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="1">
                            <Label text="Status" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="statusComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PENDING"/>
                                        <String fx:value="ACTIVE"/>
                                        <String fx:value="COMPLETED"/>
                                        <String fx:value="APPEALED"/>
                                        <String fx:value="REDUCED"/>
                                        <String fx:value="OVERTURNED"/>
                                        <String fx:value="CONVERTED_TO_ISS"/>
                                        <String fx:value="CONVERTED_TO_OSS"/>
                                        <String fx:value="EXTENDED"/>
                                        <String fx:value="EXPIRED"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Suspension Dates -->
                <VBox spacing="15" styleClass="form-section" style="-fx-background-color: white; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="Suspension Dates" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Start Date *" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="startDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="End Date *" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="endDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Number of Days *" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="daysCountField" promptText="Auto-calculated"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Days Remaining" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="daysRemainingField" editable="false" promptText="Auto-calculated"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Incident Details -->
                <VBox spacing="15" styleClass="form-section" style="-fx-background-color: white; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="Incident Details" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;"/>

                    <VBox spacing="5">
                        <Label text="Suspension Reason *" style="-fx-font-weight: bold;"/>
                        <TextArea fx:id="suspensionReasonArea" prefRowCount="3" wrapText="true"
                                  promptText="Brief summary of the reason for suspension (policy violation, offense category)"/>
                    </VBox>

                    <VBox spacing="5">
                        <Label text="Incident Description" style="-fx-font-weight: bold;"/>
                        <TextArea fx:id="incidentDescriptionArea" prefRowCount="4" wrapText="true"
                                  promptText="Detailed description of the incident that led to suspension"/>
                    </VBox>
                </VBox>

                <!-- In-School Suspension Details (Conditional) -->
                <VBox fx:id="issDetailsBox" spacing="15" styleClass="form-section"
                      style="-fx-background-color: #e3f2fd; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;"
                      visible="false" managed="false">
                    <Label text="ðŸ“š In-School Suspension (ISS) Details" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #1565c0;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="ISS Room Assignment" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="issRoomField" promptText="e.g., Room 105, ISS Center"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="ISS Supervisor" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="issSupervisorComboBox" prefWidth="Infinity" promptText="Select supervisor"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Days Attended" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="daysAttendedField" promptText="Number of days attended"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Daily Notes" style="-fx-font-weight: bold;"/>
                            <TextArea fx:id="dailyNotesArea" prefRowCount="3" wrapText="true"
                                      promptText="Daily check-in notes, behavior observations, work completion"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Out-of-School Suspension Details (Conditional) -->
                <VBox fx:id="ossDetailsBox" spacing="15" styleClass="form-section"
                      style="-fx-background-color: #fff3e0; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;"
                      visible="false" managed="false">
                    <Label text="ðŸ  Out-of-School Suspension (OSS) Details" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>

                    <VBox spacing="5">
                        <Label text="Alternative Education Placement" style="-fx-font-weight: bold;"/>
                        <TextField fx:id="alternativePlacementField" promptText="Alternative education site or program (for extended OSS)"/>
                    </VBox>

                    <VBox spacing="5">
                        <Label text="Homework/Assignments Information" style="-fx-font-weight: bold;"/>
                        <HBox spacing="20">
                            <CheckBox fx:id="homeworkProvidedCheckBox" text="Homework/assignments provided"/>
                            <CheckBox fx:id="homeworkCompletedCheckBox" text="Student completed work"/>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- Parent Notification (Yellow Highlighted - Required by Law) -->
                <VBox spacing="15" styleClass="form-section"
                      style="-fx-background-color: #fff9c4; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="âš  Parent/Guardian Notification (Required by Law)" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #f57f17;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="parentNotifiedCheckBox" text="Parent/Guardian Notified"
                                      style="-fx-font-weight: bold;"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Notification Date" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="parentNotificationDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Notification Method" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="parentNotificationMethodComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PHONE"/>
                                        <String fx:value="EMAIL"/>
                                        <String fx:value="IN_PERSON"/>
                                        <String fx:value="CERTIFIED_MAIL"/>
                                        <String fx:value="REGULAR_MAIL"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Notification Document Path" style="-fx-font-weight: bold;"/>
                            <HBox spacing="10">
                                <TextField fx:id="notificationDocumentField" prefWidth="Infinity" editable="false"
                                           promptText="Path to parent notification letter"/>
                                <Button text="Browse..." onAction="#handleBrowseDocument"
                                        style="-fx-background-color: #757575; -fx-text-fill: white;"/>
                            </HBox>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Re-Entry Meeting & Planning -->
                <VBox spacing="15" styleClass="form-section" style="-fx-background-color: white; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="Re-Entry Meeting & Planning" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #333;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="reentryMeetingRequiredCheckBox" text="Re-Entry Meeting Required"
                                      style="-fx-font-weight: bold;"/>
                            <CheckBox fx:id="reentryMeetingCompletedCheckBox" text="Meeting Completed"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Re-Entry Meeting Date" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="reentryMeetingDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Re-Entry Plan / Conditions" style="-fx-font-weight: bold;"/>
                            <TextArea fx:id="reentryPlanArea" prefRowCount="4" wrapText="true"
                                      promptText="Conditions for student's return, behavior expectations, support plan, monitoring requirements"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Appeal Process (Conditional) -->
                <VBox fx:id="appealBox" spacing="15" styleClass="form-section"
                      style="-fx-background-color: #fce4ec; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;"
                      visible="false" managed="false">
                    <Label text="âš– Appeal Process" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #880e4f;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="appealFiledCheckBox" text="Appeal Filed" style="-fx-font-weight: bold;"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Appeal Hearing Date" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="appealHearingDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Appeal Outcome" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="appealOutcomeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PENDING"/>
                                        <String fx:value="UPHELD"/>
                                        <String fx:value="OVERTURNED"/>
                                        <String fx:value="REDUCED"/>
                                        <String fx:value="CONVERTED"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Appeal Decision Notes" style="-fx-font-weight: bold;"/>
                            <TextArea fx:id="appealDecisionArea" prefRowCount="3" wrapText="true"
                                      promptText="Document the appeal hearing outcome and any modifications to the suspension"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Expulsion Recommendation (Red Highlighted - Serious) -->
                <VBox fx:id="expulsionBox" spacing="15" styleClass="form-section"
                      style="-fx-background-color: #ffebee; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;"
                      visible="false" managed="false">
                    <Label text="ðŸš¨ Expulsion Recommendation" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #b71c1c;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="expulsionRecommendedCheckBox" text="Expulsion Recommended to School Board"
                                      style="-fx-font-weight: bold; -fx-text-fill: #d32f2f;"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Expulsion Hearing Date" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="expulsionHearingDatePicker" prefWidth="Infinity"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Completion Verification -->
                <VBox spacing="15" styleClass="form-section" style="-fx-background-color: #e8f5e9; -fx-padding: 20; -fx-border-radius: 5; -fx-background-radius: 5;">
                    <Label text="âœ“ Completion Verification" styleClass="section-header"
                           style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="completionVerifiedCheckBox" text="Suspension Completion Verified"
                                      style="-fx-font-weight: bold;"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Verification Date" style="-fx-font-weight: bold;"/>
                            <DatePicker fx:id="completionVerificationDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Verified By" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="verifiedByComboBox" prefWidth="Infinity" promptText="Select staff member"/>
                        </VBox>
                    </GridPane>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- Bottom: Button Bar -->
    <bottom>
        <HBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;" alignment="CENTER_RIGHT">
            <Button text="Save Suspension" onAction="#handleSave"
                    style="-fx-background-color: #c62828; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 10 30; -fx-cursor: hand;"/>
            <Button text="Clear Form" onAction="#handleClear"
                    style="-fx-background-color: #757575; -fx-text-fill: white; -fx-padding: 10 30; -fx-cursor: hand;"/>
            <Button text="Close" onAction="#handleClose"
                    style="-fx-background-color: #616161; -fx-text-fill: white; -fx-padding: 10 30; -fx-cursor: hand;"/>
        </HBox>
    </bottom>

</BorderPane>
