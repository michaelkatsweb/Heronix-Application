<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.collections.FXCollections?>
<?import java.lang.String?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.SuspensionManagementController"
            prefWidth="1400" prefHeight="950"
            styleClass="main-container">


    <!-- Top: Header -->
    <top>
        <VBox spacing="10" styleClass="header-container">
            <Label text="Suspension Management" styleClass="header-danger"/>
            <Label text="Document and track in-school (ISS) and out-of-school (OSS) suspensions with due process compliance"
                   styleClass="text-subtitle" wrapText="true"/>

            <!-- Legal Compliance Banner -->
            <HBox spacing="10" styleClass="card, metric-danger">
                <Label text="âš–" styleClass="icon-16"/>
                <VBox spacing="5">
                    <Label text="Due Process &amp; Legal Compliance Required" styleClass="text-danger-dark"/>
                    <Label text="Parent notification, opportunity to appeal, and re-entry planning are required by law. Document all communications and meetings."
                           styleClass="text-muted" wrapText="true"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Form -->
    <center>
        <ScrollPane fitToWidth="true" styleClass="scroll-pane-transparent">
            <VBox spacing="20" styleClass="content-padding">

                <!-- Student &amp; Suspension Details -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Student &amp; Suspension Details" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Student *" styleClass="form-label"/>
                            <ComboBox fx:id="studentComboBox" prefWidth="Infinity" promptText="Select student"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Grade" styleClass="form-label"/>
                            <TextField fx:id="gradeField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Student ID" styleClass="form-label"/>
                            <TextField fx:id="studentIdField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Campus" styleClass="form-label"/>
                            <TextField fx:id="campusField" editable="false" promptText="Auto-filled"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="Suspension Type *" styleClass="form-label"/>
                            <ComboBox fx:id="suspensionTypeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="IN_SCHOOL"/>
                                        <String fx:value="OUT_OF_SCHOOL"/>
                                        <String fx:value="EMERGENCY_REMOVAL"/>
                                        <String fx:value="EXTENDED_OSS"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1">
                            <Label text="Issued By *" styleClass="form-label"/>
                            <ComboBox fx:id="issuedByComboBox" prefWidth="Infinity" promptText="Select administrator"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="1">
                            <Label text="Status" styleClass="form-label"/>
                            <ComboBox fx:id="statusComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PENDING"/>
                                        <String fx:value="ACTIVE"/>
                                        <String fx:value="COMPLETED"/>
                                        <String fx:value="APPEALED"/>
                                        <String fx:value="REDUCED"/>
                                        <String fx:value="OVERTURNED"/>
                                        <String fx:value="CONVERTED_TO_ISS"/>
                                        <String fx:value="CONVERTED_TO_OSS"/>
                                        <String fx:value="EXTENDED"/>
                                        <String fx:value="EXPIRED"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Suspension Dates -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Suspension Dates" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Start Date *" styleClass="form-label"/>
                            <DatePicker fx:id="startDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="End Date *" styleClass="form-label"/>
                            <DatePicker fx:id="endDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Number of Days *" styleClass="form-label"/>
                            <TextField fx:id="daysCountField" promptText="Auto-calculated"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Days Remaining" styleClass="form-label"/>
                            <TextField fx:id="daysRemainingField" editable="false" promptText="Auto-calculated"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Incident Details -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Incident Details" styleClass="section-header, section-title-dark"/>

                    <VBox spacing="5">
                        <Label text="Suspension Reason *" styleClass="form-label"/>
                        <TextArea fx:id="suspensionReasonArea" prefRowCount="3" wrapText="true"
                                  promptText="Brief summary of the reason for suspension (policy violation, offense category)"/>
                    </VBox>

                    <VBox spacing="5">
                        <Label text="Incident Description" styleClass="form-label"/>
                        <TextArea fx:id="incidentDescriptionArea" prefRowCount="4" wrapText="true"
                                  promptText="Detailed description of the incident that led to suspension"/>
                    </VBox>
                </VBox>

                <!-- In-School Suspension Details (Conditional) -->
                <VBox fx:id="issDetailsBox" spacing="15" styleClass="form-section, card, metric-info"
                      visible="false" managed="false">
                    <Label text="ðŸ“š In-School Suspension (ISS) Details" styleClass="section-header, section-title-cyan-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="ISS Room Assignment" styleClass="form-label"/>
                            <TextField fx:id="issRoomField" promptText="e.g., Room 105, ISS Center"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="ISS Supervisor" styleClass="form-label"/>
                            <ComboBox fx:id="issSupervisorComboBox" prefWidth="Infinity" promptText="Select supervisor"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Days Attended" styleClass="form-label"/>
                            <TextField fx:id="daysAttendedField" promptText="Number of days attended"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Daily Notes" styleClass="form-label"/>
                            <TextArea fx:id="dailyNotesArea" prefRowCount="3" wrapText="true"
                                      promptText="Daily check-in notes, behavior observations, work completion"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Out-of-School Suspension Details (Conditional) -->
                <VBox fx:id="ossDetailsBox" spacing="15" styleClass="form-section, card, metric-warning"
                      visible="false" managed="false">
                    <Label text="ðŸ  Out-of-School Suspension (OSS) Details" styleClass="section-header, section-title-orange-amber"/>

                    <VBox spacing="5">
                        <Label text="Alternative Education Placement" styleClass="form-label"/>
                        <TextField fx:id="alternativePlacementField" promptText="Alternative education site or program (for extended OSS)"/>
                    </VBox>

                    <VBox spacing="5">
                        <Label text="Homework/Assignments Information" styleClass="form-label"/>
                        <HBox spacing="20">
                            <CheckBox fx:id="homeworkProvidedCheckBox" text="Homework/assignments provided"/>
                            <CheckBox fx:id="homeworkCompletedCheckBox" text="Student completed work"/>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- Parent Notification (Yellow Highlighted - Required by Law) -->
                <VBox spacing="15" styleClass="form-section, card">
                    <Label text="âš  Parent/Guardian Notification (Required by Law)" styleClass="section-header, section-title-warning"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="parentNotifiedCheckBox" text="Parent/Guardian Notified"
                                      styleClass="form-label"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Notification Date" styleClass="form-label"/>
                            <DatePicker fx:id="parentNotificationDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Notification Method" styleClass="form-label"/>
                            <ComboBox fx:id="parentNotificationMethodComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PHONE"/>
                                        <String fx:value="EMAIL"/>
                                        <String fx:value="IN_PERSON"/>
                                        <String fx:value="CERTIFIED_MAIL"/>
                                        <String fx:value="REGULAR_MAIL"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Notification Document Path" styleClass="form-label"/>
                            <HBox spacing="10">
                                <TextField fx:id="notificationDocumentField" prefWidth="Infinity" editable="false"
                                           promptText="Path to parent notification letter"/>
                                <Button text="Browse..." onAction="#handleBrowseDocument"
                                        styleClass="button-secondary"/>
                            </HBox>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Re-Entry Meeting &amp; Planning -->
                <VBox spacing="15" styleClass="form-section, form-section-white">
                    <Label text="Re-Entry Meeting &amp; Planning" styleClass="section-header, section-title-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="reentryMeetingRequiredCheckBox" text="Re-Entry Meeting Required"
                                      styleClass="form-label"/>
                            <CheckBox fx:id="reentryMeetingCompletedCheckBox" text="Meeting Completed"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Re-Entry Meeting Date" styleClass="form-label"/>
                            <DatePicker fx:id="reentryMeetingDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Re-Entry Plan / Conditions" styleClass="form-label"/>
                            <TextArea fx:id="reentryPlanArea" prefRowCount="4" wrapText="true"
                                      promptText="Conditions for student's return, behavior expectations, support plan, monitoring requirements"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Appeal Process (Conditional) -->
                <VBox fx:id="appealBox" spacing="15" styleClass="form-section, card"
                      visible="false" managed="false">
                    <Label text="âš– Appeal Process" styleClass="section-header, section-title-pink-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="appealFiledCheckBox" text="Appeal Filed" styleClass="form-label"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Appeal Hearing Date" styleClass="form-label"/>
                            <DatePicker fx:id="appealHearingDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Appeal Outcome" styleClass="form-label"/>
                            <ComboBox fx:id="appealOutcomeComboBox" prefWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="PENDING"/>
                                        <String fx:value="UPHELD"/>
                                        <String fx:value="OVERTURNED"/>
                                        <String fx:value="REDUCED"/>
                                        <String fx:value="CONVERTED"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Appeal Decision Notes" styleClass="form-label"/>
                            <TextArea fx:id="appealDecisionArea" prefRowCount="3" wrapText="true"
                                      promptText="Document the appeal hearing outcome and any modifications to the suspension"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Expulsion Recommendation (Red Highlighted - Serious) -->
                <VBox fx:id="expulsionBox" spacing="15" styleClass="form-section, card, metric-danger"
                      visible="false" managed="false">
                    <Label text="ðŸš¨ Expulsion Recommendation" styleClass="section-header, section-title-danger-dark"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="expulsionRecommendedCheckBox" text="Expulsion Recommended to School Board"
                                      styleClass="form-label"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Expulsion Hearing Date" styleClass="form-label"/>
                            <DatePicker fx:id="expulsionHearingDatePicker" prefWidth="Infinity"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Completion Verification -->
                <VBox spacing="15" styleClass="form-section, card, metric-success">
                    <Label text="âœ“ Completion Verification" styleClass="section-header, section-title-success"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="8" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <CheckBox fx:id="completionVerifiedCheckBox" text="Suspension Completion Verified"
                                      styleClass="form-label"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Verification Date" styleClass="form-label"/>
                            <DatePicker fx:id="completionVerificationDatePicker" prefWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Verified By" styleClass="form-label"/>
                            <ComboBox fx:id="verifiedByComboBox" prefWidth="Infinity" promptText="Select staff member"/>
                        </VBox>
                    </GridPane>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- Bottom: Button Bar -->
    <bottom>
        <HBox spacing="10" styleClass="footer-padded" alignment="CENTER_RIGHT">
            <Button text="Save Suspension" onAction="#handleSave"
                    styleClass="button-primary"/>
            <Button text="Clear Form" onAction="#handleClear"
                    styleClass="button-primary"/>
            <Button text="Close" onAction="#handleClose"
                    styleClass="button-primary"/>
        </HBox>
    </bottom>

</BorderPane>
