<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.CourseConflictResolutionController"
            prefWidth="1500" prefHeight="950">


    <!-- Top: Header -->
    <top>
        <VBox spacing="15" styleClass="card">
            <Label text="Course Conflict Resolution Center"
                   styleClass="page-title-white"/>
            <Label text="Detect, analyze, and resolve scheduling conflicts with AI-powered recommendations"
                   styleClass="text-white"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.35" styleClass="main-container">

            <!-- Left: Conflict List & Analytics -->
            <VBox spacing="15" styleClass="form-panel">

                <!-- Conflict Summary Cards -->
                <GridPane hgap="10" vgap="10">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="50"/>
                        <ColumnConstraints percentWidth="50"/>
                    </columnConstraints>

                    <!-- Total Conflicts -->
                    <VBox spacing="5" styleClass="card, metric-danger"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Total Conflicts" styleClass="text-muted"/>
                        <Label fx:id="totalConflictsLabel" text="0" styleClass="stat-value-24-red-dark"/>
                    </VBox>

                    <!-- Critical Conflicts -->
                    <VBox spacing="5" styleClass="card, metric-warning"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Critical" styleClass="text-muted"/>
                        <Label fx:id="criticalConflictsLabel" text="0" styleClass="stat-value-24-orange-deep"/>
                    </VBox>

                    <!-- Teacher Conflicts -->
                    <VBox spacing="5" styleClass="card, metric-info"
                          GridPane.columnIndex="0" GridPane.rowIndex="1">
                        <Label text="Teacher Conflicts" styleClass="text-muted"/>
                        <Label fx:id="teacherConflictsLabel" text="0" styleClass="stat-value-24-blue-dark"/>
                    </VBox>

                    <!-- Room Conflicts -->
                    <VBox spacing="5" styleClass="card"
                          GridPane.columnIndex="1" GridPane.rowIndex="1">
                        <Label text="Room Conflicts" styleClass="text-muted"/>
                        <Label fx:id="roomConflictsLabel" text="0" styleClass="stat-value-24-purple-deep"/>
                    </VBox>
                </GridPane>

                <!-- Conflict Type Breakdown Chart -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Conflict Type Breakdown" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                    <PieChart fx:id="conflictTypeChart" legendVisible="false" prefHeight="180"/>
                </VBox>

                <!-- Filters -->
                <VBox spacing="10" styleClass="card, metric-success">
                    <Label text="Filters" styleClass="section-title-filters-green"/>

                    <Label text="Conflict Type:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="conflictTypeFilterComboBox" promptText="All Types" maxWidth="Infinity"/>

                    <Label text="Severity:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="severityFilterComboBox" promptText="All Severities" maxWidth="Infinity"/>

                    <Label text="Status:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="statusFilterComboBox" promptText="All Statuses" maxWidth="Infinity"/>

                    <CheckBox fx:id="showResolvedCheckBox" text="Show Resolved" onAction="#handleFilterChange"/>

                    <Button fx:id="applyFiltersButton" text="Apply Filters" onAction="#handleFilterChange"
                            styleClass="button-primary" maxWidth="Infinity"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="10">
                    <Button fx:id="scanConflictsButton" text="ðŸ” Scan for New Conflicts" onAction="#handleScanConflicts"
                            styleClass="button-primary" maxWidth="Infinity"/>

                    <Button fx:id="autoResolveButton" text="âš¡ Auto-Resolve All" onAction="#handleAutoResolveAll"
                            styleClass="header-purple" maxWidth="Infinity"/>

                    <Button fx:id="exportConflictsButton" text="ðŸ“Š Export Report" onAction="#handleExportConflicts"
                            styleClass="button-primary" maxWidth="Infinity"/>
                </VBox>

            </VBox>

            <!-- Right: Conflict Details & Resolution -->
            <BorderPane styleClass="card">

                <!-- Conflict List -->
                <top>
                    <VBox spacing="10" style="-fx-padding: 15;">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Label text="Active Conflicts" styleClass="section-title"/>
                            <Label fx:id="conflictListCountLabel" text="(0)" styleClass="text-muted"/>

                            <Region HBox.hgrow="ALWAYS"/>

                            <ComboBox fx:id="sortByComboBox" promptText="Sort by..." prefWidth="150"/>
                        </HBox>

                        <TableView fx:id="conflictsTableView" VBox.vgrow="ALWAYS" prefHeight="300">
                            <columns>
                                <TableColumn fx:id="severityColumn" text="!" prefWidth="40"/>
                                <TableColumn fx:id="typeColumn" text="Type" prefWidth="120"/>
                                <TableColumn fx:id="descriptionColumn" text="Description" prefWidth="300"/>
                                <TableColumn fx:id="affectedColumn" text="Affected" prefWidth="150"/>
                                <TableColumn fx:id="timeColumn" text="Time/Period" prefWidth="120"/>
                                <TableColumn fx:id="statusColumn" text="Status" prefWidth="100"/>
                                <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="120"/>
                            </columns>
                        </TableView>
                    </VBox>
                </top>

                <!-- Selected Conflict Details -->
                <center>
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="20" style="-fx-padding: 20;">

                            <!-- Conflict Information -->
                            <VBox spacing="15" styleClass="card, metric-danger">
                                <HBox spacing="15" alignment="CENTER_LEFT">
                                    <Label text="âš  Conflict Details" styleClass="section-title-16-red"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="conflictIdLabel" text="ID: N/A" styleClass="text-muted"/>
                                </HBox>

                                <GridPane hgap="15" vgap="12">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="30"/>
                                        <ColumnConstraints percentWidth="70"/>
                                    </columnConstraints>

                                    <Label text="Type:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="conflictTypeLabel" text="No conflict selected" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                                    <Label text="Severity:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="conflictSeverityLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                                    <Label text="Detected:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="detectedDateLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                                    <Label text="Description:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="conflictDescriptionLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                                    <Label text="Affected Entities:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="4">
                                        <Label fx:id="affectedEntity1Label" text="-"/>
                                        <Label fx:id="affectedEntity2Label" text="-"/>
                                    </VBox>

                                    <Label text="Time/Period:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
                                    <Label fx:id="conflictTimeLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                                    <Label text="Impact:" styleClass="form-label" GridPane.columnIndex="0" GridPane.rowIndex="6"/>
                                    <Label fx:id="impactLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                                </GridPane>
                            </VBox>

                            <!-- AI Resolution Suggestions -->
                            <VBox spacing="15" styleClass="card, metric-info">
                                <Label text="ðŸ’¡ AI-Powered Resolution Suggestions" styleClass="section-title-16-blue"/>

                                <VBox spacing="10" fx:id="suggestionsContainer">
                                    <!-- Suggestions will be dynamically added -->
                                </VBox>
                            </VBox>

                            <!-- Manual Resolution Options -->
                            <VBox spacing="15" styleClass="card, metric-warning">
                                <Label text="Manual Resolution" styleClass="section-title-16-orange"/>

                                <TabPane tabClosingPolicy="UNAVAILABLE">

                                    <!-- Reassign Teacher -->
                                    <Tab text="Reassign Teacher">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" styleClass="form-label"/>
                                            <ComboBox fx:id="reassignCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New teacher:" styleClass="form-label"/>
                                            <ComboBox fx:id="newTeacherComboBox" promptText="Select teacher..." maxWidth="Infinity"/>

                                            <Button text="Reassign Teacher" onAction="#handleReassignTeacher"
                                                    styleClass="button-primary" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Reassign Room -->
                                    <Tab text="Reassign Room">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" styleClass="form-label"/>
                                            <ComboBox fx:id="reassignRoomCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New room:" styleClass="form-label"/>
                                            <ComboBox fx:id="newRoomComboBox" promptText="Select room..." maxWidth="Infinity"/>

                                            <Button text="Reassign Room" onAction="#handleReassignRoom"
                                                    styleClass="button-primary" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Change Time Slot -->
                                    <Tab text="Change Time Slot">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" styleClass="form-label"/>
                                            <ComboBox fx:id="rescheduleComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New day:" styleClass="form-label"/>
                                            <ComboBox fx:id="newDayComboBox" promptText="Select day..." maxWidth="Infinity"/>

                                            <Label text="New period:" styleClass="form-label"/>
                                            <ComboBox fx:id="newPeriodComboBox" promptText="Select period..." maxWidth="Infinity"/>

                                            <Button text="Change Time Slot" onAction="#handleChangeTimeSlot"
                                                    styleClass="button-primary" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Split Section -->
                                    <Tab text="Split/Combine Sections">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Course to split:" styleClass="form-label"/>
                                            <ComboBox fx:id="splitCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="Number of sections:" styleClass="form-label"/>
                                            <Spinner fx:id="sectionsSpinner" min="2" max="5" initialValue="2" prefWidth="100"/>

                                            <Button text="Split into Sections" onAction="#handleSplitSections"
                                                    styleClass="header-purple" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                </TabPane>
                            </VBox>

                            <!-- Resolution Actions -->
                            <HBox spacing="15">
                                <Button fx:id="markResolvedButton" text="âœ“ Mark as Resolved" onAction="#handleMarkResolved"
                                        styleClass="button-primary"/>

                                <Button fx:id="ignoreConflictButton" text="Ignore Conflict" onAction="#handleIgnoreConflict"
                                        styleClass="button-primary"/>

                                <Region HBox.hgrow="ALWAYS"/>

                                <Button fx:id="deleteConflictButton" text="Delete" onAction="#handleDeleteConflict"
                                        styleClass="header-danger"/>
                            </HBox>

                            <!-- Resolution History -->
                            <VBox spacing="10" styleClass="card">
                                <Label text="Resolution History" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                                <ListView fx:id="resolutionHistoryListView" prefHeight="120"/>
                            </VBox>

                        </VBox>
                    </ScrollPane>
                </center>

            </BorderPane>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="lastScanLabel" text="Last scan: Never" styleClass="text-muted"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="autoResolveStatusLabel" text="Auto-resolve: Enabled" styleClass="text-muted"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="processingTimeLabel" text="" styleClass="text-muted"/>
        </HBox>
    </bottom>

</BorderPane>
