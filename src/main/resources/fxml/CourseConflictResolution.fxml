<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.chart.*?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.CourseConflictResolutionController"
            stylesheets="@../css/application.css"
            prefWidth="1500" prefHeight="950">

    <!-- Top: Header -->
    <top>
        <VBox spacing="15" style="-fx-background-color: #d32f2f; -fx-padding: 20;">
            <Label text="Course Conflict Resolution Center"
                   style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            <Label text="Detect, analyze, and resolve scheduling conflicts with AI-powered recommendations"
                   style="-fx-font-size: 13px; -fx-text-fill: white;"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.35" style="-fx-background-color: #f5f5f5;">

            <!-- Left: Conflict List & Analytics -->
            <VBox spacing="15" style="-fx-padding: 15; -fx-background-color: white;">

                <!-- Conflict Summary Cards -->
                <GridPane hgap="10" vgap="10">
                    <columnConstraints>
                        <ColumnConstraints percentWidth="50"/>
                        <ColumnConstraints percentWidth="50"/>
                    </columnConstraints>

                    <!-- Total Conflicts -->
                    <VBox spacing="5" style="-fx-background-color: #ffebee; -fx-padding: 15; -fx-border-color: #f44336; -fx-border-width: 2;"
                          GridPane.columnIndex="0" GridPane.rowIndex="0">
                        <Label text="Total Conflicts" style="-fx-font-size: 11px; -fx-text-fill: #c62828;"/>
                        <Label fx:id="totalConflictsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                    </VBox>

                    <!-- Critical Conflicts -->
                    <VBox spacing="5" style="-fx-background-color: #fff3e0; -fx-padding: 15; -fx-border-color: #ff9800; -fx-border-width: 2;"
                          GridPane.columnIndex="1" GridPane.rowIndex="0">
                        <Label text="Critical" style="-fx-font-size: 11px; -fx-text-fill: #e65100;"/>
                        <Label fx:id="criticalConflictsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>
                    </VBox>

                    <!-- Teacher Conflicts -->
                    <VBox spacing="5" style="-fx-background-color: #e3f2fd; -fx-padding: 15; -fx-border-color: #2196f3; -fx-border-width: 2;"
                          GridPane.columnIndex="0" GridPane.rowIndex="1">
                        <Label text="Teacher Conflicts" style="-fx-font-size: 11px; -fx-text-fill: #0d47a1;"/>
                        <Label fx:id="teacherConflictsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>
                    </VBox>

                    <!-- Room Conflicts -->
                    <VBox spacing="5" style="-fx-background-color: #f3e5f5; -fx-padding: 15; -fx-border-color: #9c27b0; -fx-border-width: 2;"
                          GridPane.columnIndex="1" GridPane.rowIndex="1">
                        <Label text="Room Conflicts" style="-fx-font-size: 11px; -fx-text-fill: #6a1b9a;"/>
                        <Label fx:id="roomConflictsLabel" text="0" style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: #6a1b9a;"/>
                    </VBox>
                </GridPane>

                <!-- Conflict Type Breakdown Chart -->
                <VBox spacing="10" style="-fx-background-color: #fafafa; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                    <Label text="Conflict Type Breakdown" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                    <PieChart fx:id="conflictTypeChart" legendVisible="false" prefHeight="180"/>
                </VBox>

                <!-- Filters -->
                <VBox spacing="10" style="-fx-background-color: #e8f5e9; -fx-padding: 15; -fx-border-color: #4caf50; -fx-border-width: 2;">
                    <Label text="Filters" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>

                    <Label text="Conflict Type:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="conflictTypeFilterComboBox" promptText="All Types" maxWidth="Infinity"/>

                    <Label text="Severity:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="severityFilterComboBox" promptText="All Severities" maxWidth="Infinity"/>

                    <Label text="Status:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="statusFilterComboBox" promptText="All Statuses" maxWidth="Infinity"/>

                    <CheckBox fx:id="showResolvedCheckBox" text="Show Resolved" onAction="#handleFilterChange"/>

                    <Button fx:id="applyFiltersButton" text="Apply Filters" onAction="#handleFilterChange"
                            style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 8; -fx-cursor: hand;" maxWidth="Infinity"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="10">
                    <Button fx:id="scanConflictsButton" text="ðŸ” Scan for New Conflicts" onAction="#handleScanConflicts"
                            style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12; -fx-cursor: hand;" maxWidth="Infinity"/>

                    <Button fx:id="autoResolveButton" text="âš¡ Auto-Resolve All" onAction="#handleAutoResolveAll"
                            style="-fx-background-color: #9c27b0; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>

                    <Button fx:id="exportConflictsButton" text="ðŸ“Š Export Report" onAction="#handleExportConflicts"
                            style="-fx-background-color: #607d8b; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                </VBox>

            </VBox>

            <!-- Right: Conflict Details & Resolution -->
            <BorderPane style="-fx-background-color: white;">

                <!-- Conflict List -->
                <top>
                    <VBox spacing="10" style="-fx-padding: 15;">
                        <HBox spacing="15" alignment="CENTER_LEFT">
                            <Label text="Active Conflicts" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>
                            <Label fx:id="conflictListCountLabel" text="(0)" style="-fx-font-size: 14px; -fx-text-fill: #757575;"/>

                            <Region HBox.hgrow="ALWAYS"/>

                            <ComboBox fx:id="sortByComboBox" promptText="Sort by..." prefWidth="150"/>
                        </HBox>

                        <TableView fx:id="conflictsTableView" VBox.vgrow="ALWAYS" prefHeight="300">
                            <columns>
                                <TableColumn fx:id="severityColumn" text="!" prefWidth="40"/>
                                <TableColumn fx:id="typeColumn" text="Type" prefWidth="120"/>
                                <TableColumn fx:id="descriptionColumn" text="Description" prefWidth="300"/>
                                <TableColumn fx:id="affectedColumn" text="Affected" prefWidth="150"/>
                                <TableColumn fx:id="timeColumn" text="Time/Period" prefWidth="120"/>
                                <TableColumn fx:id="statusColumn" text="Status" prefWidth="100"/>
                                <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="120"/>
                            </columns>
                        </TableView>
                    </VBox>
                </top>

                <!-- Selected Conflict Details -->
                <center>
                    <ScrollPane fitToWidth="true">
                        <VBox spacing="20" style="-fx-padding: 20;">

                            <!-- Conflict Information -->
                            <VBox spacing="15" style="-fx-background-color: #ffebee; -fx-padding: 20; -fx-border-color: #f44336; -fx-border-width: 2;">
                                <HBox spacing="15" alignment="CENTER_LEFT">
                                    <Label text="âš  Conflict Details" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                                    <Region HBox.hgrow="ALWAYS"/>
                                    <Label fx:id="conflictIdLabel" text="ID: N/A" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
                                </HBox>

                                <GridPane hgap="15" vgap="12">
                                    <columnConstraints>
                                        <ColumnConstraints percentWidth="30"/>
                                        <ColumnConstraints percentWidth="70"/>
                                    </columnConstraints>

                                    <Label text="Type:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                                    <Label fx:id="conflictTypeLabel" text="No conflict selected" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                                    <Label text="Severity:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="1"/>
                                    <Label fx:id="conflictSeverityLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                                    <Label text="Detected:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="2"/>
                                    <Label fx:id="detectedDateLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                                    <Label text="Description:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="3"/>
                                    <Label fx:id="conflictDescriptionLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                                    <Label text="Affected Entities:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="4"/>
                                    <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="4">
                                        <Label fx:id="affectedEntity1Label" text="-"/>
                                        <Label fx:id="affectedEntity2Label" text="-"/>
                                    </VBox>

                                    <Label text="Time/Period:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="5"/>
                                    <Label fx:id="conflictTimeLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                                    <Label text="Impact:" style="-fx-font-weight: bold;" GridPane.columnIndex="0" GridPane.rowIndex="6"/>
                                    <Label fx:id="impactLabel" text="-" wrapText="true" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                                </GridPane>
                            </VBox>

                            <!-- AI Resolution Suggestions -->
                            <VBox spacing="15" style="-fx-background-color: #e3f2fd; -fx-padding: 20; -fx-border-color: #2196f3; -fx-border-width: 2;">
                                <Label text="ðŸ’¡ AI-Powered Resolution Suggestions" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>

                                <VBox spacing="10" fx:id="suggestionsContainer">
                                    <!-- Suggestions will be dynamically added -->
                                </VBox>
                            </VBox>

                            <!-- Manual Resolution Options -->
                            <VBox spacing="15" style="-fx-background-color: #fff3e0; -fx-padding: 20; -fx-border-color: #ff9800; -fx-border-width: 2;">
                                <Label text="Manual Resolution" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>

                                <TabPane tabClosingPolicy="UNAVAILABLE">

                                    <!-- Reassign Teacher -->
                                    <Tab text="Reassign Teacher">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="reassignCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New teacher:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="newTeacherComboBox" promptText="Select teacher..." maxWidth="Infinity"/>

                                            <Button text="Reassign Teacher" onAction="#handleReassignTeacher"
                                                    style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Reassign Room -->
                                    <Tab text="Reassign Room">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="reassignRoomCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New room:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="newRoomComboBox" promptText="Select room..." maxWidth="Infinity"/>

                                            <Button text="Reassign Room" onAction="#handleReassignRoom"
                                                    style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Change Time Slot -->
                                    <Tab text="Change Time Slot">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Select affected course:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="rescheduleComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="New day:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="newDayComboBox" promptText="Select day..." maxWidth="Infinity"/>

                                            <Label text="New period:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="newPeriodComboBox" promptText="Select period..." maxWidth="Infinity"/>

                                            <Button text="Change Time Slot" onAction="#handleChangeTimeSlot"
                                                    style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                    <!-- Split Section -->
                                    <Tab text="Split/Combine Sections">
                                        <VBox spacing="15" style="-fx-padding: 15;">
                                            <Label text="Course to split:" style="-fx-font-weight: bold;"/>
                                            <ComboBox fx:id="splitCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                                            <Label text="Number of sections:" style="-fx-font-weight: bold;"/>
                                            <Spinner fx:id="sectionsSpinner" min="2" max="5" initialValue="2" prefWidth="100"/>

                                            <Button text="Split into Sections" onAction="#handleSplitSections"
                                                    style="-fx-background-color: #9c27b0; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>
                                        </VBox>
                                    </Tab>

                                </TabPane>
                            </VBox>

                            <!-- Resolution Actions -->
                            <HBox spacing="15">
                                <Button fx:id="markResolvedButton" text="âœ“ Mark as Resolved" onAction="#handleMarkResolved"
                                        style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 12 25; -fx-cursor: hand;"/>

                                <Button fx:id="ignoreConflictButton" text="Ignore Conflict" onAction="#handleIgnoreConflict"
                                        style="-fx-background-color: #9e9e9e; -fx-text-fill: white; -fx-padding: 12 25; -fx-cursor: hand;"/>

                                <Region HBox.hgrow="ALWAYS"/>

                                <Button fx:id="deleteConflictButton" text="Delete" onAction="#handleDeleteConflict"
                                        style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-padding: 12 25; -fx-cursor: hand;"/>
                            </HBox>

                            <!-- Resolution History -->
                            <VBox spacing="10" style="-fx-background-color: #f5f5f5; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                                <Label text="Resolution History" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>
                                <ListView fx:id="resolutionHistoryListView" prefHeight="120"/>
                            </VBox>

                        </VBox>
                    </ScrollPane>
                </center>

            </BorderPane>

        </SplitPane>
    </center>

    <!-- Bottom: Status Bar -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #fafafa; -fx-padding: 10; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
            <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="lastScanLabel" text="Last scan: Never" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
            <Separator orientation="VERTICAL"/>
            <Label fx:id="autoResolveStatusLabel" text="Auto-resolve: Enabled" style="-fx-font-size: 11px; -fx-text-fill: #4caf50;"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Label fx:id="processingTimeLabel" text="" style="-fx-font-size: 10px; -fx-text-fill: #757575;"/>
        </HBox>
    </bottom>

</BorderPane>
