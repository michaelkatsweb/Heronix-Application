<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<!--
Master Schedule Board (Kanban-Style)
Interactive drag-and-drop master schedule editor with rich conflict visualization

Location: src/main/resources/fxml/DragDropScheduleEditor.fxml
-->

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.heronix.ui.controller.DragDropScheduleEditorController"
            styleClass="main-container">

    <!-- HEADER -->
    <top>
        <VBox styleClass="header-section">
            <!-- Toolbar -->
            <HBox alignment="CENTER_LEFT" spacing="20" styleClass="page-header">
                <Label text="Master Schedule Board" styleClass="page-title"/>
                <Region HBox.hgrow="ALWAYS"/>

                <!-- Edit Mode Toggle -->
                <ToggleButton fx:id="editModeToggle" text="Edit Mode" onAction="#handleEditModeToggle"
                              styleClass="toggle-button"/>

                <!-- Undo/Redo -->
                <Button fx:id="undoButton" text="Undo" onAction="#handleUndo"
                        styleClass="button-secondary" disable="true"/>
                <Button fx:id="redoButton" text="Redo" onAction="#handleRedo"
                        styleClass="button-secondary" disable="true"/>

                <Separator orientation="VERTICAL"/>

                <!-- Actions -->
                <Button text="Refresh" onAction="#handleRefresh" styleClass="button-secondary"/>
                <Button text="Save Changes" onAction="#handleSaveChanges" styleClass="button-primary"/>
                <Button text="Discard" onAction="#handleDiscardChanges" styleClass="button-secondary"/>
            </HBox>

            <!-- Statistics Bar -->
            <HBox alignment="CENTER_LEFT" spacing="16" styleClass="msb-stats-bar">
                <HBox spacing="6" alignment="CENTER_LEFT" styleClass="msb-stat-card">
                    <Label text="Assigned:" styleClass="stat-label"/>
                    <Label fx:id="assignedCountLabel" text="0" styleClass="stat-value"/>
                </HBox>
                <HBox spacing="6" alignment="CENTER_LEFT" styleClass="msb-stat-card">
                    <Label text="Unassigned:" styleClass="stat-label"/>
                    <Label fx:id="unassignedCountLabel" text="0" styleClass="stat-value"/>
                </HBox>
                <HBox spacing="6" alignment="CENTER_LEFT" styleClass="msb-stat-card">
                    <Label text="Conflicts:" styleClass="stat-label"/>
                    <Label fx:id="conflictCountLabel" text="0" styleClass="stat-value"/>
                </HBox>
                <HBox spacing="6" alignment="CENTER_LEFT" styleClass="msb-stat-card">
                    <Label text="Teacher Utilization:" styleClass="stat-label"/>
                    <Label fx:id="teacherUtilLabel" text="0%" styleClass="stat-value"/>
                </HBox>

                <Region HBox.hgrow="ALWAYS"/>

                <!-- Status -->
                <Label fx:id="editModeStatusLabel" text="View Mode" styleClass="status-label"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="changesStatusLabel" text="No unsaved changes" styleClass="status-label"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="conflictsStatusLabel" text="No conflicts detected" styleClass="status-label"/>
            </HBox>

            <!-- Filters -->
            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card" style="-fx-padding: 8 16;">
                <Label text="Filters:" styleClass="filter-label"/>
                <ComboBox fx:id="teacherFilterComboBox" promptText="All Teachers"
                          onAction="#handleFilterChange" prefWidth="150"/>
                <ComboBox fx:id="roomFilterComboBox" promptText="All Rooms"
                          onAction="#handleFilterChange" prefWidth="150"/>
                <ComboBox fx:id="gradeFilterComboBox" promptText="All Grades"
                          onAction="#handleFilterChange" prefWidth="120"/>
                <Region HBox.hgrow="ALWAYS"/>
                <CheckBox fx:id="showConflictsCheckbox" text="Highlight Conflicts"
                          onAction="#handleShowConflictsToggle" selected="true"/>
            </HBox>
        </VBox>
    </top>

    <!-- MAIN CONTENT: 3-Panel Layout -->
    <center>
        <SplitPane dividerPositions="0.18, 0.78" styleClass="split-pane">

            <!-- LEFT: Unassigned Sections Pool -->
            <VBox spacing="10" styleClass="msb-pool">
                <Label text="Unassigned Sections" styleClass="section-title"/>
                <TextField fx:id="poolSearchField" promptText="Search sections..." styleClass="text-field"/>
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="scroll-pane">
                    <VBox fx:id="unassignedPoolContainer" spacing="6">
                        <!-- Populated dynamically -->
                    </VBox>
                </ScrollPane>
            </VBox>

            <!-- CENTER: Schedule Grid -->
            <ScrollPane fitToWidth="true" fitToHeight="true" styleClass="scroll-pane">
                <VBox spacing="0" styleClass="content-container">
                    <padding>
                        <Insets top="4" right="4" bottom="4" left="4"/>
                    </padding>

                    <!-- Schedule Grid Container -->
                    <VBox fx:id="scheduleGridContainer" spacing="0">
                        <GridPane fx:id="scheduleGrid" hgap="3" vgap="3">
                            <!-- Grid populated dynamically -->
                        </GridPane>
                    </VBox>
                </VBox>
            </ScrollPane>

            <!-- RIGHT: Details + Conflicts Panel -->
            <VBox spacing="15" styleClass="details-panel card">

                <!-- Selected Section Details -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Selected Section" styleClass="section-title"/>

                    <VBox fx:id="sectionDetailsContainer" spacing="8">
                        <Label fx:id="noSelectionLabel" text="Click a section to view details"
                               styleClass="stat-description"/>

                        <VBox fx:id="sectionDetailsBox" spacing="8" visible="false" managed="false">
                            <HBox spacing="10">
                                <Label text="Course:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailCourseLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Section:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailSectionLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Teacher:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailTeacherLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Room:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailRoomLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Period:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailPeriodLabel" text="--" styleClass="detail-value"/>
                            </HBox>
                            <HBox spacing="10">
                                <Label text="Enrollment:" styleClass="detail-label" prefWidth="100"/>
                                <Label fx:id="detailEnrollmentLabel" text="--" styleClass="detail-value"/>
                            </HBox>

                            <Separator/>

                            <!-- Quick Actions -->
                            <VBox spacing="8">
                                <Label text="Quick Actions:" styleClass="stat-label"/>
                                <Button text="Swap Teacher" onAction="#handleSwapTeacher"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="Swap Room" onAction="#handleSwapRoom"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="Change Period" onAction="#handleChangePeriod"
                                        prefWidth="200" styleClass="button-secondary"/>
                                <Button text="Unassign Section" onAction="#handleUnassignSection"
                                        prefWidth="200" styleClass="button-warning"/>
                            </VBox>
                        </VBox>
                    </VBox>
                </VBox>

                <!-- Conflict Warnings -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Conflicts" styleClass="section-title"/>
                    <ListView fx:id="conflictsList" prefHeight="150" styleClass="conflict-list">
                        <placeholder>
                            <Label text="No conflicts detected"/>
                        </placeholder>
                    </ListView>
                </VBox>

                <!-- Recent Changes -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Recent Changes" styleClass="section-title"/>
                    <ListView fx:id="recentChangesList" prefHeight="150" styleClass="changes-list">
                        <placeholder>
                            <Label text="No changes yet"/>
                        </placeholder>
                    </ListView>
                </VBox>

                <!-- Suggestions -->
                <VBox spacing="10" styleClass="card">
                    <Label text="Smart Suggestions" styleClass="section-title"/>
                    <VBox fx:id="suggestionsContainer" spacing="5">
                        <Label text="Analyzing schedule..." styleClass="stat-description"/>
                    </VBox>
                </VBox>

            </VBox>

        </SplitPane>
    </center>

    <!-- BOTTOM: Legend -->
    <bottom>
        <HBox spacing="20" alignment="CENTER_LEFT" styleClass="footer-section, card">
            <Label text="Legend:" styleClass="legend-label"/>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #10B981; -fx-background-radius: 3;"/>
                <Label text="OK" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #F59E0B; -fx-background-radius: 3;"/>
                <Label text="Warning" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #EF4444; -fx-background-radius: 3;"/>
                <Label text="Conflict" styleClass="legend-text"/>
            </HBox>

            <HBox spacing="5" alignment="CENTER_LEFT">
                <Region prefWidth="15" prefHeight="15" style="-fx-background-color: #3E3E42; -fx-background-radius: 3; -fx-border-color: #555; -fx-border-style: dashed; -fx-border-radius: 3;"/>
                <Label text="Empty" styleClass="legend-text"/>
            </HBox>

            <Region HBox.hgrow="ALWAYS"/>

            <Label text="Drag sections to move them. Ctrl+Z to undo." styleClass="help-text, text-hint-italic"/>
        </HBox>
    </bottom>

</BorderPane>
