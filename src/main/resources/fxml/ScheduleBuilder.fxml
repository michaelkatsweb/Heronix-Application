<?xml version="1.0" encoding="UTF-8"?>

<?import java.lang.String?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.ScheduleBuilderController"
            prefWidth="1600" prefHeight="1000">


    <!-- Top: Header & Controls -->
    <top>
        <VBox spacing="15" styleClass="card">
            <HBox spacing="15" alignment="CENTER_LEFT">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Schedule Builder"
                           styleClass="page-title-white"/>
                    <Label text="Visual schedule creation and management with drag-and-drop course placement"
                           styleClass="text-white"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="5" alignment="CENTER_RIGHT">
                    <HBox spacing="10">
                        <Button fx:id="newScheduleButton" text="New Schedule" onAction="#handleNewSchedule"
                                styleClass="button-primary"/>
                        <Button fx:id="loadScheduleButton" text="Load Schedule" onAction="#handleLoadSchedule"
                                styleClass="button-primary"/>
                        <Button fx:id="saveScheduleButton" text="Save" onAction="#handleSaveSchedule"
                                styleClass="button-primary"/>
                    </HBox>
                    <Label fx:id="scheduleNameLabel" text="Untitled Schedule"
                           style="-fx-font-size: 12px; -fx-text-fill: white; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>

            <!-- Schedule Configuration Bar -->
            <HBox spacing="20" alignment="CENTER_LEFT" style="-fx-background-color: rgba(0,0,0,0.2); -fx-padding: 15; -fx-border-radius: 5;">
                <VBox spacing="5">
                    <Label text="School Year" styleClass="text-white"/>
                    <ComboBox fx:id="schoolYearComboBox" promptText="2024-2025" prefWidth="130"
                              style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Semester" styleClass="text-white"/>
                    <ComboBox fx:id="semesterComboBox" promptText="Fall" prefWidth="120"
                              style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Periods per Day" styleClass="text-white"/>
                    <Spinner fx:id="periodsPerDaySpinner" min="4" max="10" initialValue="7" prefWidth="100"
                             editable="true" style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Period Duration (min)" styleClass="text-white"/>
                    <Spinner fx:id="periodDurationSpinner" min="30" max="90" initialValue="50" prefWidth="100"
                             editable="true" style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Start Time" styleClass="text-white"/>
                    <TextField fx:id="startTimeField" text="07:30" promptText="HH:MM" prefWidth="80"
                               style="-fx-font-size: 12px;"/>
                </VBox>

                <Region HBox.hgrow="ALWAYS"/>

                <VBox spacing="5" alignment="CENTER">
                    <Label fx:id="scheduleStatsLabel" text="0 courses assigned | 0% complete"
                           styleClass="text-white"/>
                    <ProgressBar fx:id="completionProgressBar" prefWidth="200" progress="0"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.2, 0.8" styleClass="main-container">

            <!-- Left: Course Pool -->
            <VBox spacing="15" styleClass="form-panel">
                <Label text="Course Pool" styleClass="section-title"/>

                <!-- Filters -->
                <VBox spacing="10" styleClass="card, metric-info">
                    <Label text="Filters" styleClass="label-12-bold-blue"/>

                    <ComboBox fx:id="subjectFilterComboBox" promptText="All Subjects" maxWidth="Infinity"/>
                    <ComboBox fx:id="gradeLevelFilterComboBox" promptText="All Grades" maxWidth="Infinity"/>
                    <ComboBox fx:id="courseTypeFilterComboBox" promptText="All Types" maxWidth="Infinity"/>

                    <CheckBox fx:id="showUnassignedOnlyCheckBox" text="Unassigned Only" selected="true"/>
                </VBox>

                <!-- Course Search -->
                <TextField fx:id="courseSearchField" promptText="Search courses..." onKeyReleased="#handleCourseSearch"/>

                <!-- Course List -->
                <VBox spacing="5" VBox.vgrow="ALWAYS">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Available Courses" style="-fx-font-size: 12px; -fx-font-weight: bold;"/>
                        <Label fx:id="courseCountLabel" text="(0)" styleClass="text-muted"/>
                    </HBox>

                    <ListView fx:id="availableCoursesListView" VBox.vgrow="ALWAYS">
                        <!-- Custom cell factory will be set in controller -->
                    </ListView>
                </VBox>

                <!-- Quick Stats -->
                <VBox spacing="8" styleClass="card">
                    <HBox spacing="5">
                        <Label text="Total Courses:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="totalCoursesLabel" text="0" style="-fx-font-size: 11px;"/>
                    </HBox>
                    <HBox spacing="5">
                        <Label text="Assigned:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="assignedCoursesLabel" text="0" styleClass="text-muted"/>
                    </HBox>
                    <HBox spacing="5">
                        <Label text="Unassigned:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="unassignedCoursesLabel" text="0" styleClass="text-muted"/>
                    </HBox>
                </VBox>
            </VBox>

            <!-- Center: Schedule Grid -->
            <BorderPane styleClass="form-panel">
                <top>
                    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 0 0 15 0;">
                        <Label text="Master Schedule Grid" styleClass="section-title"/>

                        <Region HBox.hgrow="ALWAYS"/>

                        <!-- View Options -->
                        <HBox spacing="10">
                            <ToggleButton fx:id="weekViewToggle" text="Week View" selected="true"
                                         style="-fx-padding: 5 15;"/>
                            <ToggleButton fx:id="dayViewToggle" text="Day View"
                                         style="-fx-padding: 5 15;"/>
                        </HBox>

                        <!-- Grid Tools -->
                        <Button fx:id="autoFillButton" text="Auto-Fill Empty" onAction="#handleAutoFill"
                                styleClass="header-purple"/>
                        <Button fx:id="clearGridButton" text="Clear All" onAction="#handleClearGrid"
                                styleClass="header-danger"/>
                    </HBox>
                </top>

                <center>
                    <ScrollPane fitToWidth="true" fitToHeight="true">
                        <GridPane fx:id="scheduleGrid" hgap="5" vgap="5" styleClass="card">
                            <!-- Grid will be dynamically populated -->
                        </GridPane>
                    </ScrollPane>
                </center>

                <bottom>
                    <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
                        <Label text="Legend:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <HBox spacing="5" alignment="CENTER">
                            <Region styleClass="card, metric-success"/>
                            <Label text="Assigned" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region styleClass="legend-warning"/>
                            <Label text="Partial" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region styleClass="card, metric-danger"/>
                            <Label text="Conflict" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region styleClass="legend-empty"/>
                            <Label text="Empty" style="-fx-font-size: 11px;"/>
                        </HBox>
                    </HBox>
                </bottom>
            </BorderPane>

            <!-- Right: Details & Actions -->
            <VBox spacing="15" styleClass="form-panel">
                <Label text="Slot Details" styleClass="section-title"/>

                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
                    <VBox spacing="20" style="-fx-padding: 10;">

                        <!-- Selected Slot Info -->
                        <VBox spacing="10" styleClass="card, metric-info">
                            <Label text="Selected Slot" styleClass="section-title-14-blue-dark"/>

                            <Label text="Day:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedDayLabel" text="None" style="-fx-font-size: 12px;"/>

                            <Label text="Period:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedPeriodLabel" text="None" style="-fx-font-size: 12px;"/>

                            <Label text="Time:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedTimeLabel" text="None" style="-fx-font-size: 12px;"/>
                        </VBox>

                        <!-- Course Assignment -->
                        <VBox spacing="10" styleClass="card, metric-warning">
                            <Label text="Course Assignment" styleClass="section-title-14-orange-deep"/>

                            <Label text="Course:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                            <Label text="Teacher:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignTeacherComboBox" promptText="Select teacher..." maxWidth="Infinity"/>

                            <Label text="Room:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignRoomComboBox" promptText="Select room..." maxWidth="Infinity"/>

                            <Button fx:id="assignButton" text="Assign to Slot" onAction="#handleAssignToSlot"
                                    styleClass="button-primary" maxWidth="Infinity"/>

                            <Button fx:id="clearSlotButton" text="Clear Slot" onAction="#handleClearSlot"
                                    styleClass="header-danger" maxWidth="Infinity"/>
                        </VBox>

                        <!-- Current Assignment Info -->
                        <VBox spacing="10" styleClass="card-white-bordered">
                            <Label text="Current Assignment" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                            <VBox spacing="5">
                                <Label text="Course:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentCourseLabel" text="Empty" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Teacher:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentTeacherLabel" text="Not assigned" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Room:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentRoomLabel" text="Not assigned" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Enrollment:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentEnrollmentLabel" text="0/0" style="-fx-font-size: 12px;"/>
                            </VBox>
                        </VBox>

                        <!-- Conflict Warnings -->
                        <VBox spacing="10" fx:id="conflictWarningsBox" managed="false" visible="false"
                              styleClass="card, metric-danger">
                            <Label text="âš  Conflicts Detected" styleClass="section-title-14-red-dark"/>
                            <ListView fx:id="conflictListView" prefHeight="120"/>
                        </VBox>

                        <!-- Suggestions -->
                        <VBox spacing="10" styleClass="card, metric-success">
                            <Label text="ðŸ’¡ Suggestions" styleClass="section-title-14-green-dark"/>
                            <ListView fx:id="suggestionsListView" prefHeight="100"/>
                        </VBox>

                    </VBox>
                </ScrollPane>

            </VBox>

        </SplitPane>
    </center>

    <!-- Bottom: Status & Actions -->
    <bottom>
        <VBox>
            <!-- Action Bar -->
            <HBox spacing="15" alignment="CENTER_RIGHT" styleClass="footer-white-border">
                <Button fx:id="validateButton" text="Validate Schedule" onAction="#handleValidate"
                        styleClass="button-primary"/>

                <Button fx:id="optimizeButton" text="Optimize Schedule" onAction="#handleOptimize"
                        styleClass="header-purple"/>

                <Button fx:id="publishButton" text="Publish Schedule" onAction="#handlePublish"
                        styleClass="button-primary"/>

                <Region HBox.hgrow="ALWAYS"/>

                <Button fx:id="exportButton" text="Export" onAction="#handleExport"
                        styleClass="button-primary"/>

                <Button fx:id="printButton" text="Print" onAction="#handlePrint"
                        styleClass="button-primary"/>
            </HBox>

            <!-- Status Bar -->
            <HBox spacing="15" alignment="CENTER_LEFT" styleClass="card">
                <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="conflictCountLabel" text="Conflicts: 0" styleClass="text-muted"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="utilizationLabel" text="Teacher Utilization: 0%" style="-fx-font-size: 11px;"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="roomUtilizationLabel" text="Room Utilization: 0%" style="-fx-font-size: 11px;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lastSavedLabel" text="Unsaved changes" styleClass="text-muted"/>
            </HBox>
        </VBox>
    </bottom>

</BorderPane>
