<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.ScheduleBuilderController"
            stylesheets="@../css/application.css"
            prefWidth="1600" prefHeight="1000">

    <!-- Top: Header & Controls -->
    <top>
        <VBox spacing="15" style="-fx-background-color: #1976d2; -fx-padding: 20;">
            <HBox spacing="15" alignment="CENTER_LEFT">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Schedule Builder"
                           style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                    <Label text="Visual schedule creation and management with drag-and-drop course placement"
                           style="-fx-font-size: 13px; -fx-text-fill: white;"/>
                </VBox>

                <!-- Quick Actions -->
                <VBox spacing="5" alignment="CENTER_RIGHT">
                    <HBox spacing="10">
                        <Button fx:id="newScheduleButton" text="New Schedule" onAction="#handleNewSchedule"
                                style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                        <Button fx:id="loadScheduleButton" text="Load Schedule" onAction="#handleLoadSchedule"
                                style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                        <Button fx:id="saveScheduleButton" text="Save" onAction="#handleSaveSchedule"
                                style="-fx-background-color: #ff9800; -fx-text-fill: white; -fx-padding: 8 15; -fx-cursor: hand;"/>
                    </HBox>
                    <Label fx:id="scheduleNameLabel" text="Untitled Schedule"
                           style="-fx-font-size: 12px; -fx-text-fill: white; -fx-font-weight: bold;"/>
                </VBox>
            </HBox>

            <!-- Schedule Configuration Bar -->
            <HBox spacing="20" alignment="CENTER_LEFT" style="-fx-background-color: rgba(0,0,0,0.2); -fx-padding: 15; -fx-border-radius: 5;">
                <VBox spacing="5">
                    <Label text="School Year" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="schoolYearComboBox" promptText="2024-2025" prefWidth="130"
                              style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Semester" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <ComboBox fx:id="semesterComboBox" promptText="Fall" prefWidth="120"
                              style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Periods per Day" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Spinner fx:id="periodsPerDaySpinner" min="4" max="10" initialValue="7" prefWidth="100"
                             editable="true" style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Period Duration (min)" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <Spinner fx:id="periodDurationSpinner" min="30" max="90" initialValue="50" prefWidth="100"
                             editable="true" style="-fx-font-size: 12px;"/>
                </VBox>

                <VBox spacing="5">
                    <Label text="Start Time" style="-fx-text-fill: white; -fx-font-size: 11px;"/>
                    <TextField fx:id="startTimeField" text="07:30" promptText="HH:MM" prefWidth="80"
                               style="-fx-font-size: 12px;"/>
                </VBox>

                <Region HBox.hgrow="ALWAYS"/>

                <VBox spacing="5" alignment="CENTER">
                    <Label fx:id="scheduleStatsLabel" text="0 courses assigned | 0% complete"
                           style="-fx-text-fill: white; -fx-font-size: 12px; -fx-font-weight: bold;"/>
                    <ProgressBar fx:id="completionProgressBar" prefWidth="200" progress="0"/>
                </VBox>
            </HBox>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <SplitPane dividerPositions="0.2, 0.8" style="-fx-background-color: #f5f5f5;">

            <!-- Left: Course Pool -->
            <VBox spacing="15" style="-fx-padding: 15; -fx-background-color: white;">
                <Label text="Course Pool" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                <!-- Filters -->
                <VBox spacing="10" style="-fx-background-color: #e3f2fd; -fx-padding: 10; -fx-border-color: #90caf9; -fx-border-width: 2;">
                    <Label text="Filters" style="-fx-font-size: 12px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>

                    <ComboBox fx:id="subjectFilterComboBox" promptText="All Subjects" maxWidth="Infinity"/>
                    <ComboBox fx:id="gradeLevelFilterComboBox" promptText="All Grades" maxWidth="Infinity"/>
                    <ComboBox fx:id="courseTypeFilterComboBox" promptText="All Types" maxWidth="Infinity"/>

                    <CheckBox fx:id="showUnassignedOnlyCheckBox" text="Unassigned Only" selected="true"/>
                </VBox>

                <!-- Course Search -->
                <TextField fx:id="courseSearchField" promptText="Search courses..." onKeyReleased="#handleCourseSearch"/>

                <!-- Course List -->
                <VBox spacing="5" VBox.vgrow="ALWAYS">
                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Label text="Available Courses" style="-fx-font-size: 12px; -fx-font-weight: bold;"/>
                        <Label fx:id="courseCountLabel" text="(0)" style="-fx-font-size: 11px; -fx-text-fill: #757575;"/>
                    </HBox>

                    <ListView fx:id="availableCoursesListView" VBox.vgrow="ALWAYS">
                        <!-- Custom cell factory will be set in controller -->
                    </ListView>
                </VBox>

                <!-- Quick Stats -->
                <VBox spacing="8" style="-fx-background-color: #f5f5f5; -fx-padding: 10;">
                    <HBox spacing="5">
                        <Label text="Total Courses:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="totalCoursesLabel" text="0" style="-fx-font-size: 11px;"/>
                    </HBox>
                    <HBox spacing="5">
                        <Label text="Assigned:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="assignedCoursesLabel" text="0" style="-fx-font-size: 11px; -fx-text-fill: #4caf50;"/>
                    </HBox>
                    <HBox spacing="5">
                        <Label text="Unassigned:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <Label fx:id="unassignedCoursesLabel" text="0" style="-fx-font-size: 11px; -fx-text-fill: #f44336;"/>
                    </HBox>
                </VBox>
            </VBox>

            <!-- Center: Schedule Grid -->
            <BorderPane style="-fx-background-color: white; -fx-padding: 15;">
                <top>
                    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 0 0 15 0;">
                        <Label text="Master Schedule Grid" style="-fx-font-size: 18px; -fx-font-weight: bold;"/>

                        <Region HBox.hgrow="ALWAYS"/>

                        <!-- View Options -->
                        <HBox spacing="10">
                            <ToggleButton fx:id="weekViewToggle" text="Week View" selected="true"
                                         style="-fx-padding: 5 15;"/>
                            <ToggleButton fx:id="dayViewToggle" text="Day View"
                                         style="-fx-padding: 5 15;"/>
                        </HBox>

                        <!-- Grid Tools -->
                        <Button fx:id="autoFillButton" text="Auto-Fill Empty" onAction="#handleAutoFill"
                                style="-fx-background-color: #9c27b0; -fx-text-fill: white; -fx-padding: 6 12; -fx-cursor: hand;"/>
                        <Button fx:id="clearGridButton" text="Clear All" onAction="#handleClearGrid"
                                style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-padding: 6 12; -fx-cursor: hand;"/>
                    </HBox>
                </top>

                <center>
                    <ScrollPane fitToWidth="true" fitToHeight="true">
                        <GridPane fx:id="scheduleGrid" hgap="5" vgap="5" style="-fx-padding: 10; -fx-background-color: #fafafa;">
                            <!-- Grid will be dynamically populated -->
                        </GridPane>
                    </ScrollPane>
                </center>

                <bottom>
                    <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-padding: 15 0 0 0; -fx-background-color: #f5f5f5; -fx-padding: 10;">
                        <Label text="Legend:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                        <HBox spacing="5" alignment="CENTER">
                            <Region style="-fx-background-color: #e8f5e9; -fx-min-width: 15; -fx-min-height: 15; -fx-border-color: #4caf50; -fx-border-width: 2;"/>
                            <Label text="Assigned" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region style="-fx-background-color: #fff9c4; -fx-min-width: 15; -fx-min-height: 15; -fx-border-color: #fbc02d; -fx-border-width: 2;"/>
                            <Label text="Partial" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region style="-fx-background-color: #ffebee; -fx-min-width: 15; -fx-min-height: 15; -fx-border-color: #f44336; -fx-border-width: 2;"/>
                            <Label text="Conflict" style="-fx-font-size: 11px;"/>
                        </HBox>
                        <HBox spacing="5" alignment="CENTER">
                            <Region style="-fx-background-color: white; -fx-min-width: 15; -fx-min-height: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1;"/>
                            <Label text="Empty" style="-fx-font-size: 11px;"/>
                        </HBox>
                    </HBox>
                </bottom>
            </BorderPane>

            <!-- Right: Details & Actions -->
            <VBox spacing="15" style="-fx-padding: 15; -fx-background-color: white;">
                <Label text="Slot Details" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS">
                    <VBox spacing="20" style="-fx-padding: 10;">

                        <!-- Selected Slot Info -->
                        <VBox spacing="10" style="-fx-background-color: #e3f2fd; -fx-padding: 15; -fx-border-color: #2196f3; -fx-border-width: 2;">
                            <Label text="Selected Slot" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #0d47a1;"/>

                            <Label text="Day:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedDayLabel" text="None" style="-fx-font-size: 12px;"/>

                            <Label text="Period:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedPeriodLabel" text="None" style="-fx-font-size: 12px;"/>

                            <Label text="Time:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <Label fx:id="selectedTimeLabel" text="None" style="-fx-font-size: 12px;"/>
                        </VBox>

                        <!-- Course Assignment -->
                        <VBox spacing="10" style="-fx-background-color: #fff3e0; -fx-padding: 15; -fx-border-color: #ff9800; -fx-border-width: 2;">
                            <Label text="Course Assignment" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>

                            <Label text="Course:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignCourseComboBox" promptText="Select course..." maxWidth="Infinity"/>

                            <Label text="Teacher:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignTeacherComboBox" promptText="Select teacher..." maxWidth="Infinity"/>

                            <Label text="Room:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                            <ComboBox fx:id="assignRoomComboBox" promptText="Select room..." maxWidth="Infinity"/>

                            <Button fx:id="assignButton" text="Assign to Slot" onAction="#handleAssignToSlot"
                                    style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-padding: 10; -fx-cursor: hand;" maxWidth="Infinity"/>

                            <Button fx:id="clearSlotButton" text="Clear Slot" onAction="#handleClearSlot"
                                    style="-fx-background-color: #f44336; -fx-text-fill: white; -fx-padding: 8; -fx-cursor: hand;" maxWidth="Infinity"/>
                        </VBox>

                        <!-- Current Assignment Info -->
                        <VBox spacing="10" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                            <Label text="Current Assignment" style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                            <VBox spacing="5">
                                <Label text="Course:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentCourseLabel" text="Empty" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Teacher:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentTeacherLabel" text="Not assigned" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Room:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentRoomLabel" text="Not assigned" style="-fx-font-size: 12px;" wrapText="true"/>
                            </VBox>

                            <VBox spacing="5">
                                <Label text="Enrollment:" style="-fx-font-weight: bold; -fx-font-size: 11px;"/>
                                <Label fx:id="currentEnrollmentLabel" text="0/0" style="-fx-font-size: 12px;"/>
                            </VBox>
                        </VBox>

                        <!-- Conflict Warnings -->
                        <VBox spacing="10" fx:id="conflictWarningsBox" managed="false" visible="false"
                              style="-fx-background-color: #ffebee; -fx-padding: 15; -fx-border-color: #f44336; -fx-border-width: 2;">
                            <Label text="âš  Conflicts Detected" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                            <ListView fx:id="conflictListView" prefHeight="120"/>
                        </VBox>

                        <!-- Suggestions -->
                        <VBox spacing="10" style="-fx-background-color: #e8f5e9; -fx-padding: 15; -fx-border-color: #4caf50; -fx-border-width: 2;">
                            <Label text="ðŸ’¡ Suggestions" style="-fx-font-size: 14px; -fx-font-weight: bold; -fx-text-fill: #2e7d32;"/>
                            <ListView fx:id="suggestionsListView" prefHeight="100"/>
                        </VBox>

                    </VBox>
                </ScrollPane>

            </VBox>

        </SplitPane>
    </center>

    <!-- Bottom: Status & Actions -->
    <bottom>
        <VBox>
            <!-- Action Bar -->
            <HBox spacing="15" alignment="CENTER_RIGHT" style="-fx-background-color: white; -fx-padding: 15; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
                <Button fx:id="validateButton" text="Validate Schedule" onAction="#handleValidate"
                        style="-fx-background-color: #2196f3; -fx-text-fill: white; -fx-font-size: 13px; -fx-padding: 10 20; -fx-cursor: hand;"/>

                <Button fx:id="optimizeButton" text="Optimize Schedule" onAction="#handleOptimize"
                        style="-fx-background-color: #9c27b0; -fx-text-fill: white; -fx-font-size: 13px; -fx-padding: 10 20; -fx-cursor: hand;"/>

                <Button fx:id="publishButton" text="Publish Schedule" onAction="#handlePublish"
                        style="-fx-background-color: #4caf50; -fx-text-fill: white; -fx-font-size: 13px; -fx-padding: 10 20; -fx-cursor: hand;"/>

                <Region HBox.hgrow="ALWAYS"/>

                <Button fx:id="exportButton" text="Export" onAction="#handleExport"
                        style="-fx-background-color: #607d8b; -fx-text-fill: white; -fx-font-size: 13px; -fx-padding: 10 20; -fx-cursor: hand;"/>

                <Button fx:id="printButton" text="Print" onAction="#handlePrint"
                        style="-fx-background-color: #9e9e9e; -fx-text-fill: white; -fx-font-size: 13px; -fx-padding: 10 20; -fx-cursor: hand;"/>
            </HBox>

            <!-- Status Bar -->
            <HBox spacing="15" alignment="CENTER_LEFT" style="-fx-background-color: #fafafa; -fx-padding: 10; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
                <Label fx:id="statusLabel" text="Ready" style="-fx-font-size: 11px;"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="conflictCountLabel" text="Conflicts: 0" style="-fx-font-size: 11px; -fx-text-fill: #f44336;"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="utilizationLabel" text="Teacher Utilization: 0%" style="-fx-font-size: 11px;"/>
                <Separator orientation="VERTICAL"/>
                <Label fx:id="roomUtilizationLabel" text="Room Utilization: 0%" style="-fx-font-size: 11px;"/>
                <Region HBox.hgrow="ALWAYS"/>
                <Label fx:id="lastSavedLabel" text="Unsaved changes" style="-fx-font-size: 10px; -fx-text-fill: #757575;"/>
            </HBox>
        </VBox>
    </bottom>

</BorderPane>
