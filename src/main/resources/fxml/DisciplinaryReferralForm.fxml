<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.heronix.ui.controller.DisciplinaryReferralFormController"
            styleClass="content-pane">

    <top>
        <VBox styleClass="header-section">
            <padding>
                <Insets top="20" right="20" bottom="20" left="20"/>
            </padding>
            <Label text="Disciplinary Referral Form" styleClass="page-title"/>
            <Label text="Submit formal disciplinary referral to administration" styleClass="page-subtitle"/>
        </VBox>
    </top>

    <center>
        <ScrollPane fitToWidth="true" styleClass="form-scroll-pane">
            <VBox spacing="20" styleClass="form-container">
                <padding>
                    <Insets top="20" right="40" bottom="20" left="40"/>
                </padding>

                <!-- Student Information -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Student Information" styleClass="section-header"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Student *" styleClass="field-label"/>
                            <ComboBox fx:id="studentComboBox" promptText="Select Student" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Grade Level" styleClass="field-label"/>
                            <TextField fx:id="gradeLevelField" editable="false"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Student ID" styleClass="field-label"/>
                            <TextField fx:id="studentIdField" editable="false"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Referral Information -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Referral Information" styleClass="section-header"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Referral Date *" styleClass="field-label"/>
                            <DatePicker fx:id="referralDatePicker" promptText="Select Date" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Referral Time *" styleClass="field-label"/>
                            <TextField fx:id="referralTimeField" promptText="HH:MM"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Referring Teacher *" styleClass="field-label"/>
                            <ComboBox fx:id="referringTeacherComboBox" promptText="Select Teacher" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Class/Period" styleClass="field-label"/>
                            <ComboBox fx:id="classPeriodComboBox" promptText="Select Period" maxWidth="Infinity"/>
                        </VBox>

                        <!-- Row 1 -->
                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="1">
                            <Label text="Priority *" styleClass="field-label"/>
                            <ComboBox fx:id="priorityComboBox" promptText="Select Priority" maxWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="ROUTINE"/>
                                        <String fx:value="URGENT"/>
                                        <String fx:value="IMMEDIATE"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="1" GridPane.columnSpan="3">
                            <Label text="Assigned Administrator" styleClass="field-label"/>
                            <ComboBox fx:id="assignedAdminComboBox" promptText="Auto-assign based on priority" maxWidth="Infinity"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Incident Details -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Incident Details" styleClass="section-header"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Reason for Referral *" styleClass="field-label"/>
                            <ComboBox fx:id="referralReasonComboBox" promptText="Select Reason" maxWidth="Infinity">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="DISRUPTIVE_BEHAVIOR"/>
                                        <String fx:value="DEFIANCE"/>
                                        <String fx:value="PHYSICAL_AGGRESSION"/>
                                        <String fx:value="VERBAL_AGGRESSION"/>
                                        <String fx:value="BULLYING"/>
                                        <String fx:value="HARASSMENT"/>
                                        <String fx:value="INAPPROPRIATE_LANGUAGE"/>
                                        <String fx:value="TECHNOLOGY_VIOLATION"/>
                                        <String fx:value="ACADEMIC_DISHONESTY"/>
                                        <String fx:value="TRUANCY"/>
                                        <String fx:value="TARDINESS"/>
                                        <String fx:value="DRESS_CODE"/>
                                        <String fx:value="PROPERTY_DAMAGE"/>
                                        <String fx:value="THEFT"/>
                                        <String fx:value="WEAPONS"/>
                                        <String fx:value="DRUGS_ALCOHOL"/>
                                        <String fx:value="OTHER"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Campus *" styleClass="field-label"/>
                            <ComboBox fx:id="campusComboBox" promptText="Select Campus" maxWidth="Infinity"/>
                        </VBox>
                    </GridPane>

                    <VBox spacing="5">
                        <Label text="Detailed Description of Incident *" styleClass="field-label"/>
                        <TextArea fx:id="incidentDescriptionTextArea"
                                  promptText="Describe what happened, including specific behaviors, statements, and actions..."
                                  wrapText="true" prefRowCount="6"/>
                        <Text text="Be specific and objective. Include what led to the incident, the student's actions, and any interventions attempted."
                              styleClass="help-text" wrappingWidth="800"/>
                    </VBox>

                    <VBox spacing="5">
                        <Label text="Previous Interventions Attempted" styleClass="field-label"/>
                        <TextArea fx:id="interventionsTextArea"
                                  promptText="List classroom interventions tried (warnings, redirections, parent contact, etc.)..."
                                  wrapText="true" prefRowCount="4"/>
                    </VBox>
                </VBox>

                <!-- Prior Incidents -->
                <VBox spacing="15" styleClass="form-section">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="Prior Related Incidents" styleClass="section-header"/>
                        <CheckBox fx:id="hasRelatedIncidentsCheckBox" text="This student has related prior incidents"/>
                    </HBox>

                    <VBox spacing="5" fx:id="relatedIncidentsBox" disable="true">
                        <Label text="Related Incident Details" styleClass="field-label"/>
                        <TextArea fx:id="relatedIncidentsTextArea"
                                  promptText="Describe related prior incidents and outcomes..."
                                  wrapText="true" prefRowCount="3"/>
                    </VBox>

                    <GridPane hgap="15" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="33"/>
                            <ColumnConstraints percentWidth="34"/>
                        </columnConstraints>

                        <CheckBox fx:id="previousSuspensionCheckBox" text="Previous Suspension(s)"
                                  GridPane.columnIndex="0" GridPane.rowIndex="0"/>
                        <CheckBox fx:id="behaviorContractCheckBox" text="On Behavior Contract"
                                  GridPane.columnIndex="1" GridPane.rowIndex="0"/>
                        <CheckBox fx:id="behaviorPlanCheckBox" text="Has Behavior Intervention Plan"
                                  GridPane.columnIndex="2" GridPane.rowIndex="0"/>
                    </GridPane>
                </VBox>

                <!-- Witnesses & Others Involved -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Witnesses & Others Involved" styleClass="section-header"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="50"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <ComboBox fx:id="witnessComboBox" promptText="Add Witness" HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                <Button fx:id="addWitnessButton" text="Add" onAction="#handleAddWitness"/>
                            </HBox>
                            <ListView fx:id="witnessesListView" prefHeight="100"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <ComboBox fx:id="otherStudentsComboBox" promptText="Add Other Student Involved"
                                          HBox.hgrow="ALWAYS" maxWidth="Infinity"/>
                                <Button fx:id="addStudentButton" text="Add" onAction="#handleAddStudent"/>
                            </HBox>
                            <ListView fx:id="otherStudentsListView" prefHeight="100"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Parent Contact -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Parent/Guardian Communication" styleClass="section-header"/>

                    <CheckBox fx:id="parentContactedCheckBox" text="Parent/Guardian has been contacted about this incident"/>

                    <GridPane hgap="15" vgap="15" fx:id="parentContactGrid" disable="true">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="25"/>
                            <ColumnConstraints percentWidth="50"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Contact Date" styleClass="field-label"/>
                            <DatePicker fx:id="parentContactDatePicker"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Contact Method" styleClass="field-label"/>
                            <ComboBox fx:id="contactMethodComboBox" promptText="Select Method">
                                <items>
                                    <FXCollections fx:factory="observableArrayList">
                                        <String fx:value="Phone"/>
                                        <String fx:value="Email"/>
                                        <String fx:value="In Person"/>
                                        <String fx:value="Letter"/>
                                    </FXCollections>
                                </items>
                            </ComboBox>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Parent Response/Notes" styleClass="field-label"/>
                            <TextArea fx:id="parentResponseTextArea" promptText="Summary of parent conversation..."
                                      wrapText="true" prefRowCount="2"/>
                        </VBox>
                    </GridPane>
                </VBox>

                <!-- Attachments -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Supporting Documentation" styleClass="section-header"/>

                    <HBox spacing="10" alignment="CENTER_LEFT">
                        <Button fx:id="attachFileButton" text="Attach File" onAction="#handleAttachFile"/>
                        <Label fx:id="attachmentCountLabel" text="0 file(s) attached" styleClass="help-text"/>
                        <Text text="(Photos, written statements, work samples, etc.)" styleClass="help-text"/>
                    </HBox>

                    <ListView fx:id="attachmentsListView" prefHeight="80"/>
                </VBox>

                <!-- Recommended Action -->
                <VBox spacing="15" styleClass="form-section">
                    <Label text="Recommended Action (Optional)" styleClass="section-header"/>

                    <VBox spacing="5">
                        <Label text="Teacher's Recommendation" styleClass="field-label"/>
                        <TextArea fx:id="recommendedActionTextArea"
                                  promptText="Optional: Suggest appropriate administrative response..."
                                  wrapText="true" prefRowCount="3"/>
                    </VBox>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <bottom>
        <HBox spacing="10" alignment="CENTER_RIGHT" styleClass="button-bar">
            <padding>
                <Insets top="15" right="20" bottom="15" left="20"/>
            </padding>
            <Label fx:id="statusLabel" text="" styleClass="status-label"/>
            <Region HBox.hgrow="ALWAYS"/>
            <Button fx:id="submitButton" text="Submit Referral" onAction="#handleSubmit" styleClass="primary-button"/>
            <Button fx:id="saveDraftButton" text="Save Draft" onAction="#handleSaveDraft"/>
            <Button fx:id="cancelButton" text="Cancel" onAction="#handleCancel"/>
        </HBox>
    </bottom>

</BorderPane>
