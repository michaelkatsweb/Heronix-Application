<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.*?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>

<BorderPane xmlns="http://javafx.com/javafx"
            xmlns:fx="http://javafx.com/fxml"
            fx:controller="com.heronix.ui.controller.GiftedDashboardController"
            stylesheets="@../css/application.css"
            prefWidth="1600" prefHeight="1000">

    <!-- Top: Header -->
    <top>
        <VBox spacing="15" style="-fx-background-color: #6a1b9a; -fx-padding: 20;">
            <Label text="Gifted &amp; Talented Program Dashboard"
                   style="-fx-font-size: 24px; -fx-font-weight: bold; -fx-text-fill: white;"/>
            <Label text="Monitor identification, program placements, talent development, and academic enrichment"
                   style="-fx-font-size: 13px; -fx-text-fill: white;"/>
        </VBox>
    </top>

    <!-- Center: Main Content -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: #f5f5f5;">
            <VBox spacing="25" style="-fx-padding: 25;">

                <!-- Summary Statistics Cards -->
                <HBox spacing="20">
                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Total Gifted Students" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="totalGiftedLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #6a1b9a;"/>
                    </VBox>

                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Active in Services" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="activeServicesLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #388e3c;"/>
                    </VBox>

                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Referred/Screening" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="screeningLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #f57c00;"/>
                    </VBox>

                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Annual Reviews Due" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="reviewsDueLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #d32f2f;"/>
                    </VBox>

                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Advanced Courses" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="advancedCoursesLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #1976d2;"/>
                    </VBox>

                    <VBox spacing="10" styleClass="stat-card"
                          style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1; -fx-min-width: 200;">
                        <Label text="Multi-Talented" style="-fx-font-size: 11px; -fx-text-fill: #666;"/>
                        <Label fx:id="multiTalentedLabel" text="0"
                               style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #7b1fa2;"/>
                    </VBox>
                </HBox>

                <!-- Charts Row -->
                <HBox spacing="20">
                    <!-- Gifted Areas Distribution -->
                    <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1;" HBox.hgrow="ALWAYS">
                        <Label text="Gifted Areas Distribution" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <PieChart fx:id="giftedAreasChart" legendVisible="true" prefHeight="300"/>
                    </VBox>

                    <!-- Program Type Distribution -->
                    <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1;" HBox.hgrow="ALWAYS">
                        <Label text="Program Type Distribution" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <PieChart fx:id="programTypeChart" legendVisible="true" prefHeight="300"/>
                    </VBox>

                    <!-- Status Distribution -->
                    <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1;" HBox.hgrow="ALWAYS">
                        <Label text="Status Distribution" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <BarChart fx:id="statusChart" prefHeight="300">
                            <xAxis>
                                <CategoryAxis label="Status"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis label="Count"/>
                            </yAxis>
                        </BarChart>
                    </VBox>
                </HBox>

                <!-- Alerts & Action Items -->
                <HBox spacing="20">
                    <!-- Annual Reviews Due -->
                    <VBox spacing="15" style="-fx-background-color: #fff9c4; -fx-padding: 20; -fx-border-color: #fff176; -fx-border-width: 2;" HBox.hgrow="ALWAYS">
                        <Label text="⚠ Annual Reviews Due" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #f57f17;"/>
                        <ListView fx:id="annualReviewsDueListView" prefHeight="200"/>
                    </VBox>

                    <!-- Parent Consent Needed -->
                    <VBox spacing="15" style="-fx-background-color: #ffebee; -fx-padding: 20; -fx-border-color: #ef9a9a; -fx-border-width: 2;" HBox.hgrow="ALWAYS">
                        <Label text="⚠ Parent Consent Needed" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #c62828;"/>
                        <ListView fx:id="parentConsentNeededListView" prefHeight="200"/>
                    </VBox>

                    <!-- Underperforming Students -->
                    <VBox spacing="15" style="-fx-background-color: #fce4ec; -fx-padding: 20; -fx-border-color: #f48fb1; -fx-border-width: 2;" HBox.hgrow="ALWAYS">
                        <Label text="⚠ Underperforming Students" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #880e4f;"/>
                        <ListView fx:id="underperformingListView" prefHeight="200"/>
                    </VBox>

                    <!-- Progress Reviews Overdue -->
                    <VBox spacing="15" style="-fx-background-color: #fff3e0; -fx-padding: 20; -fx-border-color: #ffcc80; -fx-border-width: 2;" HBox.hgrow="ALWAYS">
                        <Label text="⚠ Progress Reviews Overdue" style="-fx-font-size: 16px; -fx-font-weight: bold; -fx-text-fill: #e65100;"/>
                        <ListView fx:id="progressReviewsOverdueListView" prefHeight="200"/>
                    </VBox>
                </HBox>

                <!-- Filters Section -->
                <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                    <Label text="Filter Students" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                    <GridPane hgap="15" vgap="15">
                        <columnConstraints>
                            <ColumnConstraints percentWidth="20"/>
                            <ColumnConstraints percentWidth="20"/>
                            <ColumnConstraints percentWidth="20"/>
                            <ColumnConstraints percentWidth="20"/>
                            <ColumnConstraints percentWidth="20"/>
                        </columnConstraints>

                        <VBox spacing="5" GridPane.columnIndex="0" GridPane.rowIndex="0">
                            <Label text="Status:" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="statusFilterComboBox" promptText="All Statuses" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="1" GridPane.rowIndex="0">
                            <Label text="Gifted Area:" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="giftedAreaFilterComboBox" promptText="All Areas" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="2" GridPane.rowIndex="0">
                            <Label text="Program Type:" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="programTypeFilterComboBox" promptText="All Programs" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="3" GridPane.rowIndex="0">
                            <Label text="Grade Level:" style="-fx-font-weight: bold;"/>
                            <ComboBox fx:id="gradeFilterComboBox" promptText="All Grades" maxWidth="Infinity"/>
                        </VBox>

                        <VBox spacing="5" GridPane.columnIndex="4" GridPane.rowIndex="0">
                            <Label text="Search:" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="searchField" promptText="Student name or ID..."/>
                        </VBox>

                        <HBox spacing="10" GridPane.columnIndex="0" GridPane.columnSpan="5" GridPane.rowIndex="1">
                            <Button text="Apply Filters" onAction="#handleApplyFilters"
                                    style="-fx-background-color: #6a1b9a; -fx-text-fill: white; -fx-padding: 8 20;"/>
                            <Button text="Clear Filters" onAction="#handleClearFilters"
                                    style="-fx-background-color: #9e9e9e; -fx-text-fill: white; -fx-padding: 8 20;"/>
                        </HBox>
                    </GridPane>
                </VBox>

                <!-- Students Table -->
                <VBox spacing="15" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1;">
                    <Label text="Gifted Students" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>

                    <TableView fx:id="studentsTableView" VBox.vgrow="ALWAYS" prefHeight="400">
                        <columns>
                            <TableColumn fx:id="studentIdColumn" text="Student ID" prefWidth="100"/>
                            <TableColumn fx:id="lastNameColumn" text="Last Name" prefWidth="120"/>
                            <TableColumn fx:id="firstNameColumn" text="First Name" prefWidth="120"/>
                            <TableColumn fx:id="gradeColumn" text="Grade" prefWidth="70"/>
                            <TableColumn fx:id="statusColumn" text="Status" prefWidth="150"/>
                            <TableColumn fx:id="primaryAreaColumn" text="Primary Area" prefWidth="150"/>
                            <TableColumn fx:id="programTypeColumn" text="Program Type" prefWidth="150"/>
                            <TableColumn fx:id="gpaColumn" text="GPA" prefWidth="70"/>
                            <TableColumn fx:id="advancedCoursesColumn" text="Advanced Courses" prefWidth="120"/>
                            <TableColumn fx:id="reviewStatusColumn" text="Review Status" prefWidth="120"/>
                            <TableColumn fx:id="actionsColumn" text="Actions" prefWidth="150"/>
                        </columns>
                    </TableView>
                </VBox>

            </VBox>
        </ScrollPane>
    </center>

    <!-- Bottom: Action Buttons -->
    <bottom>
        <HBox spacing="15" alignment="CENTER_RIGHT" style="-fx-background-color: white; -fx-padding: 20; -fx-border-color: #e0e0e0; -fx-border-width: 1 0 0 0;">
            <Button text="Add Gifted Student" onAction="#handleAddGiftedStudent"
                    style="-fx-background-color: #6a1b9a; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 30; -fx-cursor: hand;"/>
            <Button text="Export Report" onAction="#handleExportReport"
                    style="-fx-background-color: #1976d2; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 30; -fx-cursor: hand;"/>
            <Button text="Refresh" onAction="#handleRefresh"
                    style="-fx-background-color: #388e3c; -fx-text-fill: white; -fx-font-size: 14px; -fx-padding: 10 30; -fx-cursor: hand;"/>
        </HBox>
    </bottom>

</BorderPane>
